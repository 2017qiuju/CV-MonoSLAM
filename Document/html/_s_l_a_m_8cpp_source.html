<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>MonoSLAM: SLAM.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Jun Liu.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MonoSLAM
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Ceiling Vision based MonoSLAM</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SLAM.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_s_l_a_m_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">/*=========================================================================</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">*</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">* This is the main part for SLAM, including initialization, prediction, </span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">* and updating.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">*</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">*=========================================================================*/</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="stdafx_8h.html">StdAfx.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_s_l_a_m_8h.html">SLAM.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a9eded2090a57e9dab2a4b9efae2781a8">   21</a></span>&#160;<a class="code" href="class_c_s_l_a_m.html#a9eded2090a57e9dab2a4b9efae2781a8">CSLAM::CSLAM</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;:FLAG_4_VIDEO(0), </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;FLAG_4_IMAGE(1),</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;FLAG_4_WEIGHT1(0),</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;FLAG_4_WEIGHT2(1),</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;FLAG_4_WEIGHT3(2),</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;FLAG_4_NOISE1(0),</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;FLAG_4_NOISE2(1),</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;FLAG_4_NOISE3(2),</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;FLAG_4_NOISE4(3),</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;FLAG_4_UPDATING(0),</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;FLAG_4_DOWNDATING(1),</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;FLAG_4_NORMAL_UPDATE(0),</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;FLAG_4_LOW_INLIER(1),</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;FLAG_4_HIGH_INLIER(2),</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;FLAG_4_NEED_REORDER(0),</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;FLAG_4_NEEDNOT_REORDER(1),</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;FLAG_4_UNSELECT_MODEL(-1),</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;FLAG_4_DEBUG_MODEL(0),</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;FLAG_4_RELEASE_MODEL(1),</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;HP_INIT_W(10),</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;HP_INIT_H(10),</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;HP_MATCH_W(8),</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;HP_MATCH_H(8),</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;MIN_STEP_X(0.01),</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;MIN_STEP_Y(0.01),</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;MIN_STEP_THETA(45),</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;DIST_2_BORDER(20.0),</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;HFOV(180),</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;m_model(0),</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;LINEARITY_INDEX_THRESHOLD(0.1),</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;EPSILON(1e-13),    <span class="comment">// (DBL_EPSILON),</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// EPSINON(std::numeric_limits&lt;double&gt;::epsilon()),</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;CHI2INV_TABLE(Matx33d(0.95, 2, 5.99146454710798, 0.95, 3, 7.81472790325116, 0.95, 6, 12.59158724374398))</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#affcfd894a4b426b0bfb875dbf24dd133">initializeParameters</a>();</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#adf143164b103c821c69e6ecbdf196cf4">   64</a></span>&#160;<a class="code" href="class_c_s_l_a_m.html#adf143164b103c821c69e6ecbdf196cf4">CSLAM::~CSLAM</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    cvReleaseImage(&amp;<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    cvReleaseImage(&amp;<a class="code" href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">m_gryImage</a>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#a474a3d5d463b92a548d8deafa0692f82">isRecordRobotInfo</a>)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        fclose(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#a642c877d84c9035e798c38f8b34b5b2d">isRecordFeaturesInfo</a>)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        fclose(<a class="code" href="class_c_s_l_a_m.html#a843640a658f940a017c243192eba367d">m_featuresFile</a>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a80f6155a2e9788f0efb7f368b68df831">   87</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a80f6155a2e9788f0efb7f368b68df831">CSLAM::SLAM</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">//m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#add6e7be2413df6a83c450a284bb547d9">startTimer</a>();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a2ffb021f1b1b4b171df2af17f3e44c7b">predictMotion</a>();            </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#afba572d4a049c382580f2e8f1bcee90d">predictMeasurement</a>();       </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a34b1a07d06788e3f83f87997f7983834">loadPictures</a>();             </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aeca66ae1995f8cf09c57c44b7e9386ad">dataAssociation</a>();          </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a13befaca89bdd761fdbb8140cc52d026">KalmanUpdate</a>();                </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a10bfba127951793c3c71b1f15dc78ce7">updateFeaturesInformation</a>();</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a10360bc4e0d9ba5d21d6b62e162eff4d">updateRobotInformation</a>();   </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a6a20501ec9668e00d5e8b691fa9553af">display2DFeatureModel</a>();    </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1a3f3c6d1c6f8e2e07ba7f312606338c">recordData</a>();               </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#af427595554668e8e106c0d21f2a534d4">addFeatures</a>();              </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">//m_timer.stop(); cout&lt;&lt;m_timer.getTimeMilli()&lt;&lt;endl; m_timer.reset(); m_timer.start();</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a5571d5ee4c8d8d49d1cb25ac8552acfb">stopTimer</a>();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#add6e7be2413df6a83c450a284bb547d9">  122</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#add6e7be2413df6a83c450a284bb547d9">CSLAM::startTimer</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;{</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aaf16d659d0fc08eab4394f4c19174171">m_showCounter</a>++; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> (1 == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a596076d64280eaff8cc2f59d8b83980e">m_totalTimer</a>.reset(); <a class="code" href="class_c_s_l_a_m.html#a596076d64280eaff8cc2f59d8b83980e">m_totalTimer</a>.start();</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a33c72161c1e2a7b1d3229c06a4bbc5fe">m_frameTimer</a>.reset(); <a class="code" href="class_c_s_l_a_m.html#a33c72161c1e2a7b1d3229c06a4bbc5fe">m_frameTimer</a>.start();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a5571d5ee4c8d8d49d1cb25ac8552acfb">  142</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a5571d5ee4c8d8d49d1cb25ac8552acfb">CSLAM::stopTimer</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;{</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>++;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a33c72161c1e2a7b1d3229c06a4bbc5fe">m_frameTimer</a>.stop();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a596076d64280eaff8cc2f59d8b83980e">m_totalTimer</a>.stop();</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ae92b3d02b465fe36923da0f55e2b4e57">m_frameTime</a>  = <a class="code" href="class_c_s_l_a_m.html#a33c72161c1e2a7b1d3229c06a4bbc5fe">m_frameTimer</a>.getTimeSec();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a93082c69fed4be144061d488211602a6">m_totalTime</a> += <a class="code" href="class_c_s_l_a_m.html#a596076d64280eaff8cc2f59d8b83980e">m_totalTimer</a>.getTimeSec();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#affcfd894a4b426b0bfb875dbf24dd133">  158</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#affcfd894a4b426b0bfb875dbf24dd133">CSLAM::initializeParameters</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;{</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">//rng((unsigned)getTickCount()); </span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// If choose debug model, load the default parameters,</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// else use the parameters selected from MFC windows.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#adb6b5a4598b21f511bed1afb90512a9d">FLAG_4_DEBUG_MODEL</a> == <a class="code" href="class_c_s_l_a_m.html#a678882aa9b21e3b762861e19eace4703">m_model</a>)</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="comment">// =========Parameters for 3D show in main frame======== //</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a7aa372b9e9f14d83f429b1f5a04ba329">isShowRobotPath</a>  = FALSE;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a611321fbdc3c7da07acc33887d8957d8">isShowOdoInfo</a>    = FALSE;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">// ======Parameters for debug setting in the  paraemters dialog======== //</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="comment">// Parameters about finding keypoints.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a759b2bdb9135255a749e58df3986211d">m_deep</a>           = 3.0;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a145f5d483f8d0cec21e0f0513ab92e15">m_rho</a>            = 1.0/<a class="code" href="class_c_s_l_a_m.html#a759b2bdb9135255a749e58df3986211d">m_deep</a>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ae4f520854f4c3b5428853987719b5345">isUseHarris</a>      = FALSE; <span class="comment">//=====需要做类型转换BOOL到bool，暂时未用上????????</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a4e91611cd4da6d00e801af08208af2f7">m_blockSize</a>      = 3;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a3e577b86fc8fffc99c1c2d6a0ec3580e">m_qualityLevel</a>   = 0.1;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#abdbdc99a7b76b9b92ce1e78b2f15e79f">m_nInitialRaws</a>   = 8;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a5acc823042d158303466b37dd6e06ca4">m_nProcessRaws</a>   = 8;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a30e26cb144d31aa55cabd3ca83f6dbb7">m_minNUM</a>         = 5;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ada64e264d5a7abe84718bb0bb0001eae">m_minDist</a>        = 15.0;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a35a297ef2642aa92fe4ae5510deccbe5">m_minDist2</a>       = <a class="code" href="class_c_s_l_a_m.html#ada64e264d5a7abe84718bb0bb0001eae">m_minDist</a>*<a class="code" href="class_c_s_l_a_m.html#ada64e264d5a7abe84718bb0bb0001eae">m_minDist</a>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">// Parameters for threshold.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a6f4aa8e49668185ea1669a443ea49fc9">THRESHOLD_MATCH_PATCH</a> = 0.8;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a27e94bb61d6e364765f33ccce921fcc4">isUseRANSAC</a>      = FALSE;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a0d3c9f4251466093294f3716ba33202e">THRESHOLD_RANSAC</a> = 8.0;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment">// Parameters for noise value.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#afe0f12a4240bff20f1fdf67b7f0d941e">m_sigmaMeasure</a>   = 3.0;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aa2aaf017a8166a4e14e7f86853fbbd5e">m_sigmaRHO</a>       = <a class="code" href="class_c_s_l_a_m.html#a145f5d483f8d0cec21e0f0513ab92e15">m_rho</a>/2.0;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="comment">//a1               = 0.0004;</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="comment">//a2               = 0.0004;</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment">//a3               = 0.0006;</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="comment">//a4               = 0.0006;</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a813e1ea18c829576899fc1a0c37520ca">a1</a>               = 8;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aa86127f1bab10c2d4a49f20217ae861c">a2</a>               = 8;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#af4c7303a8d6e8d709f01e351495b6680">a3</a>               = 8;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a635bb274a586efe93488eab382f0a6ee">a4</a>               = 8;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">// Parameters for wether recording the output data.</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a474a3d5d463b92a548d8deafa0692f82">isRecordRobotInfo</a>    = TRUE;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a642c877d84c9035e798c38f8b34b5b2d">isRecordFeaturesInfo</a> = FALSE;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// Default output data restore path for file.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a2ca25e096261f87d375607a7b4ff2e00">m_videoDir</a>           = <span class="stringliteral">&quot;E:\\SLAM\\sequences\\2013.3.9.22.00\\1\\1_Xvid.avi&quot;</span>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a03a8cb00240cf0cf0920b335abf58cfa">m_imageDir</a>           = <span class="stringliteral">&quot;E:\\SLAM\\sequences\\6\\%04d.jpg&quot;</span>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a48ac8ce495315b77b2002c29a9c7de03">m_odometryDir</a>        = <span class="stringliteral">&quot;E:\\SLAM\\sequences\\data\\6.txt&quot;</span>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ac0c80869716e916b2cc1e68d19a41094">m_recordRobotDir</a>     = <span class="stringliteral">&quot;E:\\RobotPath.txt&quot;</span>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a073d17fca553c33d9ac42ff155a701ce">m_recordFeaturesDir</a>  = <span class="stringliteral">&quot;E:\\FeaturesInfo.txt&quot;</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment">// ======Parameters for debug model out of the dialog======== //</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#a40411126ccc74c881c78598a44b736ee">start</a>        = 600;<span class="comment">//150;//1020;//600;</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a0c00128b360f006e4afee34748ee341c">m_playType</a>           = <a class="code" href="class_c_s_l_a_m.html#a85b62e53754f84ae44e839c98d356227">FLAG_4_IMAGE</a>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">//====Parameters initialization for both debug and release model======//</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">//m_sigmaX        = 0.008;</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">//m_sigmaY        = 0.008;</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">//m_sigmaZ        = 0.0005;</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">//m_sigmaTheta    = 0.001;</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aba4fa1d56a107c695336ddcf74b993df">m_sigmaX</a>        = 0.02;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a5ee80e07f7e5495a4c417aa29ca82b09">m_sigmaY</a>        = 0.02;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a42b7d3d199787009a5825ad9ed61076d">m_sigmaZ</a>        = 0.005;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1320f334365b4195cf17dc6648dafc61">m_sigmaTheta</a>    = 0.02;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>           = Mat::zeros(4, 1, CV_64F);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>           = Mat::zeros(4, 4, CV_64F);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] = <a class="code" href="class_c_s_l_a_m.html#aba4fa1d56a107c695336ddcf74b993df">m_sigmaX</a>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[1] = <a class="code" href="class_c_s_l_a_m.html#a5ee80e07f7e5495a4c417aa29ca82b09">m_sigmaY</a>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[2] = <a class="code" href="class_c_s_l_a_m.html#a42b7d3d199787009a5825ad9ed61076d">m_sigmaZ</a>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(3)[3] = <a class="code" href="class_c_s_l_a_m.html#a1320f334365b4195cf17dc6648dafc61">m_sigmaTheta</a>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a83fed5c5d7abb40ae80785a56ad99af0">m_initOdo</a>       = Mat::zeros(2, 1, CV_64F);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">m_initPos</a>       = Mat::zeros(2, 1, CV_64F);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>      = Mat::zeros(3, <a class="code" href="class_c_s_l_a_m.html#a5320e447a0d286c4b9d30167d4096517">CAPACITY</a>+1, CV_64F);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7fe436c059d203549dbe5beb2ff8821a">Mt</a>              = Mat::zeros(3, 3, CV_64F);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8c26ea2610fd6c50546658793c866d73">Qt</a>              = Mat::eye(2, 2, CV_64F)*<a class="code" href="class_c_s_l_a_m.html#afe0f12a4240bff20f1fdf67b7f0d941e">m_sigmaMeasure</a>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8185f0d150a19c5eb32f2fb31328f1da">Ut</a>              = Mat::zeros(3, 1, CV_64F);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1da3ef03133006f33d757f3963439279">m_weightType</a>    = <a class="code" href="class_c_s_l_a_m.html#ae797f7fd1216905fa1c17ef7c9d41813">FLAG_4_WEIGHT1</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7dbebfd2d58ae738b8317e697dfad87e">m_noiseType</a>     = <a class="code" href="class_c_s_l_a_m.html#a9774a298be987d8f58670a3f66f3d4af">FLAG_4_NOISE1</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#acf3595d7a77fbbc773a64d3e8801e461">stop</a>    = <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#a40411126ccc74c881c78598a44b736ee">start</a> + <a class="code" href="class_c_s_l_a_m.html#a5320e447a0d286c4b9d30167d4096517">CAPACITY</a>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#ab11a61ec5156132efd0b15fd26a80ebb">index</a>   = <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#a40411126ccc74c881c78598a44b736ee">start</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a> = 1;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a60acccdb7e1218467b1c3ced7a4b1673">ID</a>              = 1;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>    = 0;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aaf16d659d0fc08eab4394f4c19174171">m_showCounter</a>   = 1;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>      = 0;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aa0230002110863d766bbb269b51a64c8">m_nDeletes</a>      = 0;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a5a2f68b64bde4544e5fc683548205b3d">m_nStores</a>       = 0;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>  = 0;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>     = 0;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>      = 0;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7b892f4223a321329a022e2d0fb9421b">m_nStoreMap</a>     = 0;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a515d1f5fbd66d9933889c55e192f7866">m_nStorePredicts</a>= 0;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#afd5af89231ef7c63336599eff5fca431">m_nStoreMatches</a> = 0;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#abfc34157a6efd2f4b4b2e6ac7b28c7af">m_nShowMap</a>      = 0;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a4a9048f6d9b2399c774bf23018a67532">m_nShowPredicts</a> = 0;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a6e634ee1c27bba0a45e8858426a09a9b">m_nShowMatches</a>  = 0;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a58923d88cfd810ef420737f7106f52c2">Alpha</a>  = 1e-3;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac091f56ac336b70e7b783c2eedbcf7c2">Beta</a>   = 2;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ae92b3d02b465fe36923da0f55e2b4e57">m_frameTime</a>     = 0;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a93082c69fed4be144061d488211602a6">m_totalTime</a>     = 0;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a> = FALSE;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#abcb644a1c146d7ef63911e6166f3a082">isCompensate</a> = TRUE;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a26010d877c4d12b5f74daba05e06e679">isShowOdoCtrlList</a> = FALSE;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// ======Parameters for open and store files========== //</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#a474a3d5d463b92a548d8deafa0692f82">isRecordRobotInfo</a>)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        strcpy_s(<a class="code" href="class_c_s_l_a_m.html#a7b2a9db2eb682da022004d15044ad0b6">record_robot_dir</a>, 100, <a class="code" href="class_c_s_l_a_m.html#ac0c80869716e916b2cc1e68d19a41094">m_recordRobotDir</a>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#a642c877d84c9035e798c38f8b34b5b2d">isRecordFeaturesInfo</a>)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        strcpy_s(<a class="code" href="class_c_s_l_a_m.html#aabafa6b7c7b4ddeeec57f44513fdb8b9">record_features_dir</a>, 100, <a class="code" href="class_c_s_l_a_m.html#a073d17fca553c33d9ac42ff155a701ce">m_recordFeaturesDir</a>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#acf3595d7a77fbbc773a64d3e8801e461">stop</a>)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#acf3595d7a77fbbc773a64d3e8801e461">stop</a> = INT_MAX;  <span class="comment">// initilize the stoping frame to the maximum int value</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">// Choose to use video or image sequence</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#aabca4a31778783a06d2299f1d6bcb933">FLAG_4_VIDEO</a> == <a class="code" href="class_c_s_l_a_m.html#a0c00128b360f006e4afee34748ee341c">m_playType</a>)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        strcpy_s(<a class="code" href="class_c_s_l_a_m.html#a58c64c678ec1fa80e69c272ba80055a0">video_dir</a>,100, <a class="code" href="class_c_s_l_a_m.html#a2ca25e096261f87d375607a7b4ff2e00">m_videoDir</a>);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aa4dec06804947efe52110a24ffc9a429">m_capture</a> = cvCreateFileCapture(<a class="code" href="class_c_s_l_a_m.html#a58c64c678ec1fa80e69c272ba80055a0">video_dir</a>);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#a02e2271c7816eb5961033b5451fd6af5">rate</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(cvGetCaptureProperty(<a class="code" href="class_c_s_l_a_m.html#aa4dec06804947efe52110a24ffc9a429">m_capture</a>, CV_CAP_PROP_FPS));</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="class_c_s_l_a_m.html#aa4dec06804947efe52110a24ffc9a429">m_capture</a>)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;Warning: error occured in getting video!&quot;</span>&lt;&lt;endl;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            system(<span class="stringliteral">&quot;pause&quot;</span>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        cvSetCaptureProperty(<a class="code" href="class_c_s_l_a_m.html#aa4dec06804947efe52110a24ffc9a429">m_capture</a>, CV_CAP_PROP_POS_FRAMES, <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#a40411126ccc74c881c78598a44b736ee">start</a>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a> = cvQueryFrame(<a class="code" href="class_c_s_l_a_m.html#aa4dec06804947efe52110a24ffc9a429">m_capture</a>);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    } </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        strcpy_s(<a class="code" href="class_c_s_l_a_m.html#a5fbe026390eb088cfa688e7703d27d65">image_dir</a>,100, <a class="code" href="class_c_s_l_a_m.html#a03a8cb00240cf0cf0920b335abf58cfa">m_imageDir</a>);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordtype">char</span> image_name[100];</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        sprintf_s(image_name, <a class="code" href="class_c_s_l_a_m.html#a5fbe026390eb088cfa688e7703d27d65">image_dir</a>, <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#ab11a61ec5156132efd0b15fd26a80ebb">index</a>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a> = cvLoadImage(image_name);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// Initialize the image structure</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">imageWidth</a>  = <a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>-&gt;width;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">imageHeight</a> = <a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>-&gt;height;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ac789ea573cffc641b30ba830238c49a4">m_imageSize</a> = Size(<a class="code" href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">imageWidth</a>, <a class="code" href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">imageHeight</a>);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">m_gryImage</a>  = cvCreateImage(cvSize(<a class="code" href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">imageWidth</a>, <a class="code" href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">imageHeight</a>),IPL_DEPTH_8U,1);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    cvCvtColor(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, <a class="code" href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">m_gryImage</a>, CV_RGB2GRAY);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// Load odometry data set</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    strcpy_s(<a class="code" href="class_c_s_l_a_m.html#a2835432153601737fc85a2c7b04e466e">odometry_dir</a>, 100, <a class="code" href="class_c_s_l_a_m.html#a48ac8ce495315b77b2002c29a9c7de03">m_odometryDir</a>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordtype">int</span> err_open = fopen_s(&amp;<a class="code" href="class_c_s_l_a_m.html#a9be9d3353e795d702436c03d09cfc831">m_odometryFile</a>, <a class="code" href="class_c_s_l_a_m.html#a2835432153601737fc85a2c7b04e466e">odometry_dir</a>, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (0 != err_open) </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        cout&lt;&lt;<span class="stringliteral">&quot;Error occured in loading odometry data!&quot;</span>&lt;&lt;endl;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        system(<span class="stringliteral">&quot;pause&quot;</span>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// ===========Set the camera parameters========== //</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aa47960604a1b02265860649d240d8cbc">cam_dx</a>     = 0.0028;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a5cdb60999eef72cc5c1a974494832506">cam_dy</a>     = 0.0028;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a>     = 310.1129;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a>     = 236.7526;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a88d74ecfef345368df31b591c8c258f3">cam_k1</a>     = 0.0001;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7174e985af7a5d59bf398d9d1fb5137f">cam_k2</a>     = 0.0000;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#afd9a182f389ef490e570813c9fbd6a71">cam_f</a>      = 2.1735;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a93e54316c1d69437d1e955906da90064">cam_f1</a>     = <a class="code" href="class_c_s_l_a_m.html#afd9a182f389ef490e570813c9fbd6a71">cam_f</a>/<a class="code" href="class_c_s_l_a_m.html#aa47960604a1b02265860649d240d8cbc">cam_dx</a>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a47d15f82401fd04de6c5533606c5b6db">cam_f2</a>     = <a class="code" href="class_c_s_l_a_m.html#afd9a182f389ef490e570813c9fbd6a71">cam_f</a>/<a class="code" href="class_c_s_l_a_m.html#a5cdb60999eef72cc5c1a974494832506">cam_dy</a>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7844c896ef4784019de00f6996cac990">cam_K</a>      = 0;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7844c896ef4784019de00f6996cac990">cam_K</a>(0,0) = <a class="code" href="class_c_s_l_a_m.html#a93e54316c1d69437d1e955906da90064">cam_f1</a>;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7844c896ef4784019de00f6996cac990">cam_K</a>(1,1) = <a class="code" href="class_c_s_l_a_m.html#a47d15f82401fd04de6c5533606c5b6db">cam_f2</a>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7844c896ef4784019de00f6996cac990">cam_K</a>(0,2) = <a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7844c896ef4784019de00f6996cac990">cam_K</a>(1,2) = <a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a>; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7844c896ef4784019de00f6996cac990">cam_K</a>(2,2) = 1.0;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a> = NULL;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">//blackList = NULL; // =========后期加入?????????</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a278385918f3b5a6356c9392ad81fd768">loadOdometryData</a>();</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#af427595554668e8e106c0d21f2a534d4">addFeatures</a>();</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#adfa9dfa0f11f11b7f5a9af9dbadcd44c">m_nStore4Show</a>  = <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a> = 0;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a278385918f3b5a6356c9392ad81fd768">  363</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a278385918f3b5a6356c9392ad81fd768">CSLAM::loadOdometryData</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;{</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">//=============Read the odometry data from .txt file==========//</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordtype">int</span> id;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordtype">int</span> index=1;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordtype">double</span> x0, x1, y0, y1, theta0, theta1;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordtype">double</span> diff_x, diff_y, diff_theta;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> (1 == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#a40411126ccc74c881c78598a44b736ee">start</a>)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a1b13f12690acb59cb35ee9620ee39c0a">getOneMomentData</a>(<span class="keywordtype">id</span>, <a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="keywordflow">while</span>(!feof(<a class="code" href="class_c_s_l_a_m.html#a9be9d3353e795d702436c03d09cfc831">m_odometryFile</a>))</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a1b13f12690acb59cb35ee9620ee39c0a">getOneMomentData</a>(<span class="keywordtype">id</span>, <a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            index++;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="keywordflow">if</span> (index == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#a40411126ccc74c881c78598a44b736ee">start</a>)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a1b13f12690acb59cb35ee9620ee39c0a">getOneMomentData</a>(<span class="keywordtype">id</span>, <a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                index = 2*<a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                x0 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+0);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                y0 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+1);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>++;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[0] = <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0] = 0;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#acf3595d7a77fbbc773a64d3e8801e461">stop</a> - <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#a40411126ccc74c881c78598a44b736ee">start</a>; i++)</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span> (feof(<a class="code" href="class_c_s_l_a_m.html#a9be9d3353e795d702436c03d09cfc831">m_odometryFile</a>))</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a1b13f12690acb59cb35ee9620ee39c0a">getOneMomentData</a>(<span class="keywordtype">id</span>, <a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        index = 2*<a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        x0 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index-2);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        x1 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+0);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        y0 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index-1);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        y1 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+1);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        diff_x = abs(x1 - x0);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        diff_y = abs(y1 - y0);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">while</span> ((diff_x &lt; <a class="code" href="class_c_s_l_a_m.html#a40996973529f1a1d785a8f3ca489dc35">MIN_STEP_X</a>) &amp;&amp; (diff_y &lt; <a class="code" href="class_c_s_l_a_m.html#a438b28c0143312606e935be8bd30c9b4">MIN_STEP_Y</a>))</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a1b13f12690acb59cb35ee9620ee39c0a">getOneMomentData</a>(<span class="keywordtype">id</span>, <a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            index = 2*<a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            x0 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index-2);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            x1 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+0);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            y0 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index-1);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            y1 = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+1);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            diff_x = abs(x1 - x0);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            diff_y = abs(y1 - y0);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        theta0 = <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[<a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>-1];</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        theta1 = <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[<a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>];</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        diff_theta = abs(<a class="code" href="class_c_s_l_a_m.html#a9df2936951f63c5cb86449bd378e13fc">wrapAngle</a>(theta1 - theta0));</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">if</span> (diff_theta &gt; <a class="code" href="class_c_s_l_a_m.html#a8c128d14e381f42644926be58523a908">MIN_STEP_THETA</a>*CV_PI/180)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        {</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[<a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>] = 1;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        } </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[<a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>] = 0;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">m_odoCounter</a>++;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    fclose(<a class="code" href="class_c_s_l_a_m.html#a9be9d3353e795d702436c03d09cfc831">m_odometryFile</a>);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a1b13f12690acb59cb35ee9620ee39c0a">  462</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a1b13f12690acb59cb35ee9620ee39c0a">CSLAM::getOneMomentData</a> (<span class="keywordtype">int</span> &amp;<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;counter)</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;{</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">//int id = 0;</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordtype">int</span> index = 2*counter;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordtype">double</span> x = 0, y = 0, theta = 0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordtype">char</span> line[500]=<span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span> (feof(<a class="code" href="class_c_s_l_a_m.html#a9be9d3353e795d702436c03d09cfc831">m_odometryFile</a>))</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    fgets(line, <span class="keyword">sizeof</span>(line), <a class="code" href="class_c_s_l_a_m.html#a9be9d3353e795d702436c03d09cfc831">m_odometryFile</a>);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    sscanf_s(line, <span class="stringliteral">&quot;%d : %*lf %lf %lf %lf&quot;</span>, &amp;<span class="keywordtype">id</span>, &amp;x, &amp;y, &amp;theta);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[counter] = <span class="keywordtype">id</span>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[counter] = theta;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (0 == counter)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a83fed5c5d7abb40ae80785a56ad99af0">m_initOdo</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] = x;        <span class="comment">// for initilization</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a83fed5c5d7abb40ae80785a56ad99af0">m_initOdo</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] = y;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">m_initPos</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">m_initPos</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+0) = <a class="code" href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">m_initPos</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+1) = <a class="code" href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">m_initPos</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    } </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+0) = <a class="code" href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">m_initPos</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] + (x - <a class="code" href="class_c_s_l_a_m.html#a83fed5c5d7abb40ae80785a56ad99af0">m_initOdo</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0]); </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+1) = <a class="code" href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">m_initPos</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] + (y - <a class="code" href="class_c_s_l_a_m.html#a83fed5c5d7abb40ae80785a56ad99af0">m_initOdo</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0]);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;}</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a9df2936951f63c5cb86449bd378e13fc">  507</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="class_c_s_l_a_m.html#a9df2936951f63c5cb86449bd378e13fc">CSLAM::wrapAngle</a> (<span class="keywordtype">double</span> angle)<span class="keyword"> const</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span> (angle &gt; CV_PI)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        angle -= 2.0*CV_PI;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (angle &lt; -CV_PI)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        angle += 2.0*CV_PI;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">return</span> angle;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;}</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a34b1a07d06788e3f83f87997f7983834">  529</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a34b1a07d06788e3f83f87997f7983834">CSLAM::loadPictures</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;{</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#aabca4a31778783a06d2299f1d6bcb933">FLAG_4_VIDEO</a> == <a class="code" href="class_c_s_l_a_m.html#a0c00128b360f006e4afee34748ee341c">m_playType</a>)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a> = cvQueryFrame(<a class="code" href="class_c_s_l_a_m.html#aa4dec06804947efe52110a24ffc9a429">m_capture</a>);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    } </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordtype">char</span> image_name[100];</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        sprintf_s(image_name, <a class="code" href="class_c_s_l_a_m.html#a5fbe026390eb088cfa688e7703d27d65">image_dir</a>, <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#ab11a61ec5156132efd0b15fd26a80ebb">index</a>);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a> = cvLoadImage(image_name);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    cvCvtColor(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, <a class="code" href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">m_gryImage</a>, CV_RGB2GRAY);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;}</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#af427595554668e8e106c0d21f2a534d4">  552</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#af427595554668e8e106c0d21f2a534d4">CSLAM::addFeatures</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;{</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a3d2b94fa175e76bf49fb5e88539a286e">m_nAddings</a> = 0;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a> &lt; <a class="code" href="class_c_s_l_a_m.html#a30e26cb144d31aa55cabd3ca83f6dbb7">m_minNUM</a>) || (TRUE == <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a>))             <span class="comment">// only add features when matched number below a threshold</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a03dd3280948f837cd51d1fc0e149a6a4">detectAndfilteringFeatures</a>();</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad62db81c1a84c399cbc72a8d537cab52">insureEnoughFeatures</a>();</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a74dfecb069f3aca641035d1f0291dc9a">integrateFeaturesInformation</a>();</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;} </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a03dd3280948f837cd51d1fc0e149a6a4">  574</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a03dd3280948f837cd51d1fc0e149a6a4">CSLAM::detectAndfilteringFeatures</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;{</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    vector&lt;KeyPoint&gt; keyPoints;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    Mat image(<a class="code" href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">m_gryImage</a>);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    Point2d uvu, uvd;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    Point3d xyz;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordtype">int</span> minNum;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordtype">int</span> counter = 0;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> flag = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordtype">double</span> px, py, mx, my, kx, ky;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordtype">double</span> dx, dy, dmx, dmy, dpx, dpy, dist;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    Mat Hlr, Hlw, state, position, Rwc, Rcw;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <a class="code" href="struct_feature_info.html">FeatureInfo</a> featuresInfo;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">if</span> (1 == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a> || TRUE == <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a>)</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        minNum = <a class="code" href="class_c_s_l_a_m.html#abdbdc99a7b76b9b92ce1e78b2f15e79f">m_nInitialRaws</a>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        minNum = <a class="code" href="class_c_s_l_a_m.html#a5acc823042d158303466b37dd6e06ca4">m_nProcessRaws</a>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    GoodFeaturesToTrackDetector detector(minNum, <a class="code" href="class_c_s_l_a_m.html#a3e577b86fc8fffc99c1c2d6a0ec3580e">m_qualityLevel</a>, <a class="code" href="class_c_s_l_a_m.html#ada64e264d5a7abe84718bb0bb0001eae">m_minDist</a>, <a class="code" href="class_c_s_l_a_m.html#a4e91611cd4da6d00e801af08208af2f7">m_blockSize</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    detector.detect(<a class="code" href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">m_gryImage</a>, keyPoints);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// =========暂时未用上?????????</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">//SurfFeatureDetector detector;         // 特征提取</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">//detector.detect(image,keyPoints);</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">//FAST(image,keyPoints,60);</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordtype">bool</span> flag4Adding;  <span class="comment">// assume the selected keypoint satisfy the default assumption</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordtype">bool</span> isThereNoZero;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordtype">int</span> nCols = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.size();</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a3378ec8c558880dcb28a44a8c491d72e">m_loopPointCounter</a> = 0;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    Mat pixelPos = Mat::zeros(2, nCols, CV_64F);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    Mat error    = Mat::zeros(2, 1, CV_64F);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    Mat restoreID = Mat::zeros(<a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.size(), 1, CV_64F);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a>)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a1c25c2a3a17c0d266ae10294ebbff455">m_loopPointID</a> = Mat::zeros(<a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.size(), 1, CV_8U);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">for</span> (vector&lt;FeatureInfo&gt;::size_type j=0; j&lt;<a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.size(); j++)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            position = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(dim-4,dim-1);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a6a2e5ad9c88939b5a16671594cc93e62">getTransferMatrix</a>(Rwc, <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[0]);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            Rcw = Rwc.inv();</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            state = (Mat)<a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j].state;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ab5b37bf7b14dd233ac4171797a035eda">coordinatesState2World</a>(Hlw, state, position);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a22e6803a4e1b4f01003138cab269ed27">coordinatesWorld2Camera</a>(Hlr, Hlw, Rcw);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a29508ebc6507aab0b651c6b0f4264c40">coordinatesCamera2Image</a>(uvu, Hlr, error);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a3721327d0b02a524662bc1b5fb4e564d">distortOnePointRW</a>(uvd, uvu);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            pixelPos.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[<span class="keywordtype">id</span>] = uvd.x;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            pixelPos.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[id] = uvd.y;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <span class="keywordtype">id</span>++;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">for</span> (vector&lt;KeyPoint&gt;::size_type i=0; i&lt;keyPoints.size(); i++)</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        flag4Adding = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        KeyPoint kp = keyPoints[i];</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        kx = kp.pt.x;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        ky = kp.pt.y;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">if</span> (kx &gt;= <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> &amp;&amp; kx &lt;= (<a class="code" href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">imageWidth</a> - <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a>)   <span class="comment">// features shouldn&#39;t too close to the edge</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            &amp;&amp; ky &gt;= <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> &amp;&amp; ky &lt;= (<a class="code" href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">imageHeight</a> - <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a>))</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <span class="keywordflow">if</span> ((1 == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>) || (<span class="keyword">true</span> == flag))</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>.push_back(kp);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                counter++;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                <span class="keywordflow">if</span> (0 != <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                    <span class="comment">// features shouldn&#39;t be too close to the predicted and matched features</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                    <a class="code" href="struct_points_map.html">PointsMap</a> *map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                    <span class="keywordflow">while</span> (NULL != map_p)          </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                    {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                        mx = map_p-&gt;<a class="code" href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">matchLocation</a>.x;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                        my = map_p-&gt;<a class="code" href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">matchLocation</a>.y;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                        px = map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.x;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                        py = map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.y;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                        isThereNoZero = (0 != mx) &amp;&amp; (0 != my) &amp;&amp; (0 != px) &amp;&amp; (0 != py);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                        <span class="keywordflow">if</span> (<span class="keyword">true</span> == isThereNoZero)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                        {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                            dmx = kx - mx;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                            dmy = ky - my;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                            dpx = kx - px;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                            dpy = ky - py;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                            <span class="keywordflow">if</span> ((<a class="code" href="class_c_s_l_a_m.html#a35a297ef2642aa92fe4ae5510deccbe5">m_minDist2</a> &gt; dmx*dmx + dmy*dmy) || (<a class="code" href="class_c_s_l_a_m.html#a35a297ef2642aa92fe4ae5510deccbe5">m_minDist2</a> &gt; dpx*dpx + dpy*dpy))</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                            {</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                                flag4Adding = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                <span class="comment">//cout&lt;&lt;&quot;Warn: too close to the map features!&quot;&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                                <span class="comment">//system(&quot;pause&quot;);</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                            }</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                        }</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                        {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                            flag4Adding = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                        }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                        map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                    }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                <span class="keywordflow">if</span> ((<span class="keyword">true</span> == flag4Adding) &amp;&amp; (0 != <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.size()))</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                    <span class="keywordflow">for</span> (vector&lt;FeatureInfo&gt;::size_type j=0; j&lt;<a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.size(); j++)</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                    {</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                        featuresInfo = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j];</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                        dx = kx - pixelPos.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[j];</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                        dy = ky - pixelPos.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[j];</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                        dist = dx*dx + dy*dy;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                        <span class="keywordflow">if</span> (dist &lt; <a class="code" href="class_c_s_l_a_m.html#a35a297ef2642aa92fe4ae5510deccbe5">m_minDist2</a>)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                        {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                            flag4Adding = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                            <span class="comment">//m_formerFeatures.push_back(m_featuresAllInfo[j]);</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                            <a class="code" href="class_c_s_l_a_m.html#a1c25c2a3a17c0d266ae10294ebbff455">m_loopPointID</a>.ptr&lt;<span class="keywordtype">int</span>&gt;(<a class="code" href="class_c_s_l_a_m.html#a3378ec8c558880dcb28a44a8c491d72e">m_loopPointCounter</a>)[0] = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j].<a class="code" href="class_c_s_l_a_m.html#a60acccdb7e1218467b1c3ced7a4b1673">ID</a>;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                            <a class="code" href="class_c_s_l_a_m.html#a3378ec8c558880dcb28a44a8c491d72e">m_loopPointCounter</a>++;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                            counter++;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                            <span class="comment">//cout&lt;&lt;&quot;dx = &quot;&lt;&lt;dx&lt;&lt;&quot;,  dy = &quot;&lt;&lt;dy&lt;&lt;endl;</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                            <span class="comment">//cout&lt;&lt;&quot;Warn: already observed the feature!  dist = &quot;&lt;&lt;dist&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                            cout&lt;&lt;<span class="stringliteral">&quot;Warn: already observed the feature!&quot;</span>&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                            <span class="comment">//system(&quot;pause&quot;);</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                        }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                    }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                }</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                <span class="comment">// Restrict the distance between two features</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                <span class="keywordflow">if</span> (<span class="keyword">true</span> == flag4Adding)</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                    <span class="keywordflow">for</span> (vector&lt;KeyPoint&gt;::size_type j=0; j&lt;<a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>.size(); j++)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                    {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                        dx = kx-<a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>[j].pt.x;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                        dy = ky-<a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>[j].pt.y;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#a35a297ef2642aa92fe4ae5510deccbe5">m_minDist2</a> &gt; dx*dx+dy*dy)   </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                        {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                            flag4Adding = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                        }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                    }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                    <span class="keywordflow">if</span> (<span class="keyword">true</span> == flag4Adding)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                    {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                        <a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>.push_back(kp);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                        counter++;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                    }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    flag = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a>)</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>     = counter;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a3d2b94fa175e76bf49fb5e88539a286e">m_nAddings</a>     = counter;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a> = counter;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>     = counter;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a3d2b94fa175e76bf49fb5e88539a286e">m_nAddings</a>     = counter;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a> = <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a> + <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;}</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00777"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#ad62db81c1a84c399cbc72a8d537cab52">  777</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#ad62db81c1a84c399cbc72a8d537cab52">CSLAM::insureEnoughFeatures</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;{</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordtype">int</span> numberStore = <a class="code" href="class_c_s_l_a_m.html#abdbdc99a7b76b9b92ce1e78b2f15e79f">m_nInitialRaws</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordtype">double</span> qualityLevelStore = <a class="code" href="class_c_s_l_a_m.html#a3e577b86fc8fffc99c1c2d6a0ec3580e">m_qualityLevel</a>;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">//int tmp = 1;</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a> &lt; <a class="code" href="class_c_s_l_a_m.html#a30e26cb144d31aa55cabd3ca83f6dbb7">m_minNUM</a>)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#abdbdc99a7b76b9b92ce1e78b2f15e79f">m_nInitialRaws</a> += <a class="code" href="class_c_s_l_a_m.html#a30e26cb144d31aa55cabd3ca83f6dbb7">m_minNUM</a>;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="comment">//m_qualityLevel -= 0.005;</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="comment">//cout&lt;&lt;tmp&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="comment">//tmp++;</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="comment">//cout&lt;&lt;&quot;/////////////////////&quot;&lt;&lt;endl;</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="comment">//cout&lt;&lt;&quot;m_nInitialRaws = &quot;&lt;&lt;m_nInitialRaws&lt;&lt;endl;</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="comment">//cout&lt;&lt;&quot;m_qualityLevel = &quot;&lt;&lt;m_qualityLevel&lt;&lt;endl;</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="comment">//cout&lt;&lt;&quot;m_nMapFeatures = &quot;&lt;&lt;m_nMapFeatures&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="comment">//if (m_qualityLevel &lt;= 0.0)</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#abdbdc99a7b76b9b92ce1e78b2f15e79f">m_nInitialRaws</a> &gt; 30)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        vector&lt;KeyPoint&gt;().swap(<a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a03dd3280948f837cd51d1fc0e149a6a4">detectAndfilteringFeatures</a>();</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#abdbdc99a7b76b9b92ce1e78b2f15e79f">m_nInitialRaws</a> = numberStore;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a3e577b86fc8fffc99c1c2d6a0ec3580e">m_qualityLevel</a> = qualityLevelStore;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;}</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a74dfecb069f3aca641035d1f0291dc9a">  818</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a74dfecb069f3aca641035d1f0291dc9a">CSLAM::integrateFeaturesInformation</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;{</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span> (0 == <a class="code" href="class_c_s_l_a_m.html#a3d2b94fa175e76bf49fb5e88539a286e">m_nAddings</a>)</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    Mat image(<a class="code" href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">m_gryImage</a>);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a> = dim + 3*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordtype">int</span> Na = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordtype">int</span> counter = 0;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    Mat mu2(3*m_nFilters, 1, CV_64F);</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    Mat sr2 = Mat::zeros(3*m_nFilters, 3*m_nFilters, CV_64F);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    Mat cam_position = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(dim-4, dim-1);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    Mat Rwc;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a6a2e5ad9c88939b5a16671594cc93e62">getTransferMatrix</a>(Rwc, <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[0]);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a>)</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        counter = m_nFilters - <a class="code" href="class_c_s_l_a_m.html#a3378ec8c558880dcb28a44a8c491d72e">m_loopPointCounter</a>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    } </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        counter = <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    }</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; counter; i++)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    {</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        index = 3*i;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        mu2.ptr&lt;<span class="keywordtype">double</span>&gt;(index+0)[0] = <a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>[i].pt.x;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        mu2.ptr&lt;<span class="keywordtype">double</span>&gt;(index+1)[0] = <a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>[i].pt.y;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        mu2.ptr&lt;<span class="keywordtype">double</span>&gt;(index+2)[0] = <a class="code" href="class_c_s_l_a_m.html#a145f5d483f8d0cec21e0f0513ab92e15">m_rho</a>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        sr2.ptr&lt;<span class="keywordtype">double</span>&gt;(index+0)[index+0] = <a class="code" href="class_c_s_l_a_m.html#afe0f12a4240bff20f1fdf67b7f0d941e">m_sigmaMeasure</a>;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        sr2.ptr&lt;<span class="keywordtype">double</span>&gt;(index+1)[index+1] = <a class="code" href="class_c_s_l_a_m.html#afe0f12a4240bff20f1fdf67b7f0d941e">m_sigmaMeasure</a>;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        sr2.ptr&lt;<span class="keywordtype">double</span>&gt;(index+2)[index+2] = <a class="code" href="class_c_s_l_a_m.html#aa2aaf017a8166a4e14e7f86853fbbd5e">m_sigmaRHO</a>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    Mat mu(Na, 1, CV_64F);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    Mat sr = Mat::zeros(Na, Na, CV_64F);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    Mat sigma_in(dim+3*m_nFilters, 2*Na+1, CV_64F);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    Mat sigma_out(dim+6*m_nFilters, 2*Na+1, CV_64F);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    Mat mu_Hlw(3*m_nFilters, 1, CV_64F);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    Mat mu_angle(3*m_nFilters, 1, CV_64F);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a469c1e2668e535b3832eac150de1de20">calculateSampleParameter</a>(Na);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1910581735af07c86f936053daf0cbea">expandMatrix</a>(mu, sr, <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>, <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>, mu2, sr2);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#af64580d03f6d861b18e7b7e44cf1728a">generateSigmaPoints</a>(sigma_in, mu, sr);          <span class="comment">// sigma_in is disordered</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a22c2f1462fcefbd19224c60269577209">passSigmaThroughMapingFunction</a>(sigma_out, mu_Hlw, mu_angle, sigma_in);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a015dbfd65b5014a17be3da7594015dc8">QrAndCholeskyForInitilization</a>(sigma_out);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// ==========Integrate feature&#39;s information into features map=========== //</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    Point2d uvd;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordtype">double</span> Hlw_x, Hlw_y, Hlw_z;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a885daa74ce6ef815fb7422c33b4a2e5f">m_filterID</a> = Mat::zeros(m_nFilters, 1, CV_64F); <span class="comment">// CV_16U:  0--65535</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    Mat initInformation(6, 1, CV_64F);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a>)</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    {</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <span class="keywordflow">while</span> (NULL != <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            <a class="code" href="struct_points_map.html">PointsMap</a>* map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            <span class="keyword">delete</span> <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a> = map_p;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        }</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;counter; i++)</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        index = 3*i;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        uvd = <a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>[i].pt;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="comment">// uvd.x特征点在横轴（即图像的宽度范围）上的位置</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="comment">// uvd.y特征点在纵轴（即图像的高度范围）上的位置</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        Hlw_x = mu_Hlw.ptr&lt;<span class="keywordtype">double</span>&gt;(index+0)[0];</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        Hlw_y = mu_Hlw.ptr&lt;<span class="keywordtype">double</span>&gt;(index+1)[0];</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        Hlw_z = mu_Hlw.ptr&lt;<span class="keywordtype">double</span>&gt;(index+2)[0];</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a885daa74ce6ef815fb7422c33b4a2e5f">m_filterID</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(i)[0] = <a class="code" href="class_c_s_l_a_m.html#a60acccdb7e1218467b1c3ced7a4b1673">ID</a>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        cam_position.copyTo(initInformation.rowRange(0,3));</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        mu_angle.rowRange(index, index+3).copyTo(initInformation.rowRange(3,6));</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="comment">// =============initialize parameters=============//</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <a class="code" href="struct_points_map.html">PointsMap</a>* map_new = <span class="keyword">new</span> <a class="code" href="struct_points_map.html">PointsMap</a>();</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>              = <a class="code" href="class_c_s_l_a_m.html#a60acccdb7e1218467b1c3ced7a4b1673">ID</a>++;    </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a78671723ce6091850c99def8eb748096">isVisible</a>       = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">isMatching</a>      = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a11c75def31fe39819316f7daea81d056">isLoop</a>          = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">nPredictTimes</a>   = 0;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a26f38c34229bdd548218e3860f258078">nMatchTimes</a>     = 0;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.x           = Hlw_x + cam_position.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0]; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.y           = Hlw_y + cam_position.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.z           = Hlw_z + cam_position.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0];</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">initPixel</a>       = uvd;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a80b7f22487b8ac001df92147f6012344">initTrans</a>       = cam_position;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a09a542b38718813db3700c718cf0e073">initRotation</a>    = Rwc;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a8ffd7123565d166884f81331a0a8e0a3">initPatch</a>       = 1*image(Rect(cvRound(uvd.x)-<a class="code" href="class_c_s_l_a_m.html#a8db26541a4c9938bd06ca111cb6b434f">HP_INIT_W</a>, cvRound(uvd.y)-<a class="code" href="class_c_s_l_a_m.html#ab2c48c4b1c3f536fb066d014ad262e27">HP_INIT_H</a>,</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                                   2*<a class="code" href="class_c_s_l_a_m.html#a8db26541a4c9938bd06ca111cb6b434f">HP_INIT_W</a>+1, 2*<a class="code" href="class_c_s_l_a_m.html#ab2c48c4b1c3f536fb066d014ad262e27">HP_INIT_H</a>+1));</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a0e3b07d928db32f6a7816a88a09584e7">matchPatch</a>      = Mat::zeros(2*<a class="code" href="class_c_s_l_a_m.html#a433d23784c33370acb9937fe2c2e85a4">HP_MATCH_W</a>+1, 2*<a class="code" href="class_c_s_l_a_m.html#ad3b702b958ce4e2bfd6a1b834e553b9b">HP_MATCH_H</a>+1, CV_8U);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        map_new-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a> = NULL;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <span class="keywordflow">if</span> ((0 == i) &amp;&amp; ((1 == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>) || (TRUE == <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a>))) <span class="comment">// ======判断头结点????????</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        {</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a> =  map_new;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        } </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <a class="code" href="struct_points_map.html">PointsMap</a>* map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>; <span class="comment">//=========此法效率较低????????</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            <span class="keywordflow">while</span>(<a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>)</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a> = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            }</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a> = map_new;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a> = map_p;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">if</span> ((TRUE == <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a>) &amp;&amp; (0 != <a class="code" href="class_c_s_l_a_m.html#a3378ec8c558880dcb28a44a8c491d72e">m_loopPointCounter</a>))</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        Mat x_store, s_store;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        Mat state = Mat::zeros(6, 1, CV_64F);</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        Mat sr    = Mat::zeros(6, 6, CV_64F);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="class_c_s_l_a_m.html#a3378ec8c558880dcb28a44a8c491d72e">m_loopPointCounter</a>; i++)</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            vector&lt;FeatureInfo&gt;::iterator iter = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.begin();</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            <span class="keywordtype">int</span> j = 0;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <span class="keywordflow">while</span> (<a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j].<a class="code" href="class_c_s_l_a_m.html#a60acccdb7e1218467b1c3ced7a4b1673">ID</a> != <a class="code" href="class_c_s_l_a_m.html#a1c25c2a3a17c0d266ae10294ebbff455">m_loopPointID</a>.ptr&lt;<span class="keywordtype">int</span>&gt;(i)[0])</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                j++;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                iter++;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;            x_store = Mat::zeros(dim+6, 1, CV_64F);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            s_store = Mat::zeros(dim+6, dim+6, CV_64F);</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            <span class="comment">// Add the observed features into state and covariance</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;            state = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[i].state;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            sr    = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[i].sr;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(0,dim-4).copyTo(x_store.rowRange(0,dim-4));</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            state.copyTo(x_store.rowRange(dim-4,dim+2));</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(dim-4,dim).copyTo(x_store.rowRange(dim+2,dim+6));</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            x_store.copyTo(<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(0,dim-4),Range(0,dim-4)).copyTo(s_store(Range(0,dim-4),Range(0,dim-4)));</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(0,dim-4),Range(dim-4,dim)).copyTo(s_store(Range(0,dim-4),Range(dim+2,dim+6)));</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(dim-4,dim),Range(0,dim-4)).copyTo(s_store(Range(dim+2,dim+6),Range(0,dim-4)));</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(dim-4,dim),Range(dim-4,dim)).copyTo(s_store(Range(dim+2,dim+6),Range(dim+2,dim+6)));</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            sr.copyTo(s_store(Range(dim-4,dim+2),Range(dim-4,dim+2)));</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            s_store.copyTo(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="comment">// update map</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <a class="code" href="struct_points_map.html">PointsMap</a>* map_new = <span class="keyword">new</span> <a class="code" href="struct_points_map.html">PointsMap</a>();</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>              = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j].ID;   </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a78671723ce6091850c99def8eb748096">isVisible</a>       = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">isMatching</a>      = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a11c75def31fe39819316f7daea81d056">isLoop</a>          = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">nPredictTimes</a>   = 0;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a26f38c34229bdd548218e3860f258078">nMatchTimes</a>     = 0;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>             = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j].initXYZ;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">initPixel</a>       = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j].initPixel;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a80b7f22487b8ac001df92147f6012344">initTrans</a>       = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j].initTrans;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a09a542b38718813db3700c718cf0e073">initRotation</a>    = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j].initRotation;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a8ffd7123565d166884f81331a0a8e0a3">initPatch</a>       = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[j].initPatch;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a0e3b07d928db32f6a7816a88a09584e7">matchPatch</a>      = Mat::zeros(2*<a class="code" href="class_c_s_l_a_m.html#a433d23784c33370acb9937fe2c2e85a4">HP_MATCH_W</a>+1, 2*<a class="code" href="class_c_s_l_a_m.html#ad3b702b958ce4e2bfd6a1b834e553b9b">HP_MATCH_H</a>+1, CV_8U);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            map_new-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>            = NULL;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            iter = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.erase(iter);</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <a class="code" href="struct_points_map.html">PointsMap</a>* map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            <span class="keywordflow">while</span> (<a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            {</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a> = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            }</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a> = map_new;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a> = map_p;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        }</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a080b1ac1897d4eeb077517a24369527a">getPermutationMatrix</a>();</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    }</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    vector&lt;KeyPoint&gt;().swap(<a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;}</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div>
<div class="line"><a name="l01031"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a6a2e5ad9c88939b5a16671594cc93e62"> 1031</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a6a2e5ad9c88939b5a16671594cc93e62">CSLAM::getTransferMatrix</a>(Mat &amp;Rwc, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;theta)<span class="keyword"> const</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    Rwc = (Mat_&lt;double&gt;(3,3) &lt;&lt;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        cos(theta), -sin(theta), 0,</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        sin(theta), cos(theta), 0,</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        0, 0, 1);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;}</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a469c1e2668e535b3832eac150de1de20"> 1050</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a469c1e2668e535b3832eac150de1de20">CSLAM::calculateSampleParameter</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> &amp; Na)</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;{</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a1840fed96070a8f30481cc5e50c8c8f3">Kappa</a>  = 0;<span class="comment">//pow(1.0/3.0, Na);</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a5cf6d2b51f3fa6718e7bdf03e2031c5c">Lammda</a> = pow(<a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a58923d88cfd810ef420737f7106f52c2">Alpha</a>, 2)*(Na + <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a1840fed96070a8f30481cc5e50c8c8f3">Kappa</a>) - Na;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ab6ee72fdd7511006a2408e5363b85003">Gamma</a>  = sqrt(Na+<a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a5cf6d2b51f3fa6718e7bdf03e2031c5c">Lammda</a>);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a412391eb8084226b2c57fa67ea1b9c24">wm0</a>    = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a5cf6d2b51f3fa6718e7bdf03e2031c5c">Lammda</a>/(Na + <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a5cf6d2b51f3fa6718e7bdf03e2031c5c">Lammda</a>);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a893d5b42e5bdd1a5a1c0734289471373">wc0</a>    = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a412391eb8084226b2c57fa67ea1b9c24">wm0</a> + (1 - pow(<a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a58923d88cfd810ef420737f7106f52c2">Alpha</a>,2) + <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac091f56ac336b70e7b783c2eedbcf7c2">Beta</a>);</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#adc5a7778dd705f7ea770e4140c116924">wi</a>     = 1.0/(2*(Na+<a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a5cf6d2b51f3fa6718e7bdf03e2031c5c">Lammda</a>));</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="comment">//m_sample.wm0    = m_sample.Lammda/3.0;</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="comment">//m_sample.wc0    = m_sample.Lammda/3.0;</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="comment">//m_sample.wi     = 1.0/6.0;</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="class_c_s_l_a_m.html#a1da3ef03133006f33d757f3963439279">m_weightType</a>)</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    {</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">case</span> 0: <span class="comment">// From: SRUKF (author: Murray, et al.)</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        {</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>    = 1.0 - Na/3.0;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a28e30bbd4f4c912f3ea6508494a70f78">wm0_sr</a> = sqrt(abs(<a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>));</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#aa18f6aa67da1d91ece58d37976f3aac6">wc0</a>    = 1.0 - Na/3.0;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#abe6cd86e4b6d95b3a69c6d7e14186884">wc0_sr</a> = sqrt(abs(<a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>));</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>     = (1.0 - <a class="code" href="class_c_s_l_a_m.html#aa18f6aa67da1d91ece58d37976f3aac6">wc0</a>)/(2*Na);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a0344cc3ecdb1d702898ee35dd335197e">wi_sr</a>  = sqrt(<a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a498649955c5c3038c5b134a763f58c54">gamma</a>  = sqrt(Na/(1.0 - <a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>));</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;            </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        }</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">case</span> 1: <span class="comment">// From: UKF (edition: 2000)</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        {</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a498649955c5c3038c5b134a763f58c54">gamma</a>  = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ab6ee72fdd7511006a2408e5363b85003">Gamma</a>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>    = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a412391eb8084226b2c57fa67ea1b9c24">wm0</a>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a28e30bbd4f4c912f3ea6508494a70f78">wm0_sr</a> = sqrt(abs(<a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a412391eb8084226b2c57fa67ea1b9c24">wm0</a>));</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#aa18f6aa67da1d91ece58d37976f3aac6">wc0</a>    = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a893d5b42e5bdd1a5a1c0734289471373">wc0</a>;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#abe6cd86e4b6d95b3a69c6d7e14186884">wc0_sr</a> = sqrt(abs(<a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#a893d5b42e5bdd1a5a1c0734289471373">wc0</a>));</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>     = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#adc5a7778dd705f7ea770e4140c116924">wi</a>;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a0344cc3ecdb1d702898ee35dd335197e">wi_sr</a>  = sqrt(abs(<a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#adc5a7778dd705f7ea770e4140c116924">wi</a>));</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        }</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">case</span> 2: <span class="comment">// From: UKF (edition: 2004)</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a498649955c5c3038c5b134a763f58c54">gamma</a>  = sqrt(3.0*Na/2.0);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>    = 1.0/3.0;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a28e30bbd4f4c912f3ea6508494a70f78">wm0_sr</a> = sqrt(<a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#aa18f6aa67da1d91ece58d37976f3aac6">wc0</a>    = 1.0/3.0;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#abe6cd86e4b6d95b3a69c6d7e14186884">wc0_sr</a> = sqrt(<a class="code" href="class_c_s_l_a_m.html#aa18f6aa67da1d91ece58d37976f3aac6">wc0</a>);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>     = 1.0/(3.0*Na);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a0344cc3ecdb1d702898ee35dd335197e">wi_sr</a>  = sqrt(<a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;}</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a1910581735af07c86f936053daf0cbea"> 1123</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a1910581735af07c86f936053daf0cbea">CSLAM::expandMatrix</a> (Mat &amp;mu, Mat &amp;sr, <span class="keyword">const</span> Mat &amp;mu1, <span class="keyword">const</span> Mat &amp;sr1, <span class="keyword">const</span> Mat &amp;mu2,</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keyword">const</span> Mat &amp;sr2)<span class="keyword"> const</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordtype">int</span> dim1 = mu1.rows;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordtype">int</span> dim2 = mu2.rows;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keywordtype">int</span> dim  = dim1 + dim2;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    mu1.copyTo(mu.rowRange(Range(0,dim1)));</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    mu2.copyTo(mu.rowRange(Range(dim1,dim)));</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    sr1.copyTo(sr(Range(0,dim1), Range(0,dim1)));</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    sr2.copyTo(sr(Range(dim1,dim), Range(dim1,dim)));</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;}</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div>
<div class="line"><a name="l01148"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#af64580d03f6d861b18e7b7e44cf1728a"> 1148</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#af64580d03f6d861b18e7b7e44cf1728a">CSLAM::generateSigmaPoints</a> (Mat &amp;sigma, <span class="keyword">const</span> Mat &amp;mu, <span class="keyword">const</span> Mat &amp;sr)</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;{</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="keywordtype">int</span> Na    = mu.rows;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    mu.copyTo(sigma.col(0));</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    Mat element(Na, 1, CV_64F);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Na; i++)</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    {</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        element = sr.row(i).t() + 0;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        addWeighted(mu, 1, element, <a class="code" href="class_c_s_l_a_m.html#a498649955c5c3038c5b134a763f58c54">gamma</a>, 0, sigma.col(i+1));</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        addWeighted(mu, 1, element, (-1)*<a class="code" href="class_c_s_l_a_m.html#a498649955c5c3038c5b134a763f58c54">gamma</a>, 0, sigma.col(Na+i+1)); </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    }   </div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;}</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01177"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a22c2f1462fcefbd19224c60269577209"> 1177</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a22c2f1462fcefbd19224c60269577209">CSLAM::passSigmaThroughMapingFunction</a> (Mat &amp;sigma_out, Mat &amp;mu_Hlw, Mat &amp;mu_angle, <span class="keyword">const</span> Mat &amp;sigma_in)</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;{ </div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordtype">int</span> dim   = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;     <span class="comment">// normal order of state vector before augmented</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordtype">int</span> Na    = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="keywordtype">int</span> nCols = 2*Na + 1;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="comment">//===========Generate augmented sigma-points=================//</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    Mat cam_position = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(dim-4,dim-1) + 0; </div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    sigma_out.rowRange(Range(0,dim)) = sigma_in.rowRange(Range(0,dim)) + 0;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="comment">//sigma_in.rowRange(Range(0,dim)).copyTo(sigma_out.rowRange(Range(0,dim))); </span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="comment">//repeat(cam_position, 1, nCols, sigma_out.rowRange(Range(N-3, N)));</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    Point2d uvu, uvd;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordtype">int</span> index_in, index_out1, index_out2, index_Hlw;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordtype">double</span> rho;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    Mat Hlr, Hlw, state, position, Rwc;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    Mat mu(3*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>, 1, CV_64F);</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    Mat x_new(dim+6*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>, 1, CV_64F);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    Mat sigma_Hlw(3*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>, nCols, CV_64F);</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    Mat sigma_angle(3*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>, nCols, CV_64F);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    Mat element_Hlw(3*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>, 1, CV_64F);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    Mat element_angle(3*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>, 1, CV_64F);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nCols; i++)</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    {</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        position = sigma_in(Range(dim-4,dim-1), Range(i,i+1));</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a6a2e5ad9c88939b5a16671594cc93e62">getTransferMatrix</a>(Rwc, sigma_in.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[i]);</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span>=0; <span class="keywordtype">id</span>&lt;<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>; <span class="keywordtype">id</span>++)</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        {</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            index_in    = dim + 3*id;                             <span class="comment">// index of sigma_in points</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            index_out1  = index_in;                               <span class="comment">// index of angle in sigma_out points</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            index_out2  = index_in + 3*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>;                <span class="comment">// index of location in sigma_out points</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            index_Hlw   = 3*id;                                   <span class="comment">// index of Hlw set</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            uvd.x = sigma_in.ptr&lt;<span class="keywordtype">double</span>&gt;(index_in+0)[i];</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            uvd.y = sigma_in.ptr&lt;<span class="keywordtype">double</span>&gt;(index_in+1)[i];</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            rho   = sigma_in.ptr&lt;<span class="keywordtype">double</span>&gt;(index_in+2)[i];</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a0dfc931db26c1fed0892384c086f40f8">undistortOnePointRW</a>(uvu, uvd);</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a86bf11bd122694e1b4950bcb8f78f87b">coordinatesImage2Camera</a>(Hlr, uvu);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ad1df413b1dae707612b6bb47b20c8f4f">coordinatesCamera2World</a>(Hlw, Hlr, Rwc); </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ae0f220bb7df0075321b3abfcd39a05ba">coordinatesWorld2State</a>(state, Hlw, rho);</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            state.copyTo(sigma_out(Range(index_out1,index_out1+3), Range(i,i+1)));</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;            position.copyTo(sigma_out(Range(index_out2,index_out2+3), Range(i,i+1)));</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            sigma_Hlw(Range(index_Hlw, index_Hlw+3), Range(i,i+1))   = Hlw   + 0;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;            sigma_angle(Range(index_Hlw, index_Hlw+3), Range(i,i+1)) = state + 0;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        }</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        element_Hlw   = sigma_Hlw.col(i);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        element_angle = sigma_angle.col(i);</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordflow">if</span> (!i)</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        {</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            addWeighted(element_Hlw, <a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>, mu_Hlw, 0, 0, mu_Hlw);</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            addWeighted(element_angle, <a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>, mu_angle, 0, 0, mu_angle);</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        }</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        {</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;            addWeighted(element_Hlw, <a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>, mu_Hlw, 1, 0, mu_Hlw);</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;            addWeighted(element_angle, <a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>, mu_angle, 1, 0, mu_angle);</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        }</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    }</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="comment">//========Update the state vector=============//</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.copyTo(x_new.rowRange(Range(0,dim)));</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    mu_angle.copyTo(x_new.rowRange(Range(dim,Na)));  <span class="comment">// state vector of disordered //======是否只需计算一部分???????</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    repeat(cam_position, <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>, 1, x_new.rowRange(Range(Na,dim+6*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>)));</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    x_new.copyTo(<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>);</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;}</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div>
<div class="line"><a name="l01260"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a015dbfd65b5014a17be3da7594015dc8"> 1260</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a015dbfd65b5014a17be3da7594015dc8">CSLAM::QrAndCholeskyForInitilization</a> (<span class="keyword">const</span> Mat &amp;sigma)</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;{</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;       <span class="comment">// disordered </span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordtype">int</span> Na  = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>; </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="comment">// ========== prepare matrix for QR decomposition ==============//</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordtype">int</span> dimx = 2*Na;  <span class="comment">//==========用公式加速??????????</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordtype">int</span> dimy = dim;  </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    Mat QR(dimx, dimy, CV_64F);      <span class="comment">// =========验证用，可删除???????????</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    Mat sigma0 = sigma.col(0) + 0;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; dimx; i++)</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    {</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        QR.row(i) = <a class="code" href="class_c_s_l_a_m.html#a0344cc3ecdb1d702898ee35dd335197e">wi_sr</a>*(sigma.col(i+1) - sigma0).t();</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    }</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318">GSLQrDecomposition</a>(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>, QR);</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="comment">//GSLModifiedQRDecomposition(m_S_k,QR);</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="comment">//================== get the permutation matrix ===============//</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordflow">if</span> (1 == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>)</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    {</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a080b1ac1897d4eeb077517a24369527a">getPermutationMatrix</a>();</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    }</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="keywordflow">else</span> </div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    {</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        <span class="keywordflow">if</span> (0 != <a class="code" href="class_c_s_l_a_m.html#a3d2b94fa175e76bf49fb5e88539a286e">m_nAddings</a>)</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        {</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a080b1ac1897d4eeb077517a24369527a">getPermutationMatrix</a>();</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        }</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    }</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="comment">//============Reorder the state vector ============//</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a> = <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>*<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>; <span class="comment">// normal order</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318">GSLQrDecomposition</a>(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>, <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>*<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>*<a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.t());</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="comment">//m_S_k = m_permutation*m_S_k*m_permutation.t();</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="comment">//Mat sr_store(dim, dim, CV_64F);</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="comment">//GSLQrDecomposition(sr_store, m_S_k);</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="comment">//sr_store.copyTo(m_S_k);</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;}</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">// Get the permutation matrix to make the disordered state vector into normal order</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a080b1ac1897d4eeb077517a24369527a"> 1303</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a080b1ac1897d4eeb077517a24369527a">CSLAM::getPermutationMatrix</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;{   </div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;  <span class="comment">//========可删除z、rho?????????</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a> = Mat::zeros(dim, dim, CV_64F);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordtype">int</span> dimOld = dim - 6*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>;  <span class="comment">// Dimension of state vector before adding features</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordtype">int</span> M      = <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="keywordflow">if</span> (dimOld != 4)                                                            <span class="comment">// for unchanged part</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    {</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        Mat I = Mat::eye(dimOld-4, dimOld-4, CV_64F);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        I.copyTo(<a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>(Range(0,dimOld-4), Range(0,dimOld-4)));</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    }</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="comment">// For robot&#39;s pose</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-4)[dimOld-4] = 1; <span class="comment">// x                         </span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-3)[dimOld-3] = 1; <span class="comment">// y</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-2)[dimOld-2] = 1; <span class="comment">// z</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[dimOld-1] = 1; <span class="comment">// theta</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; M; <span class="keywordtype">id</span>++)</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    {</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        <span class="comment">// For features&#39; parameters</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dimOld-4+6*<span class="keywordtype">id</span>+0)[dimOld+3*M+3*<span class="keywordtype">id</span>+0] = 1; <span class="comment">// x</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dimOld-4+6*<span class="keywordtype">id</span>+1)[dimOld+3*M+3*<span class="keywordtype">id</span>+1] = 1; <span class="comment">// y</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dimOld-4+6*<span class="keywordtype">id</span>+2)[dimOld+3*M+3*<span class="keywordtype">id</span>+2] = 1; <span class="comment">// z</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dimOld-4+6*<span class="keywordtype">id</span>+3)[dimOld+3*<span class="keywordtype">id</span>+0]     = 1; <span class="comment">// theta</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dimOld-4+6*<span class="keywordtype">id</span>+4)[dimOld+3*<span class="keywordtype">id</span>+1]     = 1; <span class="comment">// phi</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dimOld-4+6*<span class="keywordtype">id</span>+5)[dimOld+3*<span class="keywordtype">id</span>+2]     = 1; <span class="comment">// tho</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    }</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;}</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div>
<div class="line"><a name="l01343"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a2ffb021f1b1b4b171df2af17f3e44c7b"> 1343</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a2ffb021f1b1b4b171df2af17f3e44c7b">CSLAM::predictMotion</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;{</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="keywordflow">if</span> (1 == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>)</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    {</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a> = <a class="code" href="class_c_s_l_a_m.html#adfa9dfa0f11f11b7f5a9af9dbadcd44c">m_nStore4Show</a>;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#abfc34157a6efd2f4b4b2e6ac7b28c7af">m_nShowMap</a> = <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    }</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#ab11a61ec5156132efd0b15fd26a80ebb">index</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>]);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="comment">// ============ For robot&#39;s redirection ========= //</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordflow">if</span> (1 == <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>])</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="comment">// Adding the redirection features into the vector</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <a class="code" href="struct_feature_info.html">FeatureInfo</a> featuresInfo;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <a class="code" href="struct_points_map.html">PointsMap</a>* map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <span class="keywordflow">while</span> (NULL != map_p)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        {</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#a509765ef838afe279272eb5c309159b8">ID</a>            = map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#a961832690c6e4ce72a7b713aac02d64b">isLoop</a>        = map_p-&gt;<a class="code" href="struct_points_map.html#a11c75def31fe39819316f7daea81d056">isLoop</a>;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#ad208f9f4a66295dde14512e18c06edd1">nPredictTimes</a> = map_p-&gt;<a class="code" href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">nPredictTimes</a>;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#ae951d77383d7f4e677f3d2a015033ea1">nMatchTimes</a>   = map_p-&gt;<a class="code" href="struct_points_map.html#a26f38c34229bdd548218e3860f258078">nMatchTimes</a>;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#aff5e4c938733c62b57087d04e696a1c3">initXYZ</a>       = map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#ab6b7d2cfc33e83dfed371baedcc0f05b">initPixel</a>     = map_p-&gt;<a class="code" href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">initPixel</a>;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#a66ce45d13e9e9f2c7ba4f876bad43abd">initTrans</a>     = map_p-&gt;<a class="code" href="struct_points_map.html#a80b7f22487b8ac001df92147f6012344">initTrans</a>;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#a253d7884f9e20e30782e54edad705a0d">initRotation</a>  = map_p-&gt;<a class="code" href="struct_points_map.html#a09a542b38718813db3700c718cf0e073">initRotation</a>;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#a561b52cdb649d471fc98288b445af6b7">initPatch</a>     = map_p-&gt;<a class="code" href="struct_points_map.html#a8ffd7123565d166884f81331a0a8e0a3">initPatch</a>;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;            featuresInfo.<a class="code" href="struct_feature_info.html#a99e98689f3aa603d834c21d0c60095af">state</a>         = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(6*<span class="keywordtype">id</span>, 6*<span class="keywordtype">id</span>+6) + 0;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ac9e33202210b195caa0aa290efc4821b">getFeatureCartesianInformation</a>(featuresInfo.<a class="code" href="struct_feature_info.html#a5d574a7c4b2e616ceadcf14d2bac337f">position</a>, featuresInfo.<a class="code" href="struct_feature_info.html#ab38be032519b9b3d7d2f06373085f1d5">sr</a>, featuresInfo.<a class="code" href="struct_feature_info.html#afe83757d66c4b0e3da84b87a41b65b0b">cov</a>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a6a1a915046eb327cb33a4424eda2bdcc">get3DdisplayInformation</a>(featuresInfo.<a class="code" href="struct_feature_info.html#a35b34ee971e21ea92a6a0450fab5f820">axis</a>, featuresInfo.<a class="code" href="struct_feature_info.html#a702d21bc7e546a8eed0165cf8f8af51a">sigma</a>, featuresInfo.<a class="code" href="struct_feature_info.html#afe83757d66c4b0e3da84b87a41b65b0b">cov</a>);</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.push_back(featuresInfo);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;            <span class="keywordtype">id</span>++;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;            map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        }</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        <span class="comment">// Loading new iamge and start a new SLAM process</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#aabca4a31778783a06d2299f1d6bcb933">FLAG_4_VIDEO</a> == <a class="code" href="class_c_s_l_a_m.html#a0c00128b360f006e4afee34748ee341c">m_playType</a>)</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        {</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a> = cvQueryFrame(<a class="code" href="class_c_s_l_a_m.html#aa4dec06804947efe52110a24ffc9a429">m_capture</a>);</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        } </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        {</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;            <span class="keywordtype">char</span> image_name[100];</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            sprintf_s(image_name, <a class="code" href="class_c_s_l_a_m.html#a5fbe026390eb088cfa688e7703d27d65">image_dir</a>, <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#ab11a61ec5156132efd0b15fd26a80ebb">index</a>);</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a> = cvLoadImage(image_name);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        }</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        cvCvtColor(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, <a class="code" href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">m_gryImage</a>, CV_RGB2GRAY);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <span class="comment">// Initilize all parameters for the new cycle</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">m_initPos</a> = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows-4, <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows-2) + 0;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a> = Mat::zeros(4, 1, CV_64F);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">m_initPos</a>.copyTo(<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(0,2));</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(3)[0] = <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>];</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a> = Mat::zeros(4, 4, CV_64F);</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] = <a class="code" href="class_c_s_l_a_m.html#aba4fa1d56a107c695336ddcf74b993df">m_sigmaX</a>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[1] = <a class="code" href="class_c_s_l_a_m.html#a5ee80e07f7e5495a4c417aa29ca82b09">m_sigmaY</a>;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[2] = <a class="code" href="class_c_s_l_a_m.html#a42b7d3d199787009a5825ad9ed61076d">m_sigmaZ</a>;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(3)[3] = <a class="code" href="class_c_s_l_a_m.html#a1320f334365b4195cf17dc6648dafc61">m_sigmaTheta</a>;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a7b892f4223a321329a022e2d0fb9421b">m_nStoreMap</a>      = <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a515d1f5fbd66d9933889c55e192f7866">m_nStorePredicts</a> = <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#afd5af89231ef7c63336599eff5fca431">m_nStoreMatches</a>  = <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>     = 0;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aa0230002110863d766bbb269b51a64c8">m_nDeletes</a>     = 0;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a> = 0;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>    = 0;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>     = 0;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a> = TRUE;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#af427595554668e8e106c0d21f2a534d4">addFeatures</a>();</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">isAdding</a> = FALSE;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#abfc34157a6efd2f4b4b2e6ac7b28c7af">m_nShowMap</a> = <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a> + <a class="code" href="class_c_s_l_a_m.html#a7b892f4223a321329a022e2d0fb9421b">m_nStoreMap</a>;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>++;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#ab11a61ec5156132efd0b15fd26a80ebb">index</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>]);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[0] = <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>];</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    }</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="comment">// ============Motion prediction========== //</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a> = dim + 3 + 2;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordtype">int</span> Na  = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    Mat Z2 = Mat::zeros(2, 1, CV_64F);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    Mat Z3 = Mat::zeros(3, 1, CV_64F);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    Mat mu1(dim+3, 1, CV_64F);</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    Mat mu(Na, 1, CV_64F);</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    Mat sr1 = Mat::zeros(dim+3, dim+3, CV_64F);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    Mat sr  = Mat::zeros(Na, Na, CV_64F);</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a> = Mat::zeros(Na, 2*Na+1, CV_64F);</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordtype">int</span> index = 2*<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordtype">double</span> dx    = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+0) - *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index-2);</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keywordtype">double</span> dy    = *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+1) - *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index-1);</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="keywordtype">double</span> rot1  = atan2(dy, dx) - <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>-1];</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordtype">double</span> trans = sqrt(dy*dy + dx*dx);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordtype">double</span> rot2  = <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>] - <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>-1] - rot1;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8185f0d150a19c5eb32f2fb31328f1da">Ut</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] = rot1;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8185f0d150a19c5eb32f2fb31328f1da">Ut</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] = trans;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8185f0d150a19c5eb32f2fb31328f1da">Ut</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0] = rot2;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7fe436c059d203549dbe5beb2ff8821a">Mt</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] = <a class="code" href="class_c_s_l_a_m.html#a813e1ea18c829576899fc1a0c37520ca">a1</a>*rot1*rot1   + <a class="code" href="class_c_s_l_a_m.html#aa86127f1bab10c2d4a49f20217ae861c">a2</a>*trans*trans;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7fe436c059d203549dbe5beb2ff8821a">Mt</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[1] = <a class="code" href="class_c_s_l_a_m.html#af4c7303a8d6e8d709f01e351495b6680">a3</a>*trans*trans + <a class="code" href="class_c_s_l_a_m.html#a635bb274a586efe93488eab382f0a6ee">a4</a>*rot1*rot1 + <a class="code" href="class_c_s_l_a_m.html#a635bb274a586efe93488eab382f0a6ee">a4</a>*rot2*rot2;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7fe436c059d203549dbe5beb2ff8821a">Mt</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[2] = <a class="code" href="class_c_s_l_a_m.html#a813e1ea18c829576899fc1a0c37520ca">a1</a>*rot2*rot2   + <a class="code" href="class_c_s_l_a_m.html#aa86127f1bab10c2d4a49f20217ae861c">a2</a>*trans*trans;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a469c1e2668e535b3832eac150de1de20">calculateSampleParameter</a>(Na);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1910581735af07c86f936053daf0cbea">expandMatrix</a>(mu1, sr1, <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>, <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>, Z3, <a class="code" href="class_c_s_l_a_m.html#a7fe436c059d203549dbe5beb2ff8821a">Mt</a>);</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1910581735af07c86f936053daf0cbea">expandMatrix</a>(mu, sr, mu1, sr1, Z2, <a class="code" href="class_c_s_l_a_m.html#a8c26ea2610fd6c50546658793c866d73">Qt</a>);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#af64580d03f6d861b18e7b7e44cf1728a">generateSigmaPoints</a>(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>, mu, sr);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#af798403a39b54a6b9d495927f146c72b">passSigmaThroughMotionFunction</a>(<a class="code" href="class_c_s_l_a_m.html#a8185f0d150a19c5eb32f2fb31328f1da">Ut</a>);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aa8696a8dc1f76e7b597c33365503e7df">QrAndCholeskyForMotion</a>(); </div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;}</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div>
<div class="line"><a name="l01476"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#af798403a39b54a6b9d495927f146c72b"> 1476</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#af798403a39b54a6b9d495927f146c72b">CSLAM::passSigmaThroughMotionFunction</a> (<span class="keyword">const</span> Mat &amp;Ut)</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;{</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="keywordtype">int</span> dim   = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="keywordtype">int</span> Na    = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="keywordtype">int</span> nCols = 2*Na + 1; </div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="comment">// ==========Generate sigma-points=========== //</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keywordtype">double</span> rot1, trans, rot2;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    Mat element_update(4, 1, CV_64F);</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    Mat element(4, 1, CV_64F);</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    Mat mu(4, 1, CV_64F);</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    </div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nCols; i++)</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    {</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#a9774a298be987d8f58670a3f66f3d4af">FLAG_4_NOISE1</a> == <a class="code" href="class_c_s_l_a_m.html#a7dbebfd2d58ae738b8317e697dfad87e">m_noiseType</a>)</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        {</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;            rot1  = Ut.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] - <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim+0)[i];<span class="comment">//*m_sigma.ptr&lt;double&gt;(dim+0)[i];</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;            trans = Ut.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] - <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim+1)[i];<span class="comment">//*m_sigma.ptr&lt;double&gt;(dim+1)[i];</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            rot2  = Ut.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0] - <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim+2)[i];<span class="comment">//*m_sigma.ptr&lt;double&gt;(dim+2)[i];</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            <span class="comment">//rot1  = Ut.ptr&lt;double&gt;(0)[0] - Mt.ptr&lt;double&gt;(0)[0];//*m_sigma.ptr&lt;double&gt;(dim+0)[i];</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            <span class="comment">//trans = Ut.ptr&lt;double&gt;(1)[0] - Mt.ptr&lt;double&gt;(1)[1];//*m_sigma.ptr&lt;double&gt;(dim+1)[i];</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            <span class="comment">//rot2  = Ut.ptr&lt;double&gt;(2)[0] - Mt.ptr&lt;double&gt;(2)[2];//*m_sigma.ptr&lt;double&gt;(dim+2)[i];</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            <span class="comment">//rot1  = Ut.ptr&lt;double&gt;(0)[0] - Gaussian(m_sigma.ptr&lt;double&gt;(dim+0)[i]);//*m_sigma.ptr&lt;double&gt;(dim+0)[i];</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            <span class="comment">//trans = Ut.ptr&lt;double&gt;(1)[0] - Gaussian(m_sigma.ptr&lt;double&gt;(dim+1)[i]);//*m_sigma.ptr&lt;double&gt;(dim+1)[i];</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;            <span class="comment">//rot2  = Ut.ptr&lt;double&gt;(2)[0] - Gaussian(m_sigma.ptr&lt;double&gt;(dim+2)[i]);//*m_sigma.ptr&lt;double&gt;(dim+2)[i];</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;            <span class="comment">//rot1  = Ut.ptr&lt;double&gt;(0)[0] - Gaussian(Mt.ptr&lt;double&gt;(0)[0]);//*m_sigma.ptr&lt;double&gt;(dim+0)[i];</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;            <span class="comment">//trans = Ut.ptr&lt;double&gt;(1)[0] - Gaussian(Mt.ptr&lt;double&gt;(1)[1]);//*m_sigma.ptr&lt;double&gt;(dim+1)[i];</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;            <span class="comment">//rot2  = Ut.ptr&lt;double&gt;(2)[0] - Gaussian(Mt.ptr&lt;double&gt;(2)[2]);//*m_sigma.ptr&lt;double&gt;(dim+2)[i];</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        } </div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#a20e95a943836ee3d608b7569f0419c0e">FLAG_4_NOISE2</a> == <a class="code" href="class_c_s_l_a_m.html#a7dbebfd2d58ae738b8317e697dfad87e">m_noiseType</a>)</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        {</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            rot1  = Ut.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] - <a class="code" href="class_c_s_l_a_m.html#a5d131c5a0ebbd1efd2e489c3067f588f">Gauss</a>(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim+0)[i]);<span class="comment">//*m_sigma.ptr&lt;double&gt;(dim+0)[i]);</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            trans = Ut.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] - <a class="code" href="class_c_s_l_a_m.html#a5d131c5a0ebbd1efd2e489c3067f588f">Gauss</a>(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim+1)[i]);<span class="comment">//*m_sigma.ptr&lt;double&gt;(dim+1)[i]);</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            rot2  = Ut.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0] - <a class="code" href="class_c_s_l_a_m.html#a5d131c5a0ebbd1efd2e489c3067f588f">Gauss</a>(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim+2)[i]);<span class="comment">//*m_sigma.ptr&lt;double&gt;(dim+2)[i]);</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        }</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#ad8df79b72807a2dfb9ec7aa171022fd3">FLAG_4_NOISE3</a> == <a class="code" href="class_c_s_l_a_m.html#a7dbebfd2d58ae738b8317e697dfad87e">m_noiseType</a>)</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        {</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;            rot1  = Ut.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] - <a class="code" href="class_c_s_l_a_m.html#abcc8f667e3c0ad60490a4b6ff10ce7ef">rng</a>.gaussian(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim+0)[i]);<span class="comment">//*m_sigma.ptr&lt;double&gt;(dim+0)[i]);</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;            trans = Ut.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] - <a class="code" href="class_c_s_l_a_m.html#abcc8f667e3c0ad60490a4b6ff10ce7ef">rng</a>.gaussian(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim+1)[i]);<span class="comment">//*m_sigma.ptr&lt;double&gt;(dim+1)[i]);</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            rot2  = Ut.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0] - <a class="code" href="class_c_s_l_a_m.html#abcc8f667e3c0ad60490a4b6ff10ce7ef">rng</a>.gaussian(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim+2)[i]);<span class="comment">//*m_sigma.ptr&lt;double&gt;(dim+2)[i]);</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        }</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        element_update.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] = trans*cos(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[i] + rot1);</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        element_update.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] = trans*sin(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[i] + rot1);</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        element_update.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0] = 0;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        element_update.ptr&lt;<span class="keywordtype">double</span>&gt;(3)[0] = rot1 + rot2;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>(Range(dim-4,dim),Range(i,i+1)) += element_update; </div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        element = <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>(Range(dim-4,dim), Range(i,i+1)) + 0;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <span class="keywordflow">if</span> (!i)</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;            addWeighted(element, <a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>, mu, 0, 0, mu);</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            addWeighted(element, <a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>, mu, 1, 0, mu);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    }</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    mu.copyTo(<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(Range(dim-4,dim)));</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;}</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div>
<div class="line"><a name="l01539"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#aa8696a8dc1f76e7b597c33365503e7df"> 1539</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#aa8696a8dc1f76e7b597c33365503e7df">CSLAM::QrAndCholeskyForMotion</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;{</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="keywordtype">int</span> dim  = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;       </div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="keywordtype">int</span> Na   = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>; <span class="comment">// augmented dim of sigma points before passing through func </span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="keywordtype">int</span> dimx = 2*Na;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keywordtype">int</span> dimy = dim;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="comment">// ================================== //</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    Mat QR(dimx, dimy, CV_64F); </div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    Mat sigma0 = <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>(Range(0,dim), Range(0,1)) + 0;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; dimx; i++)</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    {</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        QR.row(i) = <a class="code" href="class_c_s_l_a_m.html#a0344cc3ecdb1d702898ee35dd335197e">wi_sr</a>*(<a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>(Range(0,dim), Range(i+1,i+2)) - sigma0).t();</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    }</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="comment">//============此处可加速????????????</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318">GSLQrDecomposition</a>(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>, QR);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="comment">//GSLModifiedQRDecomposition(m_S_k, QR);</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="comment">// ================================== //</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="comment">// ================================== //</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="comment">//Mat QR(dimx, dimy, CV_64F);      // =========验证用，可删除???????????</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <span class="comment">//for (int i = 0; i &lt; dimx; i++)</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="comment">//  QR.row(i) = wi_sr*(m_sigma(Range(0,dim), Range(i+1,i+2)) - m_X_k).t();</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="comment">//Mat e0 = wc0_sr*(m_sigma(Range(0,dim),Range(0,1)) - m_X_k); </span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="comment">//Mat Cov;</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="comment">//if (wc0 &gt; 0.0)</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="comment">//  GSLQrDecomposition(m_S_k, QR);</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="comment">//  Cov = m_S_k.t()*m_S_k + e0*e0.t();</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="comment">//  Cov = QR.t()*QR + e0*e0.t();  </span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <span class="comment">//  m_covRank = dim - 3*m_nMapFeatures;</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="comment">//} </span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="comment">//else</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="comment">//  GSLQrDecomposition(m_S_k, QR);</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="comment">//  Cov = m_S_k.t()*m_S_k - e0*e0.t();</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="comment">//  Cov = QR.t()*QR - e0*e0.t();</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="comment">//  m_covRank = dim - 3*m_nFilters;</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="comment">//getPermutationMatrix();</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="comment">//Cov = m_permutation.t()*Cov*m_permutation;  // normal to normal order</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="comment">//Mat S_disordered = Mat::zeros(dim, dim, CV_64F);</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="comment">//CholeskyDecompositionWithPivoting(S_disordered, Cov);</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="comment">//m_S_k = m_permutation*S_disordered*m_permutation.t(); // disorder to normal order</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    <span class="comment">//Mat s_store = Mat::zeros(dim, dim, CV_64F);</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    <span class="comment">//GSLQrDecomposition(s_store, m_S_k);</span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="comment">//s_store.copyTo(m_S_k);</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="comment">// ================================== //</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;}</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div>
<div class="line"><a name="l01604"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#afba572d4a049c382580f2e8f1bcee90d"> 1604</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#afba572d4a049c382580f2e8f1bcee90d">CSLAM::predictMeasurement</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;{</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a544ced2312046eed2a631ec63e450957">passSigmaThroughMesaurementFunction</a>(); </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a3c6287e8c05a2ce85b2100a70da2a316">QrAndCholeskyForMeasurement</a>();</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;}</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div>
<div class="line"><a name="l01615"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a544ced2312046eed2a631ec63e450957"> 1615</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a544ced2312046eed2a631ec63e450957">CSLAM::passSigmaThroughMesaurementFunction</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;{</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="keywordtype">int</span> dim   = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keywordtype">int</span> Na    = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="keywordtype">int</span> nCols = 2*Na + 1;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a70d20db5b72be123260f60d3c7fa87ee">m_sigma_allPixel</a>.create(2*<a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>, nCols, CV_64F);</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <span class="comment">// ==========Passing sigma-points through measurement function============ //</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <a class="code" href="struct_points_map.html">PointsMap</a>* map_p;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    Point2d uvu, uvd;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="keywordtype">int</span> id, index_in, index_out;</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    Mat position, Rwc, Rcw, state, Hlw, Hlr;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    Mat error(2, 1, CV_64F);</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    Mat element(2*<a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>, 1, CV_64F);</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a05c2d207c54f1f9141470586cf22105f">m_allPredictSet</a>.create(2*<a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>, 1, CV_64F);</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nCols; i++)</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    {</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        </div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        error = <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>(Range(dim+3, dim+5), Range(i, i+1)) + 0;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        <span class="comment">//error = Mat::zeros(2, 1, CV_64F);</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        position = <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>(Range(dim-4,dim-1), Range(i,i+1)) + 0;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a6a2e5ad9c88939b5a16671594cc93e62">getTransferMatrix</a>(Rwc, <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[i]);</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        Rcw = Rwc.inv();</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="keywordtype">id</span> = 0;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        <span class="keywordflow">while</span> (NULL != map_p)</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        {</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <span class="comment">//if (true == map_p-&gt;isDelay)</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;            <span class="comment">//{</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            <span class="comment">//  id++;</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;            <span class="comment">//  map_p = map_p-&gt;next;</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;            <span class="comment">//  continue;</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            <span class="comment">//}</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            <span class="comment">//error.ptr&lt;double&gt;(0)[0] = Gaussian(m_sigma.ptr&lt;double&gt;(dim+3)[i]);</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            <span class="comment">//error.ptr&lt;double&gt;(1)[0] = Gaussian(m_sigma.ptr&lt;double&gt;(dim+4)[i]); </span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;            index_in  = 6*id;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            index_out = 2*id;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;            state = <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>(Range(index_in,index_in+6), Range(i,i+1));</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ab5b37bf7b14dd233ac4171797a035eda">coordinatesState2World</a>(Hlw, state, position);</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a22e6803a4e1b4f01003138cab269ed27">coordinatesWorld2Camera</a>(Hlr, Hlw, Rcw);</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a29508ebc6507aab0b651c6b0f4264c40">coordinatesCamera2Image</a>(uvu, Hlr, error);</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a3721327d0b02a524662bc1b5fb4e564d">distortOnePointRW</a>(uvd, uvu);</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a70d20db5b72be123260f60d3c7fa87ee">m_sigma_allPixel</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(index_out+0)[i] = uvd.x;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a70d20db5b72be123260f60d3c7fa87ee">m_sigma_allPixel</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(index_out+1)[i] = uvd.y;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;            <span class="keywordtype">id</span>++;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;            map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        }</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        element = <a class="code" href="class_c_s_l_a_m.html#a70d20db5b72be123260f60d3c7fa87ee">m_sigma_allPixel</a>.col(i);</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="keywordflow">if</span> (!i)</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            addWeighted(element, <a class="code" href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">wm0</a>, <a class="code" href="class_c_s_l_a_m.html#a05c2d207c54f1f9141470586cf22105f">m_allPredictSet</a>, 0, 0, <a class="code" href="class_c_s_l_a_m.html#a05c2d207c54f1f9141470586cf22105f">m_allPredictSet</a>);</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;            addWeighted(element,  <a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>, <a class="code" href="class_c_s_l_a_m.html#a05c2d207c54f1f9141470586cf22105f">m_allPredictSet</a>, 1, 0, <a class="code" href="class_c_s_l_a_m.html#a05c2d207c54f1f9141470586cf22105f">m_allPredictSet</a>);</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    }</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="comment">//PointsMap* tmp_map = map;</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="comment">//while (NULL != tmp_map)</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="comment">//  cout&lt;&lt;tmp_map-&gt;initPixel.x&lt;&lt;&quot;  &quot;&lt;&lt;tmp_map-&gt;initPixel.y&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="comment">//  tmp_map = tmp_map-&gt;next;</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;}</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div>
<div class="line"><a name="l01700"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a3c6287e8c05a2ce85b2100a70da2a316"> 1700</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a3c6287e8c05a2ce85b2100a70da2a316">CSLAM::QrAndCholeskyForMeasurement</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;{</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keywordtype">double</span> px, py;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a> = 0;</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="keywordtype">int</span> index_visible = 0;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    Mat si(2, 2, CV_64F);</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <a class="code" href="struct_points_map.html">PointsMap</a> *map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="keywordflow">while</span> (NULL != map_p)</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    {</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        <span class="comment">//if (true == map_p-&gt;isDelay)</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        <span class="comment">//{</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        <span class="comment">//  map_p-&gt;nDelay++;</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <span class="comment">//  id++;</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        <span class="comment">//  map_p = map_p-&gt;next;</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        <span class="comment">//  continue;</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="comment">//}</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        px = <a class="code" href="class_c_s_l_a_m.html#a05c2d207c54f1f9141470586cf22105f">m_allPredictSet</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2*<span class="keywordtype">id</span>+0)[0];</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        py = <a class="code" href="class_c_s_l_a_m.html#a05c2d207c54f1f9141470586cf22105f">m_allPredictSet</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(2*<span class="keywordtype">id</span>+1)[0];</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="keywordflow">if</span> (px != 0 &amp;&amp; py != 0)</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        {</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>++;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            map_p-&gt;<a class="code" href="struct_points_map.html#a78671723ce6091850c99def8eb748096">isVisible</a>  = <span class="keyword">true</span>; <span class="comment">//=======需修改距离边界的条件????????</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;            map_p-&gt;<a class="code" href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">isMatching</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            map_p-&gt;<a class="code" href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">nPredictTimes</a>++;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.x = px;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.y = py;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a760f8e2f059ea84af715e7e61e59eda3">calculateOneFeatureCovariance</a>(si, <span class="keywordtype">id</span>);  <span class="comment">// =========若不需画2D图，则不需要计算????????</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            si.copyTo(map_p-&gt;<a class="code" href="struct_points_map.html#ac3d0d40cd5657fc02be8893f6cb3cb79">Si</a>);</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;            index_visible += 2;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        }</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        <span class="keywordtype">id</span>++;</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    }</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a4a9048f6d9b2399c774bf23018a67532">m_nShowPredicts</a> = <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a> + <a class="code" href="class_c_s_l_a_m.html#a515d1f5fbd66d9933889c55e192f7866">m_nStorePredicts</a>;</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;}</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;</div>
<div class="line"><a name="l01759"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a760f8e2f059ea84af715e7e61e59eda3"> 1759</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a760f8e2f059ea84af715e7e61e59eda3">CSLAM::calculateOneFeatureCovariance</a> (Mat &amp;si, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;<span class="keywordtype">id</span>)</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;{</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    <span class="keywordtype">int</span> dim   = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="keywordtype">int</span> Na    = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>;</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordtype">int</span> index = 2*id;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keywordtype">int</span> dimx  = 2*Na;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordtype">int</span> dimy  = 2;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    Mat QR(dimx, dimy, CV_64F);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="comment">//===============================================//</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    Mat sigma0 = <a class="code" href="class_c_s_l_a_m.html#a70d20db5b72be123260f60d3c7fa87ee">m_sigma_allPixel</a>(Range(index, index+2), Range(0,1)) + 0;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; 2*Na; i++)</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    {</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        QR.row(i) = <a class="code" href="class_c_s_l_a_m.html#a0344cc3ecdb1d702898ee35dd335197e">wi_sr</a>*(<a class="code" href="class_c_s_l_a_m.html#a70d20db5b72be123260f60d3c7fa87ee">m_sigma_allPixel</a>(Range(index,index+2), Range(i+1,i+2)) - sigma0).t();</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    }</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318">GSLQrDecomposition</a>(si, QR);</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="comment">//===============================================//</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="comment">//=================实验验证=====================//</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <span class="comment">//Mat ei(dimy, 1, CV_64F);</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160; </div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="comment">//for (int i=0; i &lt; 2*Na; i++)</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <span class="comment">//  ei = wi_sr*(m_sigma_allPixel(Range(index,index+2), Range(i,i+1)) - m_allPredictSet.rowRange(index,index+2)).t();</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="comment">//  ei.copyTo(QR.rowRange(i,i+1));</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160; </div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    <span class="comment">//GSLQrDecomposition(si, QR);</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160; </div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="comment">//Mat e0(dimy, 1, CV_64F);</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="comment">//subtract(m_sigma_allPixel(Range(index, index+2), Range(0,1)), m_allPredictSet.rowRange(index,index+2), e0);</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="comment">//Mat tmp = si.t()*si - e0*e0.t();</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment"></span>    <span class="comment">//modifiedCholeskyDecomposition(si, tmp);</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="comment">//===================实验验证===================//</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;}</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;</div>
<div class="line"><a name="l01804"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a7e3d0195d15c15ffaaa82c690770638d"> 1804</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a7e3d0195d15c15ffaaa82c690770638d">CSLAM::wrapPatch</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;{</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;                         </div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    Mat Rwc;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a6a2e5ad9c88939b5a16671594cc93e62">getTransferMatrix</a>(Rwc, <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[0]);</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    Mat cam_position = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(dim-4,dim-1);</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    Mat K = Mat(<a class="code" href="class_c_s_l_a_m.html#a7844c896ef4784019de00f6996cac990">cam_K</a>);</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <a class="code" href="struct_points_map.html">PointsMap</a>* map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <span class="keywordflow">while</span> (NULL != map_p)</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    {</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        <span class="comment">//if (true == map_p-&gt;isDelay)</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        <span class="comment">//{</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        <span class="comment">//  map_p = map_p-&gt;next;</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        <span class="comment">//  continue;</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        <span class="comment">//}</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        Mat Rotate_C0_W = Mat::eye(4,4,CV_64F);</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        Mat Rotate_C1_W = Mat::eye(4,4,CV_64F);</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        Rotate_C0_W(Range(0,3),Range(0,3)) = map_p-&gt;<a class="code" href="struct_points_map.html#a09a542b38718813db3700c718cf0e073">initRotation</a> + 0;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        Rotate_C0_W(Range(0,3),Range(3,4)) = (map_p-&gt;<a class="code" href="struct_points_map.html#a09a542b38718813db3700c718cf0e073">initRotation</a>)*(map_p-&gt;<a class="code" href="struct_points_map.html#a80b7f22487b8ac001df92147f6012344">initTrans</a>) + 0;</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        Rotate_C1_W(Range(0,3),Range(0,3)) = Rwc + 0;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        Rotate_C1_W(Range(0,3),Range(3,4)) = Rwc*cam_position + 0;</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        Mat Rotate_C1_C0 = (Rotate_C0_W.inv())*Rotate_C1_W;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;        Mat R_C1_C0      = Rotate_C1_C0(Range(0,3),Range(0,3));</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        Mat r_C1_C0      = Rotate_C1_C0(Range(0,3),Range(3,4));</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        Mat n0 = (Mat_&lt;double&gt;(3,1) &lt;&lt; map_p-&gt;<a class="code" href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">initPixel</a>.x-<a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a>, map_p-&gt;<a class="code" href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">initPixel</a>.y-<a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a>, -<a class="code" href="class_c_s_l_a_m.html#a93e54316c1d69437d1e955906da90064">cam_f1</a>); </div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        Mat n1_tmp0 = (Mat_&lt;double&gt;(4,1) &lt;&lt;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;            map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.x-<a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a>, map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.y-<a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a>, -<a class="code" href="class_c_s_l_a_m.html#a93e54316c1d69437d1e955906da90064">cam_f1</a>, 1);</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        Mat n1_tmp1 = Rotate_C1_C0*n1_tmp0;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        n1_tmp1 /= (n1_tmp1.at&lt;<span class="keywordtype">double</span>&gt;(3));</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        Mat n1_n0 = n1_tmp1(Range(0,3),Range::all());</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        n0 /= (::norm(n0));</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        n1_n0 /= (::norm(n1_n0));</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        Mat n = n0+n1_n0;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        n /= (::norm(n));</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        Mat XYZ_W = (Mat_&lt;double&gt;(4,1) &lt;&lt;map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.x, map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.y, map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.z, 1);</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        Mat XYZ_C0 = (Rotate_C0_W.inv())*XYZ_W;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        XYZ_C0 /= (XYZ_C0.at&lt;<span class="keywordtype">double</span>&gt;(3));</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        Mat XYZ = XYZ_C0(Range(0,3),Range::all()) + 0;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        Mat tmp = (-1)*n.t()*XYZ;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        <span class="keywordtype">double</span> d = tmp.at&lt;<span class="keywordtype">double</span>&gt;(0);</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        Point2d uv_C0,uv_C1;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a0dfc931db26c1fed0892384c086f40f8">undistortOnePointRW</a>(uv_C1,map_p-&gt;<a class="code" href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">initPixel</a>);</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        Mat uv_c1_tmp = (Mat_&lt;double&gt;(3,1) &lt;&lt; uv_C1.x, uv_C1.y, 1);</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        Mat uv_c1 = K*(R_C1_C0-r_C1_C0*(n.t())/d)*(K.inv());</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        Mat uv_c1_und = (uv_c1.inv())*uv_c1_tmp;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        uv_c1_und /= (uv_c1_und.at&lt;<span class="keywordtype">double</span>&gt;(2));</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        uv_C0.x = uv_c1_und.at&lt;<span class="keywordtype">double</span>&gt;(0);</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        uv_C0.y = uv_c1_und.at&lt;<span class="keywordtype">double</span>&gt;(1);</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a3721327d0b02a524662bc1b5fb4e564d">distortOnePointRW</a>(uv_C1,uv_C0);</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        Point2d uv = uv_C1;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;2*<a class="code" href="class_c_s_l_a_m.html#a433d23784c33370acb9937fe2c2e85a4">HP_MATCH_W</a>+1; i++)</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        {</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;2*<a class="code" href="class_c_s_l_a_m.html#ad3b702b958ce4e2bfd6a1b834e553b9b">HP_MATCH_H</a>+1; j++)</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;            {</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                uv_C0.x = uv.x-HP_MATCH_W + i;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                uv_C0.y = uv.y-HP_MATCH_H + j;</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a0dfc931db26c1fed0892384c086f40f8">undistortOnePointRW</a>(uv_C1,uv_C0);</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                Mat uv_c0_tmp = (Mat_&lt;double&gt;(3,1) &lt;&lt; uv_C1.x, uv_C1.y, 1);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                Mat uv_c0_und = K*(R_C1_C0-r_C1_C0*(n.t())/d)*(K.inv())*uv_c0_tmp;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                uv_c0_und /= (uv_c0_und.at&lt;<span class="keywordtype">double</span>&gt;(2));</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                uv_C0.x = uv_c0_und.at&lt;<span class="keywordtype">double</span>&gt;(0);</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                uv_C0.y = uv_c0_und.at&lt;<span class="keywordtype">double</span>&gt;(1);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a3721327d0b02a524662bc1b5fb4e564d">distortOnePointRW</a>(uv_C1,uv_C0);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                uv_C1.x -= (map_p-&gt;<a class="code" href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">initPixel</a>.x-<a class="code" href="class_c_s_l_a_m.html#a8db26541a4c9938bd06ca111cb6b434f">HP_INIT_W</a> - 1);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                uv_C1.y -= (map_p-&gt;<a class="code" href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">initPixel</a>.y-<a class="code" href="class_c_s_l_a_m.html#ab2c48c4b1c3f536fb066d014ad262e27">HP_INIT_H</a> - 1);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                <span class="keywordtype">int</span> left_x = cvFloor(uv_C1.x);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                <span class="keywordtype">int</span> left_y = cvFloor(uv_C1.y);</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                <span class="keywordtype">int</span> right_x = cvCeil(uv_C1.x);</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                <span class="keywordtype">int</span> right_y = cvCeil(uv_C1.y);</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                <span class="keywordflow">if</span> (left_x &gt;= 0 &amp;&amp; right_x &lt; 2*HP_INIT_W &amp;&amp; left_y &gt;= 0 &amp;&amp; right_y &lt; 2*<a class="code" href="class_c_s_l_a_m.html#ab2c48c4b1c3f536fb066d014ad262e27">HP_INIT_H</a>)</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                {</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                    <span class="keywordtype">double</span> rate_lx = right_x-uv_C1.x;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                    <span class="keywordtype">double</span> rate_ly = right_y-uv_C1.y;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                    <span class="keywordtype">double</span> rate_rx = 1.0-rate_lx;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                    <span class="keywordtype">double</span> rate_ry = 1.0-rate_ly;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                    uchar left_left = map_p-&gt;<a class="code" href="struct_points_map.html#a8ffd7123565d166884f81331a0a8e0a3">initPatch</a>.at&lt;uchar&gt;(left_x,left_y);</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                    uchar left_right = map_p-&gt;<a class="code" href="struct_points_map.html#a8ffd7123565d166884f81331a0a8e0a3">initPatch</a>.at&lt;uchar&gt;(left_x,right_y);</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                    uchar right_left = map_p-&gt;<a class="code" href="struct_points_map.html#a8ffd7123565d166884f81331a0a8e0a3">initPatch</a>.at&lt;uchar&gt;(right_x,left_y);</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                    uchar right_right = map_p-&gt;<a class="code" href="struct_points_map.html#a8ffd7123565d166884f81331a0a8e0a3">initPatch</a>.at&lt;uchar&gt;(right_x,right_y);</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                    map_p-&gt;<a class="code" href="struct_points_map.html#a0e3b07d928db32f6a7816a88a09584e7">matchPatch</a>.at&lt;uchar&gt;(i,j) = uchar(left_left*rate_lx*rate_ly</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                        +left_right*rate_lx*rate_ry+right_left*rate_rx*rate_ly+right_right*rate_rx*rate_ry);</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                }</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;            }</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        }</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    }</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;}</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div>
<div class="line"><a name="l01915"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#aeca66ae1995f8cf09c57c44b7e9386ad"> 1915</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#aeca66ae1995f8cf09c57c44b7e9386ad">CSLAM::dataAssociation</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;{</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    Mat image(<a class="code" href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">m_gryImage</a>);</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    </div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="keywordtype">int</span> Na  = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>; <span class="comment">// dim of augmented matrix                   // index of matching sigma points set</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    Point maxLoc;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    <span class="keywordtype">int</span> id, index_set, half_x, half_y;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <span class="keywordtype">double</span> px, py, mx, my, maxVal;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    Mat Rwc, pi, kp_descriptors, descriptor, roi;</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    vector&lt;KeyPoint&gt; keyPoints;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a6a2e5ad9c88939b5a16671594cc93e62">getTransferMatrix</a>(Rwc, <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[0]);</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7e3d0195d15c15ffaaa82c690770638d">wrapPatch</a>();</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a> = 0;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#af218e24018cb14dc448e120bd22e8cd8">m_matchID</a>.create(<a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>, 1, CV_64F);</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="keywordtype">id</span> = 0;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    index_set = 0;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <a class="code" href="struct_points_map.html">PointsMap</a>* map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    <span class="keywordflow">while</span> (NULL != map_p)</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    {</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        <span class="comment">//if (true == map_p-&gt;isDelay)</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        <span class="comment">//{</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        <span class="comment">//  id++;</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        <span class="comment">//  map_p = map_p-&gt;next;</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        <span class="comment">//  continue;</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;        <span class="comment">//}</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        </div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">true</span> == map_p-&gt;<a class="code" href="struct_points_map.html#a78671723ce6091850c99def8eb748096">isVisible</a>)</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        {</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;            px = map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.x;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;            py = map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.y;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;            pi = (map_p-&gt;<a class="code" href="struct_points_map.html#ac3d0d40cd5657fc02be8893f6cb3cb79">Si</a>.t())*(map_p-&gt;<a class="code" href="struct_points_map.html#ac3d0d40cd5657fc02be8893f6cb3cb79">Si</a>);</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;            half_x = cvCeil(2*map_p-&gt;<a class="code" href="struct_points_map.html#ac3d0d40cd5657fc02be8893f6cb3cb79">Si</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0]);</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;            half_y = cvCeil(2*map_p-&gt;<a class="code" href="struct_points_map.html#ac3d0d40cd5657fc02be8893f6cb3cb79">Si</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[1]);</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            half_x = min(<a class="code" href="class_c_s_l_a_m.html#a8db26541a4c9938bd06ca111cb6b434f">HP_INIT_W</a>, max(<a class="code" href="class_c_s_l_a_m.html#a433d23784c33370acb9937fe2c2e85a4">HP_MATCH_W</a>, half_x));</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;            half_y = min(<a class="code" href="class_c_s_l_a_m.html#ab2c48c4b1c3f536fb066d014ad262e27">HP_INIT_H</a>, max(<a class="code" href="class_c_s_l_a_m.html#ad3b702b958ce4e2bfd6a1b834e553b9b">HP_MATCH_H</a>, half_y));</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;            Mat correlation = Mat::zeros(2*half_y+1, 2*half_x+1, CV_64F);</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;            <span class="comment">// find ROI patch with high similarity according to the predict feature&#39;s covariance</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=(<span class="keywordtype">int</span>)px-half_x; i&lt;=(int)px+half_x; i++)</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;            {</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                <span class="keywordflow">if</span> (i&lt;HP_MATCH_W || i&gt; <a class="code" href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">imageWidth</a>-<a class="code" href="class_c_s_l_a_m.html#a433d23784c33370acb9937fe2c2e85a4">HP_MATCH_W</a>-1) </div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                {</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                }</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=(<span class="keywordtype">int</span>)py-half_y; j&lt;=(int)py+half_y; j++)</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                {</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                    <span class="keywordflow">if</span> (j&lt;HP_MATCH_H || j&gt; <a class="code" href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">imageHeight</a>-<a class="code" href="class_c_s_l_a_m.html#ad3b702b958ce4e2bfd6a1b834e553b9b">HP_MATCH_H</a>-1)    </div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                    {</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                    }</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                    Mat err = (Mat_&lt;double&gt;(1,2) &lt;&lt; i-px, j-py); </div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                    Mat pii = err*(pi.inv())*(err.t());          <span class="comment">// Mahalanobis diatance</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                    <span class="keywordflow">if</span> (pii.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] &lt; <a class="code" href="class_c_s_l_a_m.html#a1fd92be09384ae1139a51d8ee4887020">CHI2INV_TABLE</a>(0,2))</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                    {</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                        roi = image(Rect(i-<a class="code" href="class_c_s_l_a_m.html#a433d23784c33370acb9937fe2c2e85a4">HP_MATCH_W</a>,j-<a class="code" href="class_c_s_l_a_m.html#ad3b702b958ce4e2bfd6a1b834e553b9b">HP_MATCH_H</a>, 2*<a class="code" href="class_c_s_l_a_m.html#a433d23784c33370acb9937fe2c2e85a4">HP_MATCH_W</a>+1, 2*<a class="code" href="class_c_s_l_a_m.html#ad3b702b958ce4e2bfd6a1b834e553b9b">HP_MATCH_H</a>+1)) + 0;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                        <a class="code" href="class_c_s_l_a_m.html#a8fbff8e37747435d7038c7c070d6fcc8">calculateCrossCorrelation</a>(correlation.ptr&lt;<span class="keywordtype">double</span>&gt;(j-(<span class="keywordtype">int</span>)py+half_y)[i-(<span class="keywordtype">int</span>)px+half_x],</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                            roi, map_p-&gt;<a class="code" href="struct_points_map.html#a0e3b07d928db32f6a7816a88a09584e7">matchPatch</a>);</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                    }</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                }</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;            }</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;            maxVal = 0.0;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;            minMaxLoc(correlation, NULL, &amp;maxVal, NULL, &amp;maxLoc);</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;            <span class="keywordflow">if</span> (maxVal &gt;<a class="code" href="class_c_s_l_a_m.html#a6f4aa8e49668185ea1669a443ea49fc9">THRESHOLD_MATCH_PATCH</a>)</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;            {</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                mx = maxLoc.x - half_x + px;</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                my = maxLoc.y - half_y + py;</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#af218e24018cb14dc448e120bd22e8cd8">m_matchID</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(<a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>)[0] = map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>;</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>++;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                map_p-&gt;<a class="code" href="struct_points_map.html#a26f38c34229bdd548218e3860f258078">nMatchTimes</a>++;</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                map_p-&gt;<a class="code" href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">isMatching</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                map_p-&gt;<a class="code" href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">matchLocation</a>.x = mx;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                map_p-&gt;<a class="code" href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">matchLocation</a>.y = my;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;            }</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        }</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        <span class="keywordtype">id</span>++;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    }</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#af218e24018cb14dc448e120bd22e8cd8">m_matchID</a> = <a class="code" href="class_c_s_l_a_m.html#af218e24018cb14dc448e120bd22e8cd8">m_matchID</a>.rowRange(0, <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>) + 0;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a6e634ee1c27bba0a45e8858426a09a9b">m_nShowMatches</a> = <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a> + <a class="code" href="class_c_s_l_a_m.html#afd5af89231ef7c63336599eff5fca431">m_nStoreMatches</a>;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;}</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div>
<div class="line"><a name="l02020"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a17440c5331a3f5b5c9fc16be08b8e060"> 2020</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a17440c5331a3f5b5c9fc16be08b8e060">CSLAM::calculateOneFeatureCrossCovariance</a> (Mat &amp;Pxy, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;<span class="keywordtype">id</span>, <span class="keyword">const</span> Mat &amp;hi)<span class="keyword"> const</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="keywordtype">int</span> dim   = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="keywordtype">int</span> Na    = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordtype">int</span> index = 2*id;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    Mat sub1(dim, 1, CV_64F);</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    Mat sub2(2, 1, CV_64F);</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= 2*Na; i++)</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    {</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;        sub1 = <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>(Range(0,dim), Range(i,i+1)) - <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        sub2 = <a class="code" href="class_c_s_l_a_m.html#a70d20db5b72be123260f60d3c7fa87ee">m_sigma_allPixel</a>(Range(index,index+2), Range(i,i+1)) - hi;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        <span class="keywordflow">if</span> (!i)</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;            Pxy = <a class="code" href="class_c_s_l_a_m.html#aa18f6aa67da1d91ece58d37976f3aac6">wc0</a>*sub1*sub2.t() + 0;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;            Pxy += <a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>*sub1*sub2.t();</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    }</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;}</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div>
<div class="line"><a name="l02048"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a13befaca89bdd761fdbb8140cc52d026"> 2048</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a13befaca89bdd761fdbb8140cc52d026">CSLAM::KalmanUpdate</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;{</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <span class="keywordflow">if</span> (0 == <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>)</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">if</span> (FALSE == <a class="code" href="class_c_s_l_a_m.html#a27e94bb61d6e364765f33ccce921fcc4">isUseRANSAC</a>)</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    {</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        Mat zi, hi, si, sii;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        Mat Pxy(dim, 2, CV_64F);</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;        Mat Ki(dim, 2, CV_64F);</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        Mat U(dim, 2, CV_64F);</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <a class="code" href="struct_points_map.html">PointsMap</a> *map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        <span class="keywordflow">while</span> (NULL != map_p)</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        {</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;            <span class="keywordflow">if</span> ((<span class="keyword">true</span> == map_p-&gt;<a class="code" href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">isMatching</a>))<span class="comment">// &amp;&amp; (false == map_p-&gt;isDelay))</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;            {</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                zi = (Mat_&lt;double&gt;(2,1) &lt;&lt; map_p-&gt;<a class="code" href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">matchLocation</a>.x,   map_p-&gt;<a class="code" href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">matchLocation</a>.y); </div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                hi = (Mat_&lt;double&gt;(2,1) &lt;&lt; map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.x, map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.y);</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;                map_p-&gt;<a class="code" href="struct_points_map.html#ac3d0d40cd5657fc02be8893f6cb3cb79">Si</a>.copyTo(si);</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a17440c5331a3f5b5c9fc16be08b8e060">calculateOneFeatureCrossCovariance</a>(Pxy, <span class="keywordtype">id</span>, hi);</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                sii    = si.inv();</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                Ki     = Pxy*sii*sii.t();</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a> += Ki*(zi - hi);</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;                U      = Ki*si.t();</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;                </div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;                <span class="keywordflow">if</span> (0 != <a class="code" href="class_c_s_l_a_m.html#a3d2b94fa175e76bf49fb5e88539a286e">m_nAddings</a>)</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                {</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                    <a class="code" href="class_c_s_l_a_m.html#a54c5f3eeeeb73b407d076d839cbd25d2">GSLCholeskyUpdate</a>(U, <a class="code" href="class_c_s_l_a_m.html#ac30cd14708eb4b2e1fb936134d1c9879">FLAG_4_DOWNDATING</a>, <a class="code" href="class_c_s_l_a_m.html#a834da4dd7bd7641a26bcfa75e425d117">FLAG_4_NEED_REORDER</a>);</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                }</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;                {</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                    <a class="code" href="class_c_s_l_a_m.html#a54c5f3eeeeb73b407d076d839cbd25d2">GSLCholeskyUpdate</a>(U, <a class="code" href="class_c_s_l_a_m.html#ac30cd14708eb4b2e1fb936134d1c9879">FLAG_4_DOWNDATING</a>, <a class="code" href="class_c_s_l_a_m.html#a500d28928c87d1ca58ae9bb6ed7e4d65">FLAG_4_NEEDNOT_REORDER</a>);</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                }</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                </div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;            }</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;            <span class="keywordtype">id</span>++;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;        }</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    }</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#a27e94bb61d6e364765f33ccce921fcc4">isUseRANSAC</a>)</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    {</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="comment">//onePointRansacHypotheses();</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        <span class="comment">//updateLowInnovationInliers();</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        <span class="comment">//rescueHighInnovationInliers();</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <span class="comment">//updateHighInnovationInliers();</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    }</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;}</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;</div>
<div class="line"><a name="l02106"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a54c5f3eeeeb73b407d076d839cbd25d2"> 2106</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a54c5f3eeeeb73b407d076d839cbd25d2">CSLAM::GSLCholeskyUpdate</a> (<span class="keyword">const</span> Mat &amp;u, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;flag4UpOrDown, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;flag4Order)</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;{</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;    <span class="keywordtype">int</span> dim   = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="keywordtype">int</span> nCols = u.cols;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    Mat u_Col(dim, 1, CV_64F);         <span class="comment">// each column of input matrix u</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    Mat src1(dim, dim, CV_64F);</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    Mat src2(dim, dim, CV_64F);</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    Mat dst(dim, dim, CV_64F);</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nCols; i++)</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    {</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        src1  = <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.t()*<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;        u_Col = u.col(i) + 0;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;        src2  = u_Col*u_Col.t();</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        <span class="keywordflow">if</span> (flag4Order == <a class="code" href="class_c_s_l_a_m.html#a834da4dd7bd7641a26bcfa75e425d117">FLAG_4_NEED_REORDER</a>)</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        {</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;            <span class="keywordflow">if</span> (flag4UpOrDown == <a class="code" href="class_c_s_l_a_m.html#a2b4d9cba042ab726acf1597de4496b73">FLAG_4_UPDATING</a>)</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;            {</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a> = dim - 3*<a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                dst = <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.t()*(src1 + src2)*<a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a> + 0;</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;            } </div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            {</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a> = dim - 3*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                dst = <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.t()*(src1 - src2)*<a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a> + 0;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;            }</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;            Mat S_disordered(dim, dim, CV_64F);</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a08b3ad107020e734c37c8ee2348ae205">CholeskyDecompositionWithPivoting</a>(S_disordered, dst);</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318">GSLQrDecomposition</a>(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>, <a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>*S_disordered*<a class="code" href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">m_permutation</a>.t());</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        } </div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        {</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;            <span class="keywordflow">if</span> (flag4UpOrDown == <a class="code" href="class_c_s_l_a_m.html#a2b4d9cba042ab726acf1597de4496b73">FLAG_4_UPDATING</a>)</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;            {</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a> = dim - 3*<a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>;</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                dst = src1 + src2;</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            } </div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;            {</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a> = dim - 3*<a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                dst = src1 - src2;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;            }</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a4221baffff6789741c634b62da1344e1">modifiedCholeskyDecomposition</a>(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>, dst);</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;        }</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    }</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;}</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="comment">// Modified Cholesky decomposition</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a08b3ad107020e734c37c8ee2348ae205"> 2158</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a08b3ad107020e734c37c8ee2348ae205">CSLAM::CholeskyDecompositionWithPivoting</a> (Mat &amp;sr, Mat &amp;Cov)</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;{</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    sr = Mat::zeros(dim, dim, CV_64F);</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    <span class="keywordflow">if</span> (dim == <a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>)</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    {</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a4221baffff6789741c634b62da1344e1">modifiedCholeskyDecomposition</a>(sr, Cov);</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    } </div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    {</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;        Mat R11 = Mat::zeros(<a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>, <a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>, CV_64F);</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        Mat Cov11 = Cov(Range(0,<a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>), Range(0,<a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>));</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        Mat Cov12 = Cov(Range(0,<a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>), Range(<a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>,dim));</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a4221baffff6789741c634b62da1344e1">modifiedCholeskyDecomposition</a>(R11, Cov11); </div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;        Mat R12 = R11.inv().t()*Cov12;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;        R11.copyTo(sr(Range(0,<a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>), Range(0,<a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>)));</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;        R12.copyTo(sr(Range(0,<a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>), Range(<a class="code" href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">m_covRank</a>,dim)));</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    }</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;}</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="comment">// Modified Cholesky decomposition</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a4221baffff6789741c634b62da1344e1"> 2182</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a4221baffff6789741c634b62da1344e1">CSLAM::modifiedCholeskyDecomposition</a>(Mat &amp;S, <span class="keyword">const</span> Mat &amp;input)</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;{</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="keywordtype">int</span> dim = input.rows;</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="class_c_s_l_a_m.html#a498649955c5c3038c5b134a763f58c54">gamma</a>, zi, nu, beta2, num;</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    Mat G = input;</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    minMaxLoc(G.diag(), NULL, &amp;<a class="code" href="class_c_s_l_a_m.html#a498649955c5c3038c5b134a763f58c54">gamma</a>, NULL, NULL);</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    minMaxLoc(G-Mat::diag(G.diag()), NULL, &amp;zi, NULL, NULL);</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    Mat mat1 = (Mat_&lt;double&gt;(2,1)&lt;&lt; 1, sqrt(dim*dim - 1.0));</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    minMaxLoc(mat1, NULL, &amp;nu, NULL, NULL);</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    Mat mat2 = (Mat_&lt;double&gt;(3,1) &lt;&lt; gamma, zi/nu, 1e-15);</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    minMaxLoc(mat2, NULL, &amp;beta2, NULL, NULL);</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    Mat mat3(3, 1, CV_64F);</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    Mat L = Mat::zeros(dim, dim, CV_64F);</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    Mat D = Mat::zeros(dim, dim, CV_64F);</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    Mat C = Mat::diag(G.diag());</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    Mat E = Mat::zeros(dim, dim, CV_64F);</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    Mat theta = Mat::zeros(dim, 1, CV_64F);</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt;= dim-1; j++)</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    {</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <span class="comment">// ==========Calculate the jth row of L==============//</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        <span class="keywordflow">if</span> ( j &gt; 0)</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        {</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;            <span class="keywordflow">if</span> (1 == j)</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;            {</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                L.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] = C.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0]/D.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0]; </div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;            }</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;            {</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                divide(C(Range(j,j+1),Range(0,j)), D(Range(0,j),Range(0,j)).diag().t(), L(Range(j,j+1), Range(0,j)));</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;            }</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        }</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        <span class="comment">// ==============Update the jth columnn of C==============//</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;        <span class="keywordflow">if</span> (j &gt;= 1)</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;        {</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;            <span class="keywordflow">if</span> (j&lt;dim-1)</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;            {</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                <span class="keywordflow">if</span> (1 == j)</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                {</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                    C(Range(2,dim), Range(1,2)) = G(Range(2,dim), Range(1,2)) - </div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                        (L(Range(1,2), Range(0,1))*(C(Range(2,dim), Range(0,1)).t())).t();</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                }</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dim-2 == j)</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                {</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                    C(Range(dim-1,dim),Range(dim-2,dim-1)) = G(Range(dim-1,dim), Range(dim-2,dim-1)) - </div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                        (L(Range(dim-2,dim-1),Range(0,dim-2))*(C(Range(dim-1,dim),Range(0,dim-2))).t());</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                }</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                {</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                    C(Range(j+1,dim), Range(j,j+1)) = G(Range(j+1,dim), Range(j,j+1)) -</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                        (L(Range(j,j+1), Range(0,j))*(C(Range(j+1,dim), Range(0,j)).t())).t();</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                }</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;            }</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        }</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        {</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;            C(Range(1, dim), Range(0,1)) = G(Range(1, dim), Range(0,1)) + 0;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;        }</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        <span class="comment">// ===============Update theta===================//</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        <span class="keywordflow">if</span> (dim-1 == j)</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;        {</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;            theta.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[0] = 0;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;        }</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dim-2 == j)</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        {</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;            theta.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-2)[0] = abs(C.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[dim-2]);</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        }</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        {</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;            minMaxLoc(abs(C(Range(j+1,dim), Range(j,j+1))), NULL, &amp;num, NULL, NULL);</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;            theta.ptr&lt;<span class="keywordtype">double</span>&gt;(j)[0] = num;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        }</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        <span class="comment">// =========Update D================//</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        mat3 = (Mat_&lt;double&gt;(3,1) &lt;&lt; </div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a24751bbd1328ceedc0d2d0c4008fb9f7">EPSILON</a>, </div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;            abs(C.ptr&lt;<span class="keywordtype">double</span>&gt;(j)[j]), </div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;            theta.ptr&lt;<span class="keywordtype">double</span>&gt;(j)[0]*theta.ptr&lt;<span class="keywordtype">double</span>&gt;(j)[0]/beta2);</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;        minMaxLoc(mat3, NULL, &amp;num, NULL, NULL);</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;        D.ptr&lt;<span class="keywordtype">double</span>&gt;(j)[j] = num;</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;        <span class="comment">// =========Update E================//</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        E.ptr&lt;<span class="keywordtype">double</span>&gt;(j)[j] = D.ptr&lt;<span class="keywordtype">double</span>&gt;(j)[j] - C.ptr&lt;<span class="keywordtype">double</span>&gt;(j)[j];</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        <span class="comment">// ==========Update C again===========//</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = j+1; i &lt; dim; i++)</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        {</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;            C.ptr&lt;<span class="keywordtype">double</span>&gt;(i)[i] = C.ptr&lt;<span class="keywordtype">double</span>&gt;(i)[i] - </div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                C.ptr&lt;<span class="keywordtype">double</span>&gt;(i)[j]*C.ptr&lt;<span class="keywordtype">double</span>&gt;(i)[j]/D.ptr&lt;<span class="keywordtype">double</span>&gt;(j)[j];</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        }</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    }</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    <span class="comment">// ============Put 1&#39;s on the diagonal of L===========//</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; dim*dim; i=i+dim+1)</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    {</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        L.ptr&lt;<span class="keywordtype">double</span>&gt;(i/dim)[i%dim] = 1;</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    }</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;    <span class="comment">// ==========if needed, find a descent direction===========//</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    Point minLoc;</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    Mat rhs, pneg;</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    minMaxLoc(C.diag(), &amp;num, NULL, &amp;minLoc, NULL);</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    <span class="keywordflow">if</span> (num &lt; 0.0)</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    {</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        rhs = Mat::zeros(dim, 1, CV_64F);</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;        rhs.ptr&lt;<span class="keywordtype">double</span>&gt;(minLoc.x)[0] = 1;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        pneg = L.t().inv()*rhs;</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    }</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    {</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        pneg = NULL;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    }</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    Mat D_sr;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    sqrt(D, D_sr);</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    S = D_sr*L.t();</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    <span class="comment">//if (pneg.rows != 0)</span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <span class="comment">//  cout&lt;&lt;pneg.t()*G*pneg&lt;&lt;endl&lt;&lt;endl; </span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="comment">//} </span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;}</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment">// GSL QR decomposition.</span></div>
<div class="line"><a name="l02315"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318"> 2315</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318">CSLAM::GSLQrDecomposition</a> (Mat &amp;cv_s, <span class="keyword">const</span> Mat &amp;cv_qr)<span class="keyword"> const</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    <span class="keywordtype">int</span> dimx = cv_qr.rows;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <span class="keywordtype">int</span> dimy = cv_qr.cols;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    gsl_matrix * gsl_qr  = gsl_matrix_alloc(dimx, dimy);</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    gsl_vector * gsl_tau = gsl_vector_alloc(dimy);</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a3fdb7bea1f813ef9bda6d3d243d6cfc0">dataTypeCVMat2GSLMat</a>(gsl_qr, cv_qr);</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    gsl_linalg_QR_decomp(gsl_qr, gsl_tau);</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    cv_s = Mat::zeros(dimy, dimy, CV_64F);</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;dimy; i++)</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    {</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=i; j&lt;dimy; j++)</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;        {</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;            cv_s.ptr&lt;<span class="keywordtype">double</span>&gt;(i)[j] = gsl_matrix_get(gsl_qr, i, j);</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        }</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    }</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    gsl_vector_free(gsl_tau);</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    gsl_matrix_free(gsl_qr);</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;}</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment">// QR decomposition with column pivoting</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a821065642fed081c6386185479d33b98"> 2341</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a821065642fed081c6386185479d33b98">CSLAM::GSLModifiedQRDecomposition</a>(Mat &amp;sr, <span class="keyword">const</span> Mat &amp;QR)</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;{</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    <span class="comment">// ===================== Cholesky update =======================// </span></div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    Mat cov  = QR;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <span class="keywordtype">int</span> dimx = cov.rows;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="keywordtype">int</span> dimy = cov.cols;</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    <span class="keywordtype">int</span> signum;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    Mat R(dimx, dimy, CV_64F);</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    Mat P = Mat::zeros(dimy, dimy, CV_64F);</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    gsl_matrix* gsl_cov    = gsl_matrix_alloc(dimx, dimy);</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    gsl_matrix* gsl_q      = gsl_matrix_alloc(dimx, dimx);</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    gsl_matrix* gsl_r      = gsl_matrix_alloc(dimx, dimy);</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    gsl_vector* gsl_tau    = gsl_vector_alloc(dimy);</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    gsl_vector* gsl_norm   = gsl_vector_alloc(dimy);</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    gsl_permutation* gsl_p = gsl_permutation_alloc(dimy);</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a3fdb7bea1f813ef9bda6d3d243d6cfc0">dataTypeCVMat2GSLMat</a>(gsl_cov, cov);</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;    gsl_linalg_QRPT_decomp2(gsl_cov, gsl_q, gsl_r, gsl_tau, gsl_p, &amp;signum, gsl_norm);</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a0296a3c396dfcd6a41cab3d8c4b25886">dataTypeGSLMat2CVMat</a>(R, gsl_r);</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a9f0adde83d660046a803c05d7f74f827">dataTypeGSLPermutation2CVMat</a>(P, gsl_p);</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    gsl_matrix_free(gsl_cov);</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    gsl_matrix_free(gsl_q);</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    gsl_vector_free(gsl_tau);</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    gsl_vector_free(gsl_norm);</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    Mat R_new = R*P.t();</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    Mat S_new = R_new.rowRange(Range(0,dimy));</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318">GSLQrDecomposition</a>(sr, S_new);</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;}</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;</div>
<div class="line"><a name="l02382"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a10bfba127951793c3c71b1f15dc78ce7"> 2382</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a10bfba127951793c3c71b1f15dc78ce7">CSLAM::updateFeaturesInformation</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;{</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>)</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    {</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    }</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a> = <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.t()*<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    <span class="keywordtype">int</span> dim;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    <span class="keywordtype">double</span> xi, yi, zi, theta, phi, rho, Hlr_z;</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <span class="keywordtype">double</span> px, py, mx, my, dpx, dpy, dmx, dmy;</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <span class="keywordtype">bool</span> isDelete, isNeedStore;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    Mat sr(6, 6, CV_64F);</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    Mat keyPointCov(3, 3, CV_64F);</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;    Mat keyPointInfo(6, 1, CV_64F);</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    CString showFeatureInfo;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    <a class="code" href="struct_feature_info.html">FeatureInfo</a> featuresInfo;</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aa0230002110863d766bbb269b51a64c8">m_nDeletes</a> = 0;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a5a2f68b64bde4544e5fc683548205b3d">m_nStores</a>  = 0;</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ac350bcc0dd2f25db8622ad07ff304375">m_deleteID</a>.create(<a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>, 1, CV_64F);</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    <a class="code" href="struct_points_map.html">PointsMap</a>* map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;    <span class="keywordflow">while</span> (NULL != map_p)</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;    {</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        xi    = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(6*<span class="keywordtype">id</span>+0)[0];</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        yi    = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(6*<span class="keywordtype">id</span>+1)[0];</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        zi    = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(6*<span class="keywordtype">id</span>+2)[0];</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;        theta = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(6*<span class="keywordtype">id</span>+3)[0];</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;        phi   = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(6*<span class="keywordtype">id</span>+4)[0];</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        rho   = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(6*<span class="keywordtype">id</span>+5)[0];</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        Hlr_z = rho*(zi - <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-2)[0]) + cos(phi)*cos(theta);</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        px  = map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.x;</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;        py  = map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>.y;</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;        dpx = <a class="code" href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">imageWidth</a>  - px;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        dpy = <a class="code" href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">imageHeight</a> - py;</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        isDelete = (map_p-&gt;<a class="code" href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">nPredictTimes</a> &gt; 2*map_p-&gt;<a class="code" href="struct_points_map.html#a26f38c34229bdd548218e3860f258078">nMatchTimes</a> &amp;&amp; map_p-&gt;<a class="code" href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">nPredictTimes</a> &gt;= 10) ||</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;            rho &lt; 0.01 || Hlr_z &lt; 0.0 ||</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;            px  &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || py  &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> ||</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;            dpx &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || dpy &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a>;</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">true</span> == map_p-&gt;<a class="code" href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">isMatching</a>)</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;        {</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            mx  = map_p-&gt;<a class="code" href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">matchLocation</a>.x;</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;            my  = map_p-&gt;<a class="code" href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">matchLocation</a>.y;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;            dmx = <a class="code" href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">imageWidth</a>  - mx;</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;            dmy = <a class="code" href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">imageHeight</a> - my;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;            isDelete = isDelete ||</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                mx  &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || my  &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || </div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                dmx &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || dmy &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a>;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;        }</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;        <span class="keywordflow">if</span> ( <span class="keyword">true</span> == isDelete)  <span class="comment">// Nedd to delete one node</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        {</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;            isNeedStore = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;            <span class="keywordflow">if</span> ((map_p-&gt;<a class="code" href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">nPredictTimes</a> &gt; 2*map_p-&gt;<a class="code" href="struct_points_map.html#a26f38c34229bdd548218e3860f258078">nMatchTimes</a> &amp;&amp; map_p-&gt;<a class="code" href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">nPredictTimes</a> &gt;= 10))</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;            {</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>--;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>--;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                cout&lt;&lt;<span class="stringliteral">&quot;删除特征点:ID=&quot;</span>&lt;&lt;map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>&lt;&lt;<span class="stringliteral">&quot;，原因：特征点多次未匹配上&quot;</span>&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;            } </div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rho &lt; 0)</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;            {</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>--;</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>--;</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                cout&lt;&lt;<span class="stringliteral">&quot;删除特征点:ID=&quot;</span>&lt;&lt;map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>&lt;&lt;<span class="stringliteral">&quot;，原因：特征点深度值为负&quot;</span>&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;            }</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((rho &gt;= 0) &amp;&amp; (rho &lt; 0.01))</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;            {</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>--;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>--;</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;                cout&lt;&lt;<span class="stringliteral">&quot;删除特征点:ID=&quot;</span>&lt;&lt;map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>&lt;&lt;<span class="stringliteral">&quot;，原因：特征点深度值过大&quot;</span>&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;            }</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Hlr_z &lt; 0.0)</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;            {</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>--;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>--;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                cout&lt;&lt;<span class="stringliteral">&quot;删除特征点:ID=&quot;</span>&lt;&lt;map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>&lt;&lt;<span class="stringliteral">&quot;，原因：相机高度值为负&quot;</span>&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;            }</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (px &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || py &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || dpx &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || dpy &lt;<a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a>)</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            {</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>--;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>--;</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                <span class="keywordflow">if</span> (<span class="keyword">true</span> == map_p-&gt;<a class="code" href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">isMatching</a>)</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                {</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                    isNeedStore = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                    <a class="code" href="class_c_s_l_a_m.html#a5a2f68b64bde4544e5fc683548205b3d">m_nStores</a>++;</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                    <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>--;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                }</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                cout&lt;&lt;<span class="stringliteral">&quot;删除特征点:ID=&quot;</span>&lt;&lt;map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>&lt;&lt;<span class="stringliteral">&quot;，原因：特征点的预测位置靠近边界&quot;</span>&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;            }</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mx &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || my &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || dmx &lt; <a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a> || dmy &lt;<a class="code" href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">DIST_2_BORDER</a>)</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;            {</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                isNeedStore = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">m_nFilters</a>--; </div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a5a2f68b64bde4544e5fc683548205b3d">m_nStores</a>++; </div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">m_nPredicts</a>--; </div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>--;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                cout&lt;&lt;<span class="stringliteral">&quot;删除特征点:ID=&quot;</span>&lt;&lt;map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>&lt;&lt;<span class="stringliteral">&quot;，原因：特征点的匹配位置靠近边界&quot;</span>&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;            }</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ac350bcc0dd2f25db8622ad07ff304375">m_deleteID</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(<a class="code" href="class_c_s_l_a_m.html#aa0230002110863d766bbb269b51a64c8">m_nDeletes</a>)[0] = map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            if (<span class="keyword">true</span> == isNeedStore)</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            {</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#a509765ef838afe279272eb5c309159b8">ID</a>            = map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#a961832690c6e4ce72a7b713aac02d64b">isLoop</a>        = map_p-&gt;<a class="code" href="struct_points_map.html#a11c75def31fe39819316f7daea81d056">isLoop</a>;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#ad208f9f4a66295dde14512e18c06edd1">nPredictTimes</a> = map_p-&gt;<a class="code" href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">nPredictTimes</a>;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#ae951d77383d7f4e677f3d2a015033ea1">nMatchTimes</a>   = map_p-&gt;<a class="code" href="struct_points_map.html#a26f38c34229bdd548218e3860f258078">nMatchTimes</a>;</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#aff5e4c938733c62b57087d04e696a1c3">initXYZ</a>       = map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#ab6b7d2cfc33e83dfed371baedcc0f05b">initPixel</a>     = map_p-&gt;<a class="code" href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">initPixel</a>;</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#a66ce45d13e9e9f2c7ba4f876bad43abd">initTrans</a>     = map_p-&gt;<a class="code" href="struct_points_map.html#a80b7f22487b8ac001df92147f6012344">initTrans</a>;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#a253d7884f9e20e30782e54edad705a0d">initRotation</a>  = map_p-&gt;<a class="code" href="struct_points_map.html#a09a542b38718813db3700c718cf0e073">initRotation</a>;</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#a561b52cdb649d471fc98288b445af6b7">initPatch</a>     = map_p-&gt;<a class="code" href="struct_points_map.html#a8ffd7123565d166884f81331a0a8e0a3">initPatch</a>;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;                featuresInfo.<a class="code" href="struct_feature_info.html#a99e98689f3aa603d834c21d0c60095af">state</a>         = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(6*<span class="keywordtype">id</span>, 6*<span class="keywordtype">id</span>+6) + 0;</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#ac9e33202210b195caa0aa290efc4821b">getFeatureCartesianInformation</a>(featuresInfo.<a class="code" href="struct_feature_info.html#a5d574a7c4b2e616ceadcf14d2bac337f">position</a>, featuresInfo.<a class="code" href="struct_feature_info.html#ab38be032519b9b3d7d2f06373085f1d5">sr</a>, featuresInfo.<a class="code" href="struct_feature_info.html#afe83757d66c4b0e3da84b87a41b65b0b">cov</a>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a6a1a915046eb327cb33a4424eda2bdcc">get3DdisplayInformation</a>(featuresInfo.<a class="code" href="struct_feature_info.html#a35b34ee971e21ea92a6a0450fab5f820">axis</a>, featuresInfo.<a class="code" href="struct_feature_info.html#a702d21bc7e546a8eed0165cf8f8af51a">sigma</a>, featuresInfo.<a class="code" href="struct_feature_info.html#afe83757d66c4b0e3da84b87a41b65b0b">cov</a>);</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.push_back(featuresInfo); <span class="comment">// Store the information of all validate keypoints</span></div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            }</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;            <span class="comment">//for (vector&lt;FeatureInfo&gt;::size_type i=0; i&lt;m_featuresAllInfo.size(); i++)</span></div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;            <span class="comment">//{</span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].ID&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].nPredictTimes&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].nMatchTimes&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].initXYZ.x&lt;&lt;&quot;  &quot;&lt;&lt;m_featuresAllInfo[i].initXYZ.x&lt;&lt;&quot;  &quot;&lt;&lt;m_featuresAllInfo[i].initXYZ.z&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].initPixel.x&lt;&lt;&quot;  &quot;&lt;&lt;m_featuresAllInfo[i].initPixel.y&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].initTrans&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].initRotation&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].initPatch&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].state&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].Position.x&lt;&lt;&quot;  &quot;&lt;&lt;m_featuresAllInfo[i].Position.y&lt;&lt;&quot;  &quot;&lt;&lt;m_featuresAllInfo[i].Position.z &lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].SR&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;            <span class="comment">//  cout&lt;&lt;m_featuresAllInfo[i].Cov&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;            <span class="comment">//  //cout&lt;&lt;m_featuresAllInfo[i].Axis&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;            <span class="comment">//  //cout&lt;&lt;m_featuresAllInfo[i].Sigma&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;            <span class="comment">//}</span></div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a> = <a class="code" href="class_c_s_l_a_m.html#a7765bfdbbd91e11e73c42c46e3bf88bf">deleteOneFeature</a>(<span class="keywordtype">id</span>, map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>, <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>);</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;            map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a> = <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.t()*<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;            <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;            <span class="keywordflow">while</span> (NULL != map_p)</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;            {</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                <span class="keywordflow">if</span> (index == <span class="keywordtype">id</span>) </div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;                {</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;                    <span class="keywordflow">break</span>; </div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;                }</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;                index++;</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;                map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;            }</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;        }</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;        <span class="keywordflow">else</span> <span class="comment">// Need not to delete node</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;        {</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#ac9e33202210b195caa0aa290efc4821b">getFeatureCartesianInformation</a>(map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>, sr, keyPointCov, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a6a1a915046eb327cb33a4424eda2bdcc">get3DdisplayInformation</a>(map_p-&gt;<a class="code" href="struct_points_map.html#a44a2b4bef54a00188be795474934bae8">axis</a>, map_p-&gt;<a class="code" href="struct_points_map.html#a18a69960c103dd2f645677882f90c4a7">sigma</a>, keyPointCov);</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">true</span> == map_p-&gt;<a class="code" href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">isMatching</a>)</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;            {</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#abcb644a1c146d7ef63911e6166f3a082">isCompensate</a>)</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                {</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                    showFeatureInfo.Format(showFeatureInfo + <span class="stringliteral">&quot;%02d: %.1f %.1f %.1f; \r\n&quot;</span>, </div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                        map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>,</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;                        map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.x,</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                        map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.y,</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;                        (map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.z + <a class="code" href="class_c_s_l_a_m.html#a759b2bdb9135255a749e58df3986211d">m_deep</a>)/2.0);</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                } </div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;                {</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                    showFeatureInfo.Format(showFeatureInfo + <span class="stringliteral">&quot;%02d: %.1f %.1f %.1f; \r\n&quot;</span>, </div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                        map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>,</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;                        map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.x,</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                        map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.y,</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                        map_p-&gt;<a class="code" href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">xyz</a>.z);</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                }</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;            }</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            map_p-&gt;<a class="code" href="struct_points_map.html#a78671723ce6091850c99def8eb748096">isVisible</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;            <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#a27e94bb61d6e364765f33ccce921fcc4">isUseRANSAC</a>)</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            {</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                <span class="comment">//map_p-&gt;inliner_L = false;</span></div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                <span class="comment">//map_p-&gt;inliner_H = false;</span></div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;            }</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;        }</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;        <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>)</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        {</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;        } </div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;        {</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;            <span class="keywordtype">id</span>++;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;            map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        }</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;    }</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#ac350bcc0dd2f25db8622ad07ff304375">m_deleteID</a> = <a class="code" href="class_c_s_l_a_m.html#ac350bcc0dd2f25db8622ad07ff304375">m_deleteID</a>.rowRange(0,<a class="code" href="class_c_s_l_a_m.html#aa0230002110863d766bbb269b51a64c8">m_nDeletes</a>);</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a62c42ac100361d94d003ea8c4f9b1781">m_showFeatureInfo</a>.SetSel(0,-1);</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a62c42ac100361d94d003ea8c4f9b1781">m_showFeatureInfo</a>.ReplaceSel(showFeatureInfo,<span class="keyword">true</span>);</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;}</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;</div>
<div class="line"><a name="l02622"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a7765bfdbbd91e11e73c42c46e3bf88bf"> 2622</a></span>&#160;<a class="code" href="struct_points_map.html">PointsMap</a>* <a class="code" href="class_c_s_l_a_m.html#a7765bfdbbd91e11e73c42c46e3bf88bf">CSLAM::deleteOneFeature</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;mapID, <a class="code" href="struct_points_map.html">PointsMap</a>* p_head)</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;{</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    Mat V; </div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <span class="comment">// ========update state vector &amp; covariance============//</span></div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>)</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;    {</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(6,dim).copyTo(<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>);</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(0,6), Range(6,dim)).copyTo(V);</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(6,dim), Range(6,dim)).copyTo(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>);</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;    }</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    {</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(Range(6*(<span class="keywordtype">id</span>+1),dim)).copyTo(<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(Range(6*<span class="keywordtype">id</span>,dim-6)));</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(Range(0,dim-6)).copyTo(<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>);</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.rowRange(Range(6*<span class="keywordtype">id</span>,6*(<span class="keywordtype">id</span>+1))).copyTo(V);</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        V.colRange(Range(6*(<span class="keywordtype">id</span>+1), dim)).copyTo(V.colRange(Range(6*<span class="keywordtype">id</span>,dim-6)));</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;        V = V.colRange(Range(0,dim-6));</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(0,6*<span class="keywordtype">id</span>), Range(6*(<span class="keywordtype">id</span>+1),dim)).copyTo(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(0,6*<span class="keywordtype">id</span>), Range(6*<span class="keywordtype">id</span>,dim-6))); <span class="comment">// S01</span></div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(6*(<span class="keywordtype">id</span>+1),dim), Range(0,6*<span class="keywordtype">id</span>)).copyTo(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(6*<span class="keywordtype">id</span>,dim-6), Range(0,6*<span class="keywordtype">id</span>))); <span class="comment">// S10</span></div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(6*(<span class="keywordtype">id</span>+1),dim), Range(6*(<span class="keywordtype">id</span>+1),dim)).copyTo(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(6*<span class="keywordtype">id</span>,dim-6), Range(6*<span class="keywordtype">id</span>,dim-6))); <span class="comment">// S11</span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(0,dim-6), Range(0,dim-6)).copyTo(<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>);</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    }</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aa0230002110863d766bbb269b51a64c8">m_nDeletes</a>++;</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>--;</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    Mat VT = V.t();</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a54c5f3eeeeb73b407d076d839cbd25d2">GSLCholeskyUpdate</a>(VT, <a class="code" href="class_c_s_l_a_m.html#a2b4d9cba042ab726acf1597de4496b73">FLAG_4_UPDATING</a>, <a class="code" href="class_c_s_l_a_m.html#a500d28928c87d1ca58ae9bb6ed7e4d65">FLAG_4_NEEDNOT_REORDER</a>); </div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    <span class="comment">// ================update the map================== //</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    <span class="comment">// Notes: delete current feature&#39;s information, and update the map</span></div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <a class="code" href="struct_points_map.html">PointsMap</a> *map_p1,*map_p2;</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    map_p1 = p_head;</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    map_p2 = p_head;</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    <span class="keywordflow">while</span> (map_p2-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a> &amp;&amp; mapID !=map_p2-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>)</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    {</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;        map_p1 = map_p2;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;        map_p2 = map_p2-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;    }</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    <span class="keywordflow">if</span> (mapID == map_p2-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>)</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    {</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;        <span class="keywordflow">if</span> (map_p1 == map_p2)      </div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;        {</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;            <span class="comment">// Delete the first node</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;            <span class="comment">// In this case, make the map_p1 pointer start from the second node of map_p2</span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;            map_p1 = map_p2-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>; </div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;            <span class="keyword">delete</span> map_p2;</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;            <span class="keywordflow">return</span> map_p1;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;        }</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        <span class="keywordflow">else</span>                   </div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;        {</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;            <span class="comment">// Delete the node other than first</span></div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;            <span class="comment">// In this case, make the map_p1 pointer start from the next node of map_p2</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;            map_p1-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a> = map_p2-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;            <span class="keyword">delete</span> map_p2;</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;            <span class="keywordflow">return</span> p_head;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;            <span class="comment">//return map_p1;</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        }</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    }</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    {</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;        cout&lt;&lt;<span class="stringliteral">&quot;Error occured in this program!&quot;</span>&lt;&lt;endl;</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        system(<span class="stringliteral">&quot;pause&quot;</span>);</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;        <span class="keywordflow">return</span> p_head;</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    }</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;}</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;</div>
<div class="line"><a name="l02706"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#ac9e33202210b195caa0aa290efc4821b"> 2706</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#ac9e33202210b195caa0aa290efc4821b">CSLAM::getFeatureCartesianInformation</a>(Point3d &amp;xyz, Mat &amp;sr, Mat &amp;cov, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;<span class="keywordtype">id</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    <span class="comment">//============Calculate the feature&#39;s 3D position=========//</span></div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    Mat state = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(Range(6*<span class="keywordtype">id</span>,6*<span class="keywordtype">id</span>+6)) + 0;</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    <span class="keywordtype">double</span> xi    = state.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    <span class="keywordtype">double</span> yi    = state.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <span class="keywordtype">double</span> zi    = state.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0];</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    <span class="keywordtype">double</span> theta = state.ptr&lt;<span class="keywordtype">double</span>&gt;(3)[0];</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    <span class="keywordtype">double</span> phi   = state.ptr&lt;<span class="keywordtype">double</span>&gt;(4)[0];</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;    <span class="keywordtype">double</span> rho   = state.ptr&lt;<span class="keywordtype">double</span>&gt;(5)[0];</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;    <span class="comment">//double rho   = (state.ptr&lt;double&gt;(5)[0] + m_rho)/2.0;</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    <span class="comment">//xyz.x = xi + cos(phi)*sin(theta)*exp(rho);  // ========避免负的逆深度?????????</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;    <span class="comment">//xyz.y = yi - sin(phi)*exp(rho);</span></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    <span class="comment">//xyz.z = zi + cos(phi)*cos(theta)*exp(rho);</span></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    xyz.x = xi + cos(phi)*sin(theta)/rho;</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    xyz.y = yi - sin(phi)/rho;</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    xyz.z = zi + cos(phi)*cos(theta)/rho;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;    Mat dFw_dYi = Mat::eye(3, 6, CV_64F);</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;    Mat dFw_dthetaphirho = (Mat_&lt;double&gt;(3,3) &lt;&lt;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;         cos(phi)*cos(theta)/rho,   -sin(phi)*sin(theta)/rho,   -cos(phi)*sin(theta)/(rho*rho),</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;         0,                         -cos(phi)/rho,               sin(phi)/(rho*rho),</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        -cos(phi)*sin(theta)/rho,   -sin(phi)*cos(theta)/rho,   -cos(phi)*cos(theta)/(rho*rho));</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    dFw_dthetaphirho.copyTo(dFw_dYi(Range::all(),Range(3,6)));</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;    cov = dFw_dYi*<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>(Range(6*<span class="keywordtype">id</span>,6*<span class="keywordtype">id</span>+6),Range(6*<span class="keywordtype">id</span>,6*<span class="keywordtype">id</span>+6))*(dFw_dYi.t());</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    sr  = <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>(Range(6*<span class="keywordtype">id</span>,6*<span class="keywordtype">id</span>+6), Range(Range(6*<span class="keywordtype">id</span>,6*<span class="keywordtype">id</span>+6))) + 0;</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;}</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;</div>
<div class="line"><a name="l02750"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#af97ddaae9d75b625d2c9b051232eb57b"> 2750</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#af97ddaae9d75b625d2c9b051232eb57b">CSLAM::coordinatesInverseDepth2Cartesian</a>(Point3d &amp;xyz, <span class="keyword">const</span> Mat &amp;position, <span class="keyword">const</span> Mat &amp;state)<span class="keyword"> const</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    <span class="keywordtype">double</span> xi    = position.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;    <span class="keywordtype">double</span> yi    = position.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <span class="keywordtype">double</span> zi    = position.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0];</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    <span class="keywordtype">double</span> theta = state.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;    <span class="keywordtype">double</span> phi   = state.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    <span class="keywordtype">double</span> rho   = state.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0];</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    <span class="comment">//double rho   = (state.ptr&lt;double&gt;(2)[0] + m_rho)/2.0;</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    xyz.x = xi + cos(phi)*sin(theta)/rho;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    xyz.y = yi - sin(phi)/rho;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    xyz.z = zi + cos(phi)*cos(theta)/rho;</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;}</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;</div>
<div class="line"><a name="l02776"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a6a1a915046eb327cb33a4424eda2bdcc"> 2776</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a6a1a915046eb327cb33a4424eda2bdcc">CSLAM::get3DdisplayInformation</a> (<a class="code" href="struct_quaternion.html">Quaternion</a> &amp;axis, Point3d &amp;sigma, <span class="keyword">const</span> Mat &amp;matrix)<span class="keyword"> const</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    Mat eigenvalues  = Mat::zeros(3,3,CV_32FC1);  <span class="comment">//the eigenvalues are stored in the diag</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    Mat eigenvectors = Mat::zeros(3,3,CV_32FC1);</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#aba782c591b58352bd24cec8ea470c20a">calculateEigenvaluesAndEigenvectors</a>(matrix, eigenvalues, eigenvectors);</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a8eea906e350c8babe0cc551baaae6d5a">matrix2Quaternion</a>(axis, eigenvectors);</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    sigma.x =  sqrt(eigenvalues.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0]);</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    sigma.y =  sqrt(eigenvalues.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[1]);</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;    sigma.z =  sqrt(eigenvalues.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[2]);   <span class="comment">//calculate the std-covariance</span></div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;}</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div>
<div class="line"><a name="l02800"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#aba782c591b58352bd24cec8ea470c20a"> 2800</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_s_l_a_m.html#aba782c591b58352bd24cec8ea470c20a">CSLAM::calculateEigenvaluesAndEigenvectors</a>(Mat src, Mat &amp;eigenvalues, Mat &amp;eigenvectors)<span class="keyword"> const</span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="keywordtype">int</span> i, j, p, q, l, n, jt;</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="keywordtype">double</span> fm,cn,sn,omega,x,y,d;</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    n = src.rows;</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    l = 1;</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    jt = n*n*30;</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    src.copyTo(eigenvalues);</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    eigenvectors = Mat::eye(eigenvalues.rows, eigenvalues.cols, CV_64F);</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;    <span class="keywordflow">while</span> (1)</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;    { </div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;        fm = 0.0;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;        <span class="keywordflow">for</span> (i = 1; i &lt;= n-1; i++)</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;        {</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;            <span class="keywordflow">for</span> (j = 0; j &lt;= i-1; j++)</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;            { </div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                d = fabs(eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(i,j));</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;                <span class="keywordflow">if</span> ((i!=j)&amp;&amp;(d&gt;fm))</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;                {</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;                    fm=d;</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;                    p=i;</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;                    q=j;</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;                }</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;            }</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;        }</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;        <span class="keywordflow">if</span> (fm &lt; <a class="code" href="class_c_s_l_a_m.html#a24751bbd1328ceedc0d2d0c4008fb9f7">EPSILON</a>)   </div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;            <span class="keywordflow">return</span>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;        <span class="keywordflow">if</span> (l &gt; jt) </div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;            <span class="keywordflow">return</span>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        l = l + 1;</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;        x = -eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(p,q); </div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;        y = (eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(q,q) - eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(p,p))/2.0;</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;        omega = x/sqrt(x*x + y*y);</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;        <span class="keywordflow">if</span> (y&lt;0.0)  </div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;            omega = -omega;</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;        sn = 1.0+sqrt(1.0 - omega*omega);</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;        sn = omega/sqrt(2.0*sn);</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;        cn = sqrt(1.0 - sn*sn);</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;        fm = eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(p,p);</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;        eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(p,p) = fm*cn*cn + eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(q,q)*sn*sn + eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(p,q)*omega;</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(q,q) = fm*sn*sn + eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(q,q)*cn*cn - eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(p,q)*omega;</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;        eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(p,q) = 0.0; </div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;        eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(q,p) = 0.0;</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;        <span class="keywordflow">for</span> (j=0; j &lt;= n-1; j++)</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;        {</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;            <span class="keywordflow">if</span> ((j!=p) &amp;&amp; (j!=q))</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;            { </div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                fm=eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(p,j);</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(p,j) = fm*cn  + eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(q,j)*sn;</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;                eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(q,j) = -fm*sn + eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(q,j)*cn;</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;            }</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;        }</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        <span class="keywordflow">for</span> (i=0; i&lt;=n-1; i++)</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        {</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;            <span class="keywordflow">if</span> ((i!=p) &amp;&amp; (i!=q))</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;            {</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;                fm = eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(i,p);</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;                eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(i,p) = fm*cn  + eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(i,q)*sn;</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;                eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(i,q) = -fm*sn + eigenvalues.at&lt;<span class="keywordtype">double</span>&gt;(i,q)*cn;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;            }</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;        }</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;        <span class="keywordflow">for</span> (i=0; i &lt;= n-1; i++)</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;        { </div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;            fm = eigenvectors.at&lt;<span class="keywordtype">double</span>&gt;(i,p);</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;            eigenvectors.at&lt;<span class="keywordtype">double</span>&gt;(i,p) = fm*cn  + eigenvectors.at&lt;<span class="keywordtype">double</span>&gt;(i,q)*sn;</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;            eigenvectors.at&lt;<span class="keywordtype">double</span>&gt;(i,q) = -fm*sn + eigenvectors.at&lt;<span class="keywordtype">double</span>&gt;(i,q)*cn;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;        }</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    }</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;}</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;</div>
<div class="line"><a name="l02888"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a8eea906e350c8babe0cc551baaae6d5a"> 2888</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a8eea906e350c8babe0cc551baaae6d5a">CSLAM::matrix2Quaternion</a>(<a class="code" href="struct_quaternion.html">Quaternion</a> &amp;quaternion, <span class="keyword">const</span> Mat &amp;matrix)<span class="keyword"> const</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    <span class="keywordtype">double</span> m11, m12, m13, m21, m22, m23, m31, m32, m33, tmp;</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;    m11 = matrix.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];  m12 = matrix.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[1];  m13 = matrix.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[2];</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    m21 = matrix.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];  m22 = matrix.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[1];  m23 = matrix.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[2];</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    m31 = matrix.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0];  m32 = matrix.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[1];  m33 = matrix.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[2];</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    <span class="keywordtype">double</span> tr = m11 + m22 +m33;</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <span class="keywordflow">if</span>(tr &gt; 0.0)</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    {</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;        tmp = 0.5 / sqrt(tr + 1);</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        quaternion.<a class="code" href="struct_quaternion.html#a3038e7e4cec6f26920d52daf0ea2c777">r</a> = 0.25 / tmp; </div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        quaternion.<a class="code" href="struct_quaternion.html#a65c93d8db6c57203447bd0594b608512">x</a> = (m23 - m32) * tmp;</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;        quaternion.<a class="code" href="struct_quaternion.html#acfea23e3ba2b57356fe36b4d8f4c52f3">y</a> = (m31 - m13) * tmp;</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        quaternion.<a class="code" href="struct_quaternion.html#a90bbdb05526bddfbc3247dcc9a5cace4">z</a> = (m12 - m21) * tmp;</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;    }</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    {</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;        <span class="keywordflow">if</span>(m11 &gt; m22 &amp;&amp; m11 &gt; m33)</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        {</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;            tmp = 2.0 * sqrt(1.0 + m11 - m22 - m33);</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#a3038e7e4cec6f26920d52daf0ea2c777">r</a> = (m32 - m23) / tmp;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#a65c93d8db6c57203447bd0594b608512">x</a> = 0.25 * tmp;</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#acfea23e3ba2b57356fe36b4d8f4c52f3">y</a> = (m12 + m21) / tmp;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#a90bbdb05526bddfbc3247dcc9a5cace4">z</a> = (m13 + m31) / tmp;</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        }</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( m22 &gt; m33)</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;        {</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;            tmp = 2.0 * sqrt(1.0 + m22 - m11 - m33);</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#a3038e7e4cec6f26920d52daf0ea2c777">r</a> = (m13 - m31) / tmp;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#a65c93d8db6c57203447bd0594b608512">x</a> = (m12 + m21) / tmp;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#acfea23e3ba2b57356fe36b4d8f4c52f3">y</a> = 0.25 * tmp;</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#a90bbdb05526bddfbc3247dcc9a5cace4">z</a> = (m23 + m32) / tmp;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        }</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        {</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;            tmp = 2.0 * sqrt(1.0 + m33 - m11 - m22);</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#a3038e7e4cec6f26920d52daf0ea2c777">r</a> = (m21 - m12) / tmp;</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#a65c93d8db6c57203447bd0594b608512">x</a> = (m13 + m31) / tmp;</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#acfea23e3ba2b57356fe36b4d8f4c52f3">y</a> = (m23 + m32) / tmp;</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;            quaternion.<a class="code" href="struct_quaternion.html#a90bbdb05526bddfbc3247dcc9a5cace4">z</a> = 0.25 * tmp;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        }</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    }</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;}</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;</div>
<div class="line"><a name="l02942"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a10360bc4e0d9ba5d21d6b62e162eff4d"> 2942</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a10360bc4e0d9ba5d21d6b62e162eff4d">CSLAM::updateRobotInformation</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;{</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    <span class="keywordtype">int</span> dim   = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    <span class="keywordtype">int</span> index = 2*<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>;</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordtype">double</span> x_now, y_now, theta_now;</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;    x_now = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-4)[0];</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;    y_now = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-3)[0];</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    theta_now = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-1)[0];</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;    *(<a class="code" href="class_c_s_l_a_m.html#a77a867e6669ffd4af12c45b66658c4fb">m_path</a>+index+0) = x_now;</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    *(<a class="code" href="class_c_s_l_a_m.html#a77a867e6669ffd4af12c45b66658c4fb">m_path</a>+index+1) = y_now;</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <span class="comment">//Mat cov = m_S_k(Rect(dim-4,dim-4,3,3)).t()*m_S_k(Rect(dim-4,dim-4,3,3));</span></div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;    <span class="comment">//cov.copyTo(m_robotInfo.Cov);</span></div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    <span class="comment">//get3DdisplayInformation(m_robotInfo.Axis, m_robotInfo.Sigma, cov);</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    <span class="comment">//m_robotAllInfo.push_back(robotInfo);  //==========可把机器人位置转成二维?????????</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    <span class="comment">// Show robot&#39;s information in list control</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;    <span class="keywordtype">char</span> <span class="keywordtype">id</span>[10];</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    <span class="keywordtype">char</span> x[50], y[50], theta[50];</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;    sprintf_s(<span class="keywordtype">id</span>, <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="class_c_s_l_a_m.html#aaf16d659d0fc08eab4394f4c19174171">m_showCounter</a>);</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    sprintf_s(x, <span class="stringliteral">&quot;%f&quot;</span>, x_now);</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;    sprintf_s(y, <span class="stringliteral">&quot;%f&quot;</span>, y_now);</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;    sprintf_s(theta, <span class="stringliteral">&quot;%f&quot;</span>, theta_now*180.0/3.141593);</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(0, 1, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(0, 2, x);</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(0, 3, y);</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(0, 4, theta);</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#a26010d877c4d12b5f74daba05e06e679">isShowOdoCtrlList</a>)</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;    {</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        sprintf_s(x, <span class="stringliteral">&quot;%f&quot;</span>, *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+0));</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;        sprintf_s(y, <span class="stringliteral">&quot;%f&quot;</span>, *(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+index+1));</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;        sprintf_s(theta, <span class="stringliteral">&quot;%f&quot;</span>, <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>]*180.0/3.141593);</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(1, 1, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(1, 2, x);</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(1, 3, y);</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(1, 4, theta);</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    }</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;}</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;</div>
<div class="line"><a name="l02994"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a6a20501ec9668e00d5e8b691fa9553af"> 2994</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a6a20501ec9668e00d5e8b691fa9553af">CSLAM::display2DFeatureModel</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;{</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    <span class="keywordtype">char</span> num[10];   <span class="comment">// 用于显示ID号</span></div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    Mat Pi(2, 2, CV_64F);</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    CvFont font;</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;    CvPoint pt_p, pt_m;</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    cvInitFont(&amp;font, CV_FONT_HERSHEY_SIMPLEX, 1.0, 1.0, 0, 3, 8);</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    <span class="keywordflow">if</span> (0 != <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>)</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    {</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;        <a class="code" href="struct_points_map.html">PointsMap</a>* map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        <span class="keywordflow">while</span> (NULL != map_p)</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        {</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;            <span class="keywordflow">if</span> ((<span class="keyword">true</span> == map_p-&gt;<a class="code" href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">isMatching</a>))<span class="comment">// &amp;&amp; (false == map_p-&gt;isDelay))</span></div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;            {</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;                _itoa_s(map_p-&gt;<a class="code" href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">ID</a>, num, 10);  <span class="comment">// 类型转换</span></div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;                pt_p = map_p-&gt;<a class="code" href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">predictLocation</a>;</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;                pt_m = map_p-&gt;<a class="code" href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">matchLocation</a>;</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;                Pi = map_p-&gt;<a class="code" href="struct_points_map.html#ac3d0d40cd5657fc02be8893f6cb3cb79">Si</a>.t()*map_p-&gt;<a class="code" href="struct_points_map.html#ac3d0d40cd5657fc02be8893f6cb3cb79">Si</a>;</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;                <span class="comment">//=========For all predicted keypoints, draw on blue color==============//</span></div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;                cvPutText(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, num, pt_p, &amp;font, CV_RGB(0,0,255));</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;                cvLine(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, cvPoint(pt_p.x-10, pt_p.y), cvPoint(pt_p.x+10, pt_p.y), CV_RGB(0,0,255),2,8,0);</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                cvLine(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, cvPoint(pt_p.x, pt_p.y-10), cvPoint(pt_p.x, pt_p.y+10), CV_RGB(0,0,255),2,8,0);</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;                <span class="comment">//=========For all matched keypoints, draw on red color==============//</span></div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;                cvPutText(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, num, pt_m, &amp;font, CV_RGB(255,0,0));</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;                cvLine(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, cvPoint(pt_m.x-10, pt_m.y), cvPoint(pt_m.x+10, pt_m.y), CV_RGB(255,0,0),2,8,0);</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;                cvLine(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, cvPoint(pt_m.x, pt_m.y-10), cvPoint(pt_m.x, pt_m.y+10), CV_RGB(255,0,0),2,8,0);</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;                <a class="code" href="class_c_s_l_a_m.html#ae6ad9eaab8b872d6eac419b16248139d">draw2DEllipse</a>(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, pt_m, Pi, CV_RGB(255,0,0), 2);</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;            }</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;            map_p = map_p-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>; </div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;        }</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    }</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    </div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    <a class="code" href="class_c_cv_image.html">CCvImage</a> img;</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;    img.<a class="code" href="class_c_cv_image.html#a980e9e3233fc9573bcc9a51390d9a420">CopyOf</a>(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>,1);</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    img.DrawToHDC(<a class="code" href="class_c_s_l_a_m.html#a7b5d9985b9dda0112cf3d274d0f1fd60">m_pDc</a>-&gt;GetSafeHdc(),&amp;<a class="code" href="class_c_s_l_a_m.html#a69844c2d815fca5ecfe2e41ee77f0f13">m_rect</a>);</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;}</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;</div>
<div class="line"><a name="l03052"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#ae6ad9eaab8b872d6eac419b16248139d"> 3052</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#ae6ad9eaab8b872d6eac419b16248139d">CSLAM::draw2DEllipse</a> (IplImage* displayImage, <span class="keyword">const</span> CvPoint &amp;center, <span class="keyword">const</span> Mat &amp;covMatrix,</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <span class="keyword">const</span> CvScalar color, <span class="keywordtype">int</span> thickness)<span class="keyword"> const</span></div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    Mat eigenvalues = Mat::zeros(2,1,CV_64F);</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    Mat eigenvectors = Mat::zeros(2,2,CV_64F);</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;    <span class="keywordflow">if</span>(!eigen(covMatrix,eigenvalues,eigenvectors))  return ;</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    CvSize size;</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;    size.width =  int(sqrt(eigenvalues.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0])*sqrt(<a class="code" href="class_c_s_l_a_m.html#a1fd92be09384ae1139a51d8ee4887020">CHI2INV_TABLE</a>(0,2)));</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    size.height = int(sqrt(eigenvalues.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0])*sqrt(<a class="code" href="class_c_s_l_a_m.html#a1fd92be09384ae1139a51d8ee4887020">CHI2INV_TABLE</a>(0,2)));</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    size.width = max(1, size.width);</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    size.height = max(1, size.height);</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;    <span class="keywordtype">double</span> angle = (double)(atan2(eigenvectors.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[1],eigenvectors.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0])*180.0/CV_PI);</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;    cvEllipse(displayImage, center, size, angle, 0, 360, color, thickness);</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;}</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;</div>
<div class="line"><a name="l03075"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a8c626c79d95044923a478f12fd86d5ff"> 3075</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a8c626c79d95044923a478f12fd86d5ff">CSLAM::resetAllParameters</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;{</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;    vector&lt;FeatureInfo&gt;().swap(<a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>);</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;    <span class="keywordflow">while</span> (NULL != <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>)</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;    {</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;        <a class="code" href="struct_points_map.html">PointsMap</a>* map_p = <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>-&gt;<a class="code" href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">next</a>;</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;        <span class="keyword">delete</span> <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a>;</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">map</a> = map_p;</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;    }</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;    fclose(<a class="code" href="class_c_s_l_a_m.html#a9be9d3353e795d702436c03d09cfc831">m_odometryFile</a>);</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#affcfd894a4b426b0bfb875dbf24dd133">initializeParameters</a>();</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;    <span class="comment">// Reset information for features&#39; show</span></div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a62c42ac100361d94d003ea8c4f9b1781">m_showFeatureInfo</a>.SetSel(0,-1);</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a62c42ac100361d94d003ea8c4f9b1781">m_showFeatureInfo</a>.Clear();</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;    <span class="comment">// Show information for robot&#39;s location show</span></div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;    <span class="keywordtype">char</span> theta[50];</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;    sprintf_s(theta, <span class="stringliteral">&quot;%f&quot;</span>, <a class="code" href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">m_odoTheta</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0]*180.0/3.141593);</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(0, 1, <span class="stringliteral">&quot;1&quot;</span>);</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(0, 4, theta);</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++)</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    {</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(0, i+2, <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    }</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;    <span class="keywordflow">if</span> (TRUE == <a class="code" href="class_c_s_l_a_m.html#a26010d877c4d12b5f74daba05e06e679">isShowOdoCtrlList</a>)</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    {</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(1, 1, <span class="stringliteral">&quot;1&quot;</span>);</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(1, 4, theta);</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++)</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;        {</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;            <a class="code" href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">m_listCtrl</a>.SetItemText(1, i+2, <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;        }</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    }</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;}</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;</div>
<div class="line"><a name="l03126"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a8fbff8e37747435d7038c7c070d6fcc8"> 3126</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a8fbff8e37747435d7038c7c070d6fcc8">CSLAM::calculateCrossCorrelation</a> (<span class="keywordtype">double</span> &amp;corr,<span class="keyword">const</span> Mat &amp;src1,<span class="keyword">const</span> Mat &amp;src2)<span class="keyword">const</span></div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;    Scalar avg1,avg2;</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;    Scalar std1, std2;</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;    Mat num1(src1.rows, src1.cols, CV_64F);</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;    Mat num2(src2.rows, src2.cols, CV_64F);</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;    src1.convertTo(num1,CV_64F);</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    src2.convertTo(num2,CV_64F);</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;    avg1 = cv::mean(num1);</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;    avg2 = cv::mean(num2);</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;    num1-=avg1(0);</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;    num2-=avg2(0);</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    std1 = cv::norm(num1);</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    std2 = cv::norm(num2);</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    corr = num1.dot(num2);</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;    <span class="keywordflow">if</span>(std1(0)==0 || std2(0)==0)</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;        corr=0;</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;        corr=corr/std1(0)/std2(0);</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;}</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;</div>
<div class="line"><a name="l03162"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a3721327d0b02a524662bc1b5fb4e564d"> 3162</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a3721327d0b02a524662bc1b5fb4e564d">CSLAM::distortOnePointRW</a> (Point2d &amp;uvd, <span class="keyword">const</span> Point2d &amp;uvu)<span class="keyword"> const</span></div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    <span class="keywordtype">double</span> f, ff;</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <span class="keywordtype">double</span> xu = (uvu.x-<a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a>)*<a class="code" href="class_c_s_l_a_m.html#aa47960604a1b02265860649d240d8cbc">cam_dx</a>;  <span class="comment">// similar to the model in book</span></div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    <span class="keywordtype">double</span> yu = (uvu.y-<a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a>)*<a class="code" href="class_c_s_l_a_m.html#a5cdb60999eef72cc5c1a974494832506">cam_dy</a>;</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    <span class="keywordtype">double</span> ru = sqrt(xu*xu+yu*yu);</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    <span class="keywordtype">double</span> rd = ru/( 1+<a class="code" href="class_c_s_l_a_m.html#a88d74ecfef345368df31b591c8c258f3">cam_k1</a>*ru*ru+<a class="code" href="class_c_s_l_a_m.html#a7174e985af7a5d59bf398d9d1fb5137f">cam_k2</a>*pow(ru,4));</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    <span class="keywordtype">int</span> iterationNum = 100;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;iterationNum; i++)</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;    {</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;        f  = rd  + <a class="code" href="class_c_s_l_a_m.html#a88d74ecfef345368df31b591c8c258f3">cam_k1</a>*pow(rd,3)+<a class="code" href="class_c_s_l_a_m.html#a7174e985af7a5d59bf398d9d1fb5137f">cam_k2</a>*pow(rd,5)-ru;</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;        ff = 1.0 + 3.0*<a class="code" href="class_c_s_l_a_m.html#a88d74ecfef345368df31b591c8c258f3">cam_k1</a>*rd*rd+5.0*<a class="code" href="class_c_s_l_a_m.html#a7174e985af7a5d59bf398d9d1fb5137f">cam_k2</a>*pow(rd,4);</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;        rd = rd  - f/ff;</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    }</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    <span class="keywordtype">double</span> d  = 1+<a class="code" href="class_c_s_l_a_m.html#a88d74ecfef345368df31b591c8c258f3">cam_k1</a>*rd*rd+<a class="code" href="class_c_s_l_a_m.html#a7174e985af7a5d59bf398d9d1fb5137f">cam_k2</a>*pow(rd,4);</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <span class="keywordflow">if</span> (d == 0) </div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;        d = <a class="code" href="class_c_s_l_a_m.html#a24751bbd1328ceedc0d2d0c4008fb9f7">EPSILON</a>;</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    <span class="keywordtype">double</span> xd = xu/d;</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    <span class="keywordtype">double</span> yd = yu/d;</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    uvd.x = <a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a>+xd/<a class="code" href="class_c_s_l_a_m.html#aa47960604a1b02265860649d240d8cbc">cam_dx</a>;                   <span class="comment">/*图像坐标系下加扭曲后的点坐标*/</span></div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;    uvd.y = <a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a>+yd/<a class="code" href="class_c_s_l_a_m.html#a5cdb60999eef72cc5c1a974494832506">cam_dy</a>;                   <span class="comment">/*参考matlab: distor_a_point*/</span></div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    <span class="keywordtype">bool</span> isVisible = (uvd.x&gt;=0) &amp;&amp; (uvd.x &lt;= <a class="code" href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">imageWidth</a>) &amp;&amp; (uvd.y&gt;=0) &amp;&amp; (uvd.y&lt;=<a class="code" href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">imageHeight</a>);</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">false</span> == isVisible)   <span class="comment">// whether is visible or not</span></div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;    {</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;        uvd.x = 0;</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;        uvd.y = 0;</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;    }</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;}</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;</div>
<div class="line"><a name="l03209"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a0dfc931db26c1fed0892384c086f40f8"> 3209</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a0dfc931db26c1fed0892384c086f40f8">CSLAM::undistortOnePointRW</a> (Point2d &amp;uvu, <span class="keyword">const</span> Point2d &amp;uvd)<span class="keyword"> const</span></div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;    <span class="keywordtype">double</span> xd = (uvd.x-<a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a>)*<a class="code" href="class_c_s_l_a_m.html#aa47960604a1b02265860649d240d8cbc">cam_dx</a>;  <span class="comment">// point点为像素坐标（扭曲的）</span></div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;    <span class="keywordtype">double</span> yd = (uvd.y-<a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a>)*<a class="code" href="class_c_s_l_a_m.html#a5cdb60999eef72cc5c1a974494832506">cam_dy</a>;</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    <span class="keywordtype">double</span> rd = sqrt(xd*xd+yd*yd);</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    <span class="keywordtype">double</span> d = 1+<a class="code" href="class_c_s_l_a_m.html#a88d74ecfef345368df31b591c8c258f3">cam_k1</a>*pow(rd,2)+<a class="code" href="class_c_s_l_a_m.html#a7174e985af7a5d59bf398d9d1fb5137f">cam_k2</a>*pow(rd,4);</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    <span class="keywordtype">double</span> xu = xd*d;</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;    <span class="keywordtype">double</span> yu = yd*d;</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;    uvu.x = <a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a>+xu/<a class="code" href="class_c_s_l_a_m.html#aa47960604a1b02265860649d240d8cbc">cam_dx</a>;   </div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;    uvu.y = <a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a>+yu/<a class="code" href="class_c_s_l_a_m.html#a5cdb60999eef72cc5c1a974494832506">cam_dy</a>;   </div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;}</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;</div>
<div class="line"><a name="l03235"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#ab5b37bf7b14dd233ac4171797a035eda"> 3235</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#ab5b37bf7b14dd233ac4171797a035eda">CSLAM::coordinatesState2World</a> (Mat &amp;Hlw, <span class="keyword">const</span> Mat &amp;state, <span class="keyword">const</span> Mat &amp;cam_position)<span class="keyword"> const</span></div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    <span class="keywordtype">double</span> xi    = state.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    <span class="keywordtype">double</span> yi    = state.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    <span class="keywordtype">double</span> zi    = state.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0];</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    <span class="keywordtype">double</span> theta = state.ptr&lt;<span class="keywordtype">double</span>&gt;(3)[0];</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    <span class="keywordtype">double</span> phi   = state.ptr&lt;<span class="keywordtype">double</span>&gt;(4)[0];</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    <span class="keywordtype">double</span> rho   = state.ptr&lt;<span class="keywordtype">double</span>&gt;(5)[0];</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;    <span class="comment">//if (rho == 0.0)</span></div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    <span class="comment">//  rho = EPSINON;  </span></div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;    <span class="comment">//  cout&lt;&lt;&quot;There is a bug in the program!&quot;&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;    <span class="comment">//  system(&quot;pause&quot;);</span></div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;    <span class="comment">//Hlw = (Mat_&lt;double&gt;(3,1) &lt;&lt;     </span></div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;    <span class="comment">//  rho*(xi - cam_position.ptr&lt;double&gt;(0)[0]) + cos(phi)*sin(theta), </span></div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    <span class="comment">//  rho*(yi - cam_position.ptr&lt;double&gt;(1)[0]) - sin(phi), </span></div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;    <span class="comment">//  rho*(zi - cam_position.ptr&lt;double&gt;(2)[0]) + cos(phi)*cos(theta));          </span></div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;    Hlw = (Mat_&lt;double&gt;(3,1) &lt;&lt;           </div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;        xi + 1/rho*cos(phi)*sin(theta) - cam_position.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0], </div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;        yi - 1/rho*sin(phi) - cam_position.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0],</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;        zi + 1/rho*cos(phi)*cos(theta) - cam_position.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0]);         </div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;}</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;</div>
<div class="line"><a name="l03274"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a22e6803a4e1b4f01003138cab269ed27"> 3274</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a22e6803a4e1b4f01003138cab269ed27">CSLAM::coordinatesWorld2Camera</a> (Mat &amp;Hlr, <span class="keyword">const</span> Mat &amp;Hlw, <span class="keyword">const</span> Mat &amp;Rcw)<span class="keyword"> const</span></div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;    <span class="comment">//Hlr = Rcw*(Hlw - T);</span></div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    Hlr = Rcw*Hlw;</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;    <span class="comment">//multiply(Rcw, Hlw, Hlr); </span></div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    <span class="comment">//if (Hlr.ptr&lt;double&gt;(2)[0] == 0)       </span></div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;    <span class="comment">//  Hlr.ptr&lt;double&gt;(2)[0] = EPSINON;</span></div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;    <span class="comment">//double Hlr_x = Hlr.ptr&lt;double&gt;(0)[0];</span></div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    <span class="comment">//double Hlr_y = Hlr.ptr&lt;double&gt;(1)[0];</span></div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;    <span class="comment">//double Hlr_z = Hlr.ptr&lt;double&gt;(2)[0];</span></div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;    <span class="comment">//double camera_theta = atan2(Hlr_x,Hlr_z)*180/CV_PI;</span></div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;    <span class="comment">//double camera_phi   = atan2(Hlr_y,Hlr_z)*180/CV_PI;</span></div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;    <span class="comment">//bool isInHFOV = camera_theta &gt; (-1)*HFOV &amp;&amp; camera_theta &lt; HFOV &amp;&amp; camera_phi &gt; (-1)*HFOV &amp;&amp; camera_phi &lt; HFOV;</span></div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    <span class="comment">//if (false == isInHFOV) // whether the feature is in front of the camera or not</span></div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;    <span class="comment">//  Hlr = Mat::zeros(3, 1, CV_64F);  </span></div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;}</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;</div>
<div class="line"><a name="l03309"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a29508ebc6507aab0b651c6b0f4264c40"> 3309</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a29508ebc6507aab0b651c6b0f4264c40">CSLAM::coordinatesCamera2Image</a> (Point2d &amp;uvu, <span class="keyword">const</span> Mat &amp;Hlr, <span class="keyword">const</span> Mat &amp;error)<span class="keyword"> const</span></div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;    <span class="keywordtype">double</span> Hlr_x = Hlr.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;    <span class="keywordtype">double</span> Hlr_y = Hlr.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;    <span class="keywordtype">double</span> Hlr_z = Hlr.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0];</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;    <span class="comment">// whether the feature is in HFOV or not</span></div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;    <span class="keywordflow">if</span> (Hlr_z==0)   <span class="comment">// ========需改进判断形式???????????</span></div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;    {</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;        uvu.x = 0;</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;        uvu.y = 0;</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;    } </div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;    {</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;        uvu.y = <a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a> + <a class="code" href="class_c_s_l_a_m.html#a93e54316c1d69437d1e955906da90064">cam_f1</a>*Hlr_x/Hlr_z + error.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;        uvu.x = <a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a> + <a class="code" href="class_c_s_l_a_m.html#a47d15f82401fd04de6c5533606c5b6db">cam_f2</a>*Hlr_y/Hlr_z + error.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        <span class="keywordflow">if</span> (uvu.x &lt; 10 || uvu.x &gt;<a class="code" href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">imageWidth</a>-10 || uvu.y &lt; 10 || uvu.y &gt; <a class="code" href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">imageHeight</a>-10)</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        {</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;            uvu.x = 0;</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;            uvu.y = 0;</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;        }</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    }</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;}</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;</div>
<div class="line"><a name="l03343"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a86bf11bd122694e1b4950bcb8f78f87b"> 3343</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a86bf11bd122694e1b4950bcb8f78f87b">CSLAM::coordinatesImage2Camera</a> (Mat &amp;Hlr, <span class="keyword">const</span> Point2d &amp; uvu)<span class="keyword"> const</span></div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;    Hlr = (Mat_&lt;double&gt;(3,1) &lt;&lt;</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;        (uvu.y - <a class="code" href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">cam_cx</a>)/<a class="code" href="class_c_s_l_a_m.html#a93e54316c1d69437d1e955906da90064">cam_f1</a>,</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;        (uvu.x - <a class="code" href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">cam_cy</a>)/<a class="code" href="class_c_s_l_a_m.html#a47d15f82401fd04de6c5533606c5b6db">cam_f2</a>,</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;        1);</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    <span class="comment">//Hlr = (Mat_&lt;double&gt;(3,1) &lt;&lt;</span></div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;    <span class="comment">//  (cam_cx - uvu.x)/cam_f1,</span></div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    <span class="comment">//  (cam_cy - uvu.y)/cam_f2,</span></div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;    <span class="comment">//  1);</span></div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;}</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;</div>
<div class="line"><a name="l03367"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#ad1df413b1dae707612b6bb47b20c8f4f"> 3367</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#ad1df413b1dae707612b6bb47b20c8f4f">CSLAM::coordinatesCamera2World</a> (Mat &amp;Hlw, <span class="keyword">const</span> Mat &amp;Hlr, <span class="keyword">const</span> Mat &amp;Rwc)<span class="keyword"> const</span></div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;    <span class="comment">//multiply(Rwc, Hlr, Hlw);</span></div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;    <span class="comment">//Hlw = Rwc*Hlr + T;  </span></div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;    Hlw = Rwc*Hlr;</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;}</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;</div>
<div class="line"><a name="l03386"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#ae0f220bb7df0075321b3abfcd39a05ba"> 3386</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#ae0f220bb7df0075321b3abfcd39a05ba">CSLAM::coordinatesWorld2State</a> (Mat &amp;state, <span class="keyword">const</span> Mat &amp;Hlw, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;rho)<span class="keyword"> const</span></div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    state.create(3, 1, CV_64F);</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    <span class="keywordtype">double</span> Hlw_x = Hlw.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0];</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    <span class="keywordtype">double</span> Hlw_y = Hlw.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0];</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;    <span class="keywordtype">double</span> Hlw_z = Hlw.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0];</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;    <span class="comment">//double theta = atan2(Hlw_x,Hlw_z);</span></div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    <span class="comment">//double phi   = atan2(-Hlw_y,sqrt( Hlw_x*Hlw_x + Hlw_z*Hlw_z));</span></div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;    <span class="keywordtype">double</span> theta = atan2(Hlw_x, Hlw_z);</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;    <span class="keywordtype">double</span> phi   = atan2(-Hlw_y,sqrt( Hlw_x*Hlw_x + Hlw_z*Hlw_z));</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;    <span class="comment">//wrapAngle(theta);</span></div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;    <span class="comment">//wrapAngle(phi);</span></div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    state.ptr&lt;<span class="keywordtype">double</span>&gt;(0)[0] = theta;</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    state.ptr&lt;<span class="keywordtype">double</span>&gt;(1)[0] = phi;</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;    state.ptr&lt;<span class="keywordtype">double</span>&gt;(2)[0] = rho;</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;}</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;<span class="comment">// Datatype convert: gsl_matrix to Mat.</span></div>
<div class="line"><a name="l03417"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a3fdb7bea1f813ef9bda6d3d243d6cfc0"> 3417</a></span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a3fdb7bea1f813ef9bda6d3d243d6cfc0">CSLAM::dataTypeCVMat2GSLMat</a> (gsl_matrix *gsl_mat, <span class="keyword">const</span> Mat &amp;cv_mat)<span class="keyword"> const</span></div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;    <span class="keywordtype">int</span> dimx = cv_mat.rows;</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;    <span class="keywordtype">int</span> dimy = cv_mat.cols;</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;dimx; m++)</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;    {</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n&lt;dimy; n++)</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;        {</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;            gsl_matrix_set(gsl_mat, m, n, cv_mat.ptr&lt;<span class="keywordtype">double</span>&gt;(m)[n]);</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;        }</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;    }</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;}</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;</div>
<div class="line"><a name="l03439"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a0296a3c396dfcd6a41cab3d8c4b25886"> 3439</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a0296a3c396dfcd6a41cab3d8c4b25886">CSLAM::dataTypeGSLMat2CVMat</a> (Mat &amp;cv_mat, gsl_matrix *gsl_mat)<span class="keyword"> const</span></div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;    <span class="keywordtype">int</span> dimx = gsl_mat-&gt;size1;</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;    <span class="keywordtype">int</span> dimy = gsl_mat-&gt;size2;</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;dimx; m++)</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;    {</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n&lt;dimy; n++)</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;        {</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;            cv_mat.ptr&lt;<span class="keywordtype">double</span>&gt;(m)[n] = gsl_matrix_get(gsl_mat, m, n);</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;        }</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;    }</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    gsl_matrix_free(gsl_mat); <span class="comment">// Note: release memory</span></div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;}</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;</div>
<div class="line"><a name="l03463"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#af573cad7536ec23c885a094dc5e58e51"> 3463</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_c_s_l_a_m.html#af573cad7536ec23c885a094dc5e58e51">CSLAM::isIdBelongsToSet</a> (<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;<span class="keywordtype">id</span>, <span class="keyword">const</span> Mat &amp;set)<span class="keyword"> const</span></div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;    <span class="keywordtype">int</span> num = set.rows;</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num; i++)</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;    {</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;        <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == set.ptr&lt;<span class="keywordtype">double</span>&gt;(i)[0])</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;        {</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;        }</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;    }</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;}</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;</div>
<div class="line"><a name="l03484"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a1a3f3c6d1c6f8e2e07ba7f312606338c"> 3484</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a1a3f3c6d1c6f8e2e07ba7f312606338c">CSLAM::recordData</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;{</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a7edcfd2ccf3dcee926b3c0985e174075">recordRobotInformation</a>();</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a0404597fd653c067002ba5694c0057ab">recordFeaturesInformation</a>();</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;}</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;</div>
<div class="line"><a name="l03497"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a7edcfd2ccf3dcee926b3c0985e174075"> 3497</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a7edcfd2ccf3dcee926b3c0985e174075">CSLAM::recordRobotInformation</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;{</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;    <span class="keywordflow">if</span> (FALSE == <a class="code" href="class_c_s_l_a_m.html#a474a3d5d463b92a548d8deafa0692f82">isRecordRobotInfo</a>)</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;    {</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    }</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;    <span class="keywordflow">if</span> (1 == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>)</div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;    {</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;        <span class="keywordtype">int</span> err_open = fopen_s(&amp;<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>, <a class="code" href="class_c_s_l_a_m.html#a7b2a9db2eb682da022004d15044ad0b6">record_robot_dir</a>, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;        <span class="keywordflow">if</span> (0 != err_open)</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;        {</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;Error occured in storing robot information!&quot;</span>&lt;&lt;endl;</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;            system(<span class="stringliteral">&quot;pause&quot;</span>);</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;        }</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;        </div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%d\t&quot;</span>,1);  <span class="comment">// index</span></div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,0);  <span class="comment">// odometry x</span></div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,0);  <span class="comment">// odometry y</span></div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,0);  <span class="comment">// x</span></div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,0);  <span class="comment">// y</span></div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;        <span class="comment">//fprintf(m_robotFile,&quot;%f\t&quot;,0);  // P00</span></div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;        <span class="comment">//fprintf(m_robotFile,&quot;%f\t&quot;,0);  // P01</span></div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;        <span class="comment">//fprintf(m_robotFile,&quot;%f\t&quot;,0);  // P10</span></div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;        <span class="comment">//fprintf(m_robotFile,&quot;%f\t&quot;,0);  // P11</span></div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-4)[dim-4]);</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-4)[dim-3]);</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-3)[dim-4]);</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-3)[dim-3]);</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    }</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%d\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#aaf16d659d0fc08eab4394f4c19174171">m_showCounter</a>);</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,*(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+2*<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>+0));</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,*(<a class="code" href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">m_odoXY</a>+2*<a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>+1));</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-4)[0]);</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-3)[0]);</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    <span class="comment">//fprintf(ff,&quot;%f\t&quot;,m_X_k.at&lt;double&gt;(dim-1,0));</span></div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-4)[dim-4]);</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-4)[dim-3]);</div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;    <span class="comment">//fprintf(ff,&quot;%f\t&quot;,m_S_k.at&lt;double&gt;(dim-4,dim-1));</span></div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-3)[dim-4]);</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>,<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-3)[dim-3]);</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;    <span class="comment">//fprintf(ff,&quot;%f\t&quot;,m_S_k.at&lt;double&gt;(dim-3,dim-1));</span></div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;    <span class="comment">//fprintf(ff,&quot;%f\t&quot;,m_S_k.at&lt;double&gt;(dim-1,dim-4));</span></div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;    <span class="comment">//fprintf(ff,&quot;%f\t&quot;,m_S_k.at&lt;double&gt;(dim-1,dim-3));</span></div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    <span class="comment">//fprintf(ff,&quot;%f\t&quot;,m_S_k.at&lt;double&gt;(dim-1,dim-1));</span></div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;    fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;}</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;</div>
<div class="line"><a name="l03556"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a0404597fd653c067002ba5694c0057ab"> 3556</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a0404597fd653c067002ba5694c0057ab">CSLAM::recordFeaturesInformation</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;{</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;    <span class="keywordflow">if</span> (FALSE == <a class="code" href="class_c_s_l_a_m.html#a642c877d84c9035e798c38f8b34b5b2d">isRecordFeaturesInfo</a>)</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;    {</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;    }</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;    <span class="comment">//vector&lt;Mat&gt;::size_type i = m_featuresInfo.size();</span></div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;    <span class="keywordflow">if</span> (0 == <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.size())</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;    {</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;    }</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;    </div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    <span class="keywordflow">if</span> (1 == <a class="code" href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">m_frame</a>.<a class="code" href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">counter</a>)</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;    {</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;        <span class="keywordtype">int</span> err_open = fopen_s(&amp;<a class="code" href="class_c_s_l_a_m.html#a843640a658f940a017c243192eba367d">m_featuresFile</a>, <a class="code" href="class_c_s_l_a_m.html#aabafa6b7c7b4ddeeec57f44513fdb8b9">record_features_dir</a>, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;        <span class="keywordflow">if</span> (0 != err_open)</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;        {</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;Error occured store features&#39; information!&quot;</span>&lt;&lt;endl;</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;            system(<span class="stringliteral">&quot;pause&quot;</span>);</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;        }</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;    }</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;    vector&lt;Mat&gt;::size_type start = <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.size() - <a class="code" href="class_c_s_l_a_m.html#a5a2f68b64bde4544e5fc683548205b3d">m_nStores</a>;</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;    <span class="keywordflow">for</span> (vector&lt;Mat&gt;::size_type i = start; i&lt;<a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>.size(); i++)</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;    {</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a843640a658f940a017c243192eba367d">m_featuresFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>, <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[i].position.x);</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a843640a658f940a017c243192eba367d">m_featuresFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>, <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[i].position.y);</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a843640a658f940a017c243192eba367d">m_featuresFile</a>,<span class="stringliteral">&quot;%f\t&quot;</span>, <a class="code" href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">m_featuresAllInfo</a>[i].position.z);</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;        fprintf(<a class="code" href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">m_robotFile</a>,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;    }</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;}</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;</div>
<div class="line"><a name="l03599"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a9f0adde83d660046a803c05d7f74f827"> 3599</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a9f0adde83d660046a803c05d7f74f827">CSLAM::dataTypeGSLPermutation2CVMat</a>(Mat &amp;cv_mat, gsl_permutation *gsl_permutate)</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;{</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    <span class="keywordtype">size_t</span>  size = gsl_permutation_size(gsl_permutate);</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;size; i++)</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;    {</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;        <span class="keywordtype">int</span> num = gsl_permutation_get(gsl_permutate, i);</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;        cv_mat.ptr&lt;<span class="keywordtype">double</span>&gt;(num)[i] = 1;</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;    }</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;    gsl_permutation_free(gsl_permutate);</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;}</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;</div>
<div class="line"><a name="l03618"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#aaa9d763338c8ff69a37b6a5322b3273d"> 3618</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#aaa9d763338c8ff69a37b6a5322b3273d">CSLAM::keyPointShow</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;{</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;    <span class="keywordflow">for</span> (vector&lt;KeyPoint&gt;::size_type i=0; i&lt;<a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>.size(); i++)</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;    {</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;        CvPoint pt_p = <a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>[i].pt;</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;        cvLine(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, cvPoint(pt_p.x-8, pt_p.y), cvPoint(pt_p.x+8, pt_p.y), CV_RGB(255,0,0),2,8,0);</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;        cvLine(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>, cvPoint(pt_p.x, pt_p.y-8), cvPoint(pt_p.x, pt_p.y+8), CV_RGB(255,0,0),2,8,0);</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;    }</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;    Mat outImage;</div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;    drawKeypoints(<a class="code" href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">m_srcImage</a>,<a class="code" href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">m_keyPoints</a>,outImage);</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;    cvWaitKey(10);</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;    <span class="comment">//char windowNum[1] = {m_frame};</span></div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;    <span class="comment">//_itoa_s(m_frame, windowNum, 10);  // 类型转换</span></div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;    imshow(<span class="stringliteral">&quot;1&quot;</span>,outImage);</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;    cvWaitKey(10);</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;    cvMoveWindow(<span class="stringliteral">&quot;1&quot;</span>, 20, 50);</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;}</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;</div>
<div class="line"><a name="l03646"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a5d131c5a0ebbd1efd2e489c3067f588f"> 3646</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="class_c_s_l_a_m.html#a5d131c5a0ebbd1efd2e489c3067f588f">CSLAM::Gauss</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;V)</div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;{</div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;    <span class="comment">//srand((unsigned)getTickCount());</span></div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">double</span> V1, V2, S;</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> phase = 0;</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    <span class="keywordtype">double</span> X;</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;    <span class="keywordflow">if</span> ( phase == 0 ) </div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;    {</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;        <span class="keywordflow">do</span> </div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;        {</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;            <span class="keywordtype">double</span> U1 = (double)rand() / RAND_MAX;</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;            <span class="keywordtype">double</span> U2 = (double)rand() / RAND_MAX;</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;            V1 = 2 * U1 - 1;</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;            V2 = 2 * U2 - 1;</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;            S = V1 * V1 + V2 * V2;</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;        } <span class="keywordflow">while</span>(S &gt;= 1 || S == 0);</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;        X = V1 * sqrt(-2 * log(S) / S);</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;    } </div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;    {</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;        X = V2 * sqrt(-2 * log(S) / S);</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;    }</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;    phase = 1 - phase;</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;    X = X * V;</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;    <span class="keywordflow">return</span> X;</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;}</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;</div>
<div class="line"><a name="l03685"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a437a2a785882fa7e60041e4cb93b5584"> 3685</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="class_c_s_l_a_m.html#a437a2a785882fa7e60041e4cb93b5584">CSLAM::Gaussian</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;sigma)</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;{</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;    <span class="keywordtype">double</span> time;</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;    time = getTickCount();</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;    RNG <a class="code" href="class_c_s_l_a_m.html#abcc8f667e3c0ad60490a4b6ff10ce7ef">rng</a>(time);</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;    <span class="keywordflow">return</span> rng.gaussian(sigma);</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;}</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;</div>
<div class="line"><a name="l03700"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a6f9aec101d5587b08041e0b17b379606"> 3700</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a6f9aec101d5587b08041e0b17b379606">CSLAM::printLocationMean</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;    <span class="keywordtype">int</span> dim  = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;    <span class="keywordtype">double</span> a = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-4)[0];</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;    <span class="keywordtype">double</span> b = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-3)[0];</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;    <span class="keywordtype">double</span> c = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.ptr&lt;<span class="keywordtype">double</span>&gt;(dim-2)[0];</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;    <span class="comment">//cout&lt;&lt;a&lt;&lt;&quot;  &quot;&lt;&lt;b&lt;&lt;&quot;  &quot;&lt;&lt;c&lt;&lt;endl&lt;&lt;endl;</span></div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;    cout&lt;&lt;<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(dim-4,dim)&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;}</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;</div>
<div class="line"><a name="l03720"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a145b349fba62a11042ddba7e093eb666"> 3720</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a145b349fba62a11042ddba7e093eb666">CSLAM::printLocationCovariance</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;    Mat pp = <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.t()*<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>;</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;    <span class="keywordtype">int</span> dim = pp.rows;</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;    cout&lt;&lt;pp(Range(dim-4,dim-1), Range(dim-4,dim-1))&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;}</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;</div>
<div class="line"><a name="l03734"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a13a92a128d73eaf9781379530ce37d2c"> 3734</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a13a92a128d73eaf9781379530ce37d2c">CSLAM::print2DFeatureMean</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;{</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;    <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (dim-4)/6; i++)</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;    {</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;        index = 6*i;</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;        cout&lt;&lt;<a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rowRange(index, index+6)&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;    }</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;}</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;</div>
<div class="line"><a name="l03753"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a8e4744272b39fe668dec68871054ba93"> 3753</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a8e4744272b39fe668dec68871054ba93">CSLAM::print2DFeatureCovariance</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;{</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a> = <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.t()*<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>;</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>; <span class="keywordtype">id</span>++)</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;    {</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;        cout&lt;&lt;<a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a>(Range(6*<span class="keywordtype">id</span>,6*<span class="keywordtype">id</span>+6), Range(6*<span class="keywordtype">id</span>,6*<span class="keywordtype">id</span>+6))&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;    }</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;}   </div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;</div>
<div class="line"><a name="l03770"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a489aaffa5cbd430aa8fbe7d4b53f7ed5"> 3770</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a489aaffa5cbd430aa8fbe7d4b53f7ed5">CSLAM::print3DFeatureMean</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;{</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;    Point3d xyz;</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;    Mat cov = Mat::zeros(3, 3, CV_64F);</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;    Mat sr  = Mat::zeros(6, 6, CV_64F);</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a> = <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.t()*<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>;</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>; <span class="keywordtype">id</span>++)</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;    {</div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ac9e33202210b195caa0aa290efc4821b">getFeatureCartesianInformation</a>(xyz, sr, cov, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;        cout&lt;&lt;xyz.x&lt;&lt;<span class="stringliteral">&quot;  &quot;</span>&lt;&lt;xyz.y&lt;&lt;<span class="stringliteral">&quot;  &quot;</span>&lt;&lt;xyz.z&lt;&lt;<span class="stringliteral">&quot;  &quot;</span>&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;    }</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;}</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;</div>
<div class="line"><a name="l03792"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#acf08b770452f38f9259bbda5cafc48c0"> 3792</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#acf08b770452f38f9259bbda5cafc48c0">CSLAM::print3DFeatureCovariance</a> (<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;{</div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;    Point3d xyz;</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;    Mat cov = Mat::zeros(3, 3, CV_64F);</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;    Mat sr  = Mat::zeros(6, 6, CV_64F);</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">m_P_k</a> = <a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>.t()*<a class="code" href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">m_S_k</a>;</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <a class="code" href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">m_nMapFeatures</a>; <span class="keywordtype">id</span>++)</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;    {</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#ac9e33202210b195caa0aa290efc4821b">getFeatureCartesianInformation</a>(xyz, sr, cov, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;        cout&lt;&lt;cov&lt;&lt;endl&lt;&lt;endl;</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;    }</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;}</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;</div>
<div class="line"><a name="l03815"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a99a621453e4d7f0c69fec7e8d9501c5d"> 3815</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a99a621453e4d7f0c69fec7e8d9501c5d">CSLAM::makeMatrixSymmetric</a> (Mat &amp;input)<span class="keyword"> const</span></div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;    Mat store;</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;    store = (input + input.t())*0.5;</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;    store.copyTo(input);</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;}</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;</div>
<div class="line"><a name="l03831"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a57a3349c501d2169d2525ae62e109182"> 3831</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a57a3349c501d2169d2525ae62e109182">CSLAM::GSLCholeskyDecomposition</a>(Mat &amp;chol, <span class="keyword">const</span> Mat &amp;input)</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;{</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;    <span class="keywordtype">int</span> dim = input.rows;</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;    Mat output = Mat::zeros(dim, dim, CV_64F);</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;    gsl_matrix * gsl_mat = gsl_matrix_alloc(dim, dim);</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;</div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;    <a class="code" href="class_c_s_l_a_m.html#a3fdb7bea1f813ef9bda6d3d243d6cfc0">dataTypeCVMat2GSLMat</a>(gsl_mat, input);   </div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;    gsl_linalg_cholesky_decomp(gsl_mat);</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;    <span class="comment">// if the matrix is not positive-definite, </span></div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;    <span class="comment">// then the decomposition will fail and return error code GSL_EDOM(1)</span></div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;    <span class="keywordflow">if</span>(GSL_EDOM==gsl_linalg_cholesky_decomp(gsl_mat))</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;    {</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;        cout&lt;&lt;<span class="stringliteral">&quot;GSL Cholesky decomposition fail!&quot;</span>&lt;&lt;endl;</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;    }</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;    {</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a0296a3c396dfcd6a41cab3d8c4b25886">dataTypeGSLMat2CVMat</a>(output, gsl_mat);</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#acc221eda42d50a7825d685885db0cda3">GSLGetCholeskyUpperTriangularMatrix</a>(chol, output);</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;    }</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;}</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;</div>
<div class="line"><a name="l03863"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#acc221eda42d50a7825d685885db0cda3"> 3863</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#acc221eda42d50a7825d685885db0cda3">CSLAM::GSLGetCholeskyUpperTriangularMatrix</a>(Mat &amp;output, <span class="keyword">const</span> Mat &amp;input)</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;{</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;    <span class="keywordtype">int</span> dim = input.rows;</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;dim; i++)   <span class="comment">// get lower triangular matrix</span></div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;    {</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=i; j&lt;dim; j++)</div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;        {</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;            output.ptr&lt;<span class="keywordtype">double</span>&gt;(i)[j] = input.ptr&lt;<span class="keywordtype">double</span>&gt;(i)[j];</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;        }</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;    }</div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;}</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;</div>
<div class="line"><a name="l03885"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#a03c4ab0b1c08db8c15fae4e6e282d22c"> 3885</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#a03c4ab0b1c08db8c15fae4e6e282d22c">CSLAM::calculateMatchFeatureCovariance</a> (Mat &amp;SI, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;flag)</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;{</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;    <span class="keywordtype">int</span> dim  = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;    <span class="keywordtype">int</span> Na   = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>; </div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;    <span class="keywordtype">int</span> dimx = 2*Na;</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;    <span class="keywordtype">int</span> dimy = 2;</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;    <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;    Mat QR(dimx, dimy, CV_64F);</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;    Mat si(2, 2, CV_64F);</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;    <span class="keywordtype">int</span> N = 0;</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#a086a2fbe8637a0c366b02f4edeb0f4e2">FLAG_4_NORMAL_UPDATE</a> == flag)</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;    {</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;        N = <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>;</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;    }</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#ad30ba8cf413d9a57ea0ab4b8d1bb550f">FLAG_4_LOW_INLIER</a> == flag)</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;    {</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;        N = <a class="code" href="class_c_s_l_a_m.html#af7593ffc3d04b9021220808433933e46">m_nLowInliers</a>;</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;    }</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#abf020b03c207d200ed1ce335e2bc3855">FLAG_4_HIGH_INLIER</a> == flag)</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;    {</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;        N = <a class="code" href="class_c_s_l_a_m.html#a6795b117b83b033b0c5d8d6b766b733e">m_nHighInliers</a>;</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;    }</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; N; j++)</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;    {</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;        index = 2*j;</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;        Mat sigma0 = <a class="code" href="class_c_s_l_a_m.html#a01ae894a6391c4045f1905b225120d4a">m_matchingSet</a>.rowRange(Range(index,index+2)) + 0;</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; 2*Na; i++)</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;        {</div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;            QR.row(i) = <a class="code" href="class_c_s_l_a_m.html#a0344cc3ecdb1d702898ee35dd335197e">wi_sr</a>*(<a class="code" href="class_c_s_l_a_m.html#a98bf9ecee710df470fec74d7916f3f06">m_sigma_matchPixel</a>(Range(index,index+2),Range(i+1,i+2)) - sigma0).t();</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;        }</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;        <a class="code" href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318">GSLQrDecomposition</a>(si, QR);</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;</div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;        si.copyTo(SI(Range(index,index+2), Range(index,index+2)));</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;    }</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;    <span class="comment">//QR.create(2*Na, 2*m_nMatches, CV_64F);</span></div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;    <span class="comment">//for (int i=0; i &lt; 2*Na; i++)</span></div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;    <span class="comment">//{</span></div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;    <span class="comment">//  QR.row(i) = wi_sr*(m_sigma_matchPixel.col(i+1) - m_matchingSet).t();</span></div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;    <span class="comment">//GSLQrDecomposition(si, QR);</span></div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;}</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;</div>
<div class="line"><a name="l03941"></a><span class="lineno"><a class="line" href="class_c_s_l_a_m.html#aebdc2826380539f00aa4ffcbba9bcddf"> 3941</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_s_l_a_m.html#aebdc2826380539f00aa4ffcbba9bcddf">CSLAM::calculateMatchFeatureCrossCovariance</a> (Mat &amp;Pxy, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;flag)</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;{</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;    <span class="keywordtype">int</span> dim = <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>.rows;</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    <span class="keywordtype">int</span> Na  = <a class="code" href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">m_sample</a>.<a class="code" href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">num</a>;</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;    <span class="keywordtype">int</span> N   = 0;  </div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#a086a2fbe8637a0c366b02f4edeb0f4e2">FLAG_4_NORMAL_UPDATE</a> == flag)</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;    {</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;        N = <a class="code" href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">m_nMatches</a>;</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;    }</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#ad30ba8cf413d9a57ea0ab4b8d1bb550f">FLAG_4_LOW_INLIER</a> == flag)</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;    {</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;        N = <a class="code" href="class_c_s_l_a_m.html#af7593ffc3d04b9021220808433933e46">m_nLowInliers</a>;</div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;    }</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_c_s_l_a_m.html#abf020b03c207d200ed1ce335e2bc3855">FLAG_4_HIGH_INLIER</a> == flag)</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;    {</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;        N = <a class="code" href="class_c_s_l_a_m.html#a6795b117b83b033b0c5d8d6b766b733e">m_nHighInliers</a>;</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;    }</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;    Mat sub1(dim, 1, CV_64F);</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;    Mat sub2(2*N, 1, CV_64F);</div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= 2*Na; i++)</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;    {</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;        sub1 = <a class="code" href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">m_sigma</a>(Range(0,dim), Range(i,i+1)) - <a class="code" href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">m_X_k</a>;</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;        sub2 = <a class="code" href="class_c_s_l_a_m.html#a98bf9ecee710df470fec74d7916f3f06">m_sigma_matchPixel</a>.col(i) - <a class="code" href="class_c_s_l_a_m.html#ab4a9ce54668c2bd4053dbb905a389cc7">m_updatePredictSet</a>;</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;        <span class="keywordflow">if</span> (!i)</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;            Pxy = <a class="code" href="class_c_s_l_a_m.html#aa18f6aa67da1d91ece58d37976f3aac6">wc0</a>*sub1*sub2.t() + 0;</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;            Pxy += <a class="code" href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">wi</a>*sub1*sub2.t();</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;    }</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;}</div>
<div class="ttc" id="class_c_s_l_a_m_html_aa8696a8dc1f76e7b597c33365503e7df"><div class="ttname"><a href="class_c_s_l_a_m.html#aa8696a8dc1f76e7b597c33365503e7df">CSLAM::QrAndCholeskyForMotion</a></div><div class="ttdeci">void QrAndCholeskyForMotion(void)</div><div class="ttdoc">Calculating covariance. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01539">SLAM.cpp:1539</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a22e6803a4e1b4f01003138cab269ed27"><div class="ttname"><a href="class_c_s_l_a_m.html#a22e6803a4e1b4f01003138cab269ed27">CSLAM::coordinatesWorld2Camera</a></div><div class="ttdeci">void coordinatesWorld2Camera(Mat &amp;Hlr, const Mat &amp;Hlw, const Mat &amp;Rcw) const </div><div class="ttdoc">coordinate transformation. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03274">SLAM.cpp:3274</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7f4c3304387da4b38a48f39969412b0d"><div class="ttname"><a href="class_c_s_l_a_m.html#a7f4c3304387da4b38a48f39969412b0d">CSLAM::m_listCtrl</a></div><div class="ttdeci">CListCtrl m_listCtrl</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00166">SLAM.h:166</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af218e24018cb14dc448e120bd22e8cd8"><div class="ttname"><a href="class_c_s_l_a_m.html#af218e24018cb14dc448e120bd22e8cd8">CSLAM::m_matchID</a></div><div class="ttdeci">Mat m_matchID</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00279">SLAM.h:279</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a38a22429e4f20e13ab032ec19ac63480"><div class="ttname"><a href="class_c_s_l_a_m.html#a38a22429e4f20e13ab032ec19ac63480">CSLAM::m_nMatches</a></div><div class="ttdeci">int m_nMatches</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00218">SLAM.h:218</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aabafa6b7c7b4ddeeec57f44513fdb8b9"><div class="ttname"><a href="class_c_s_l_a_m.html#aabafa6b7c7b4ddeeec57f44513fdb8b9">CSLAM::record_features_dir</a></div><div class="ttdeci">char record_features_dir[100]</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00186">SLAM.h:186</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a073d17fca553c33d9ac42ff155a701ce"><div class="ttname"><a href="class_c_s_l_a_m.html#a073d17fca553c33d9ac42ff155a701ce">CSLAM::m_recordFeaturesDir</a></div><div class="ttdeci">CString m_recordFeaturesDir</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00180">SLAM.h:180</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a5cdb60999eef72cc5c1a974494832506"><div class="ttname"><a href="class_c_s_l_a_m.html#a5cdb60999eef72cc5c1a974494832506">CSLAM::cam_dy</a></div><div class="ttdeci">double cam_dy</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00294">SLAM.h:294</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a1b13f12690acb59cb35ee9620ee39c0a"><div class="ttname"><a href="class_c_s_l_a_m.html#a1b13f12690acb59cb35ee9620ee39c0a">CSLAM::getOneMomentData</a></div><div class="ttdeci">void getOneMomentData(int &amp;id, const int &amp;counter)</div><div class="ttdoc">Load each line odometry data. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00462">SLAM.cpp:462</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aa18f6aa67da1d91ece58d37976f3aac6"><div class="ttname"><a href="class_c_s_l_a_m.html#aa18f6aa67da1d91ece58d37976f3aac6">CSLAM::wc0</a></div><div class="ttdeci">double wc0</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00254">SLAM.h:254</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ae0f220bb7df0075321b3abfcd39a05ba"><div class="ttname"><a href="class_c_s_l_a_m.html#ae0f220bb7df0075321b3abfcd39a05ba">CSLAM::coordinatesWorld2State</a></div><div class="ttdeci">void coordinatesWorld2State(Mat &amp;state, const Mat &amp;Hlw, const double &amp;rho) const </div><div class="ttdoc">coordinate transformation. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03386">SLAM.cpp:3386</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a642c877d84c9035e798c38f8b34b5b2d"><div class="ttname"><a href="class_c_s_l_a_m.html#a642c877d84c9035e798c38f8b34b5b2d">CSLAM::isRecordFeaturesInfo</a></div><div class="ttdeci">BOOL isRecordFeaturesInfo</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00196">SLAM.h:196</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a10360bc4e0d9ba5d21d6b62e162eff4d"><div class="ttname"><a href="class_c_s_l_a_m.html#a10360bc4e0d9ba5d21d6b62e162eff4d">CSLAM::updateRobotInformation</a></div><div class="ttdeci">void updateRobotInformation(void)</div><div class="ttdoc">Robot info updating. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02942">SLAM.cpp:2942</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ad8df79b72807a2dfb9ec7aa171022fd3"><div class="ttname"><a href="class_c_s_l_a_m.html#ad8df79b72807a2dfb9ec7aa171022fd3">CSLAM::FLAG_4_NOISE3</a></div><div class="ttdeci">const int FLAG_4_NOISE3</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00136">SLAM.h:136</a></div></div>
<div class="ttc" id="struct_sample_parameter_html_adc5a7778dd705f7ea770e4140c116924"><div class="ttname"><a href="struct_sample_parameter.html#adc5a7778dd705f7ea770e4140c116924">SampleParameter::wi</a></div><div class="ttdeci">double wi</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00082">SLAM.h:82</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a03dd3280948f837cd51d1fc0e149a6a4"><div class="ttname"><a href="class_c_s_l_a_m.html#a03dd3280948f837cd51d1fc0e149a6a4">CSLAM::detectAndfilteringFeatures</a></div><div class="ttdeci">void detectAndfilteringFeatures(void)</div><div class="ttdoc">Features filtering. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00574">SLAM.cpp:574</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af798403a39b54a6b9d495927f146c72b"><div class="ttname"><a href="class_c_s_l_a_m.html#af798403a39b54a6b9d495927f146c72b">CSLAM::passSigmaThroughMotionFunction</a></div><div class="ttdeci">void passSigmaThroughMotionFunction(const Mat &amp;Ut)</div><div class="ttdoc">Calculating means. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01476">SLAM.cpp:1476</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a87b4d178be628fe7820b3d9ed802d75c"><div class="ttname"><a href="class_c_s_l_a_m.html#a87b4d178be628fe7820b3d9ed802d75c">CSLAM::DIST_2_BORDER</a></div><div class="ttdeci">const double DIST_2_BORDER</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00149">SLAM.h:149</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a5320e447a0d286c4b9d30167d4096517"><div class="ttname"><a href="class_c_s_l_a_m.html#a5320e447a0d286c4b9d30167d4096517">CSLAM::CAPACITY</a></div><div class="ttdeci">static const int CAPACITY</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00127">SLAM.h:127</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a821065642fed081c6386185479d33b98"><div class="ttname"><a href="class_c_s_l_a_m.html#a821065642fed081c6386185479d33b98">CSLAM::GSLModifiedQRDecomposition</a></div><div class="ttdeci">void GSLModifiedQRDecomposition(Mat &amp;sr, const Mat &amp;QR)</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02341">SLAM.cpp:2341</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a27e94bb61d6e364765f33ccce921fcc4"><div class="ttname"><a href="class_c_s_l_a_m.html#a27e94bb61d6e364765f33ccce921fcc4">CSLAM::isUseRANSAC</a></div><div class="ttdeci">BOOL isUseRANSAC</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00193">SLAM.h:193</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a0d3c9f4251466093294f3716ba33202e"><div class="ttname"><a href="class_c_s_l_a_m.html#a0d3c9f4251466093294f3716ba33202e">CSLAM::THRESHOLD_RANSAC</a></div><div class="ttdeci">double THRESHOLD_RANSAC</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00249">SLAM.h:249</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_adee49828a0fe05447fd9b40d9527eed7"><div class="ttname"><a href="class_c_s_l_a_m.html#adee49828a0fe05447fd9b40d9527eed7">CSLAM::wi</a></div><div class="ttdeci">double wi</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00256">SLAM.h:256</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a4e91611cd4da6d00e801af08208af2f7"><div class="ttname"><a href="class_c_s_l_a_m.html#a4e91611cd4da6d00e801af08208af2f7">CSLAM::m_blockSize</a></div><div class="ttdeci">int m_blockSize</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00234">SLAM.h:234</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7aa372b9e9f14d83f429b1f5a04ba329"><div class="ttname"><a href="class_c_s_l_a_m.html#a7aa372b9e9f14d83f429b1f5a04ba329">CSLAM::isShowRobotPath</a></div><div class="ttdeci">BOOL isShowRobotPath</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00197">SLAM.h:197</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a0404597fd653c067002ba5694c0057ab"><div class="ttname"><a href="class_c_s_l_a_m.html#a0404597fd653c067002ba5694c0057ab">CSLAM::recordFeaturesInformation</a></div><div class="ttdeci">void recordFeaturesInformation(void)</div><div class="ttdoc">Fearures info recording. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03556">SLAM.cpp:3556</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a80fe5aa39dd45d7a8019d48c3f223c8d"><div class="ttname"><a href="class_c_s_l_a_m.html#a80fe5aa39dd45d7a8019d48c3f223c8d">CSLAM::m_permutation</a></div><div class="ttdeci">Mat m_permutation</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00280">SLAM.h:280</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ad62db81c1a84c399cbc72a8d537cab52"><div class="ttname"><a href="class_c_s_l_a_m.html#ad62db81c1a84c399cbc72a8d537cab52">CSLAM::insureEnoughFeatures</a></div><div class="ttdeci">void insureEnoughFeatures(void)</div><div class="ttdoc">Constraint checking. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00777">SLAM.cpp:777</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a1fd92be09384ae1139a51d8ee4887020"><div class="ttname"><a href="class_c_s_l_a_m.html#a1fd92be09384ae1139a51d8ee4887020">CSLAM::CHI2INV_TABLE</a></div><div class="ttdeci">const Matx33d CHI2INV_TABLE</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00150">SLAM.h:150</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8c128d14e381f42644926be58523a908"><div class="ttname"><a href="class_c_s_l_a_m.html#a8c128d14e381f42644926be58523a908">CSLAM::MIN_STEP_THETA</a></div><div class="ttdeci">double MIN_STEP_THETA</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00264">SLAM.h:264</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ada64e264d5a7abe84718bb0bb0001eae"><div class="ttname"><a href="class_c_s_l_a_m.html#ada64e264d5a7abe84718bb0bb0001eae">CSLAM::m_minDist</a></div><div class="ttdeci">double m_minDist</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00238">SLAM.h:238</a></div></div>
<div class="ttc" id="struct_points_map_html_a18a69960c103dd2f645677882f90c4a7"><div class="ttname"><a href="struct_points_map.html#a18a69960c103dd2f645677882f90c4a7">PointsMap::sigma</a></div><div class="ttdeci">Point3d sigma</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00067">SLAM.h:67</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a99a621453e4d7f0c69fec7e8d9501c5d"><div class="ttname"><a href="class_c_s_l_a_m.html#a99a621453e4d7f0c69fec7e8d9501c5d">CSLAM::makeMatrixSymmetric</a></div><div class="ttdeci">void makeMatrixSymmetric(Mat &amp;input) const </div><div class="ttdoc">Matrix symmetriclization. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03815">SLAM.cpp:3815</a></div></div>
<div class="ttc" id="struct_sample_parameter_html_a893d5b42e5bdd1a5a1c0734289471373"><div class="ttname"><a href="struct_sample_parameter.html#a893d5b42e5bdd1a5a1c0734289471373">SampleParameter::wc0</a></div><div class="ttdeci">double wc0</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00081">SLAM.h:81</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8e4744272b39fe668dec68871054ba93"><div class="ttname"><a href="class_c_s_l_a_m.html#a8e4744272b39fe668dec68871054ba93">CSLAM::print2DFeatureCovariance</a></div><div class="ttdeci">void print2DFeatureCovariance(void)</div><div class="ttdoc">Features&#39; covariance printer. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03753">SLAM.cpp:3753</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ae6ad9eaab8b872d6eac419b16248139d"><div class="ttname"><a href="class_c_s_l_a_m.html#ae6ad9eaab8b872d6eac419b16248139d">CSLAM::draw2DEllipse</a></div><div class="ttdeci">void draw2DEllipse(IplImage *displayImage, const CvPoint &amp;center, const Mat &amp;covMatrix, const CvScalar color, int thickness) const </div><div class="ttdoc">Draw 2D ellipse. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03052">SLAM.cpp:3052</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7dbebfd2d58ae738b8317e697dfad87e"><div class="ttname"><a href="class_c_s_l_a_m.html#a7dbebfd2d58ae738b8317e697dfad87e">CSLAM::m_noiseType</a></div><div class="ttdeci">int m_noiseType</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00207">SLAM.h:207</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aa2aaf017a8166a4e14e7f86853fbbd5e"><div class="ttname"><a href="class_c_s_l_a_m.html#aa2aaf017a8166a4e14e7f86853fbbd5e">CSLAM::m_sigmaRHO</a></div><div class="ttdeci">double m_sigmaRHO</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00243">SLAM.h:243</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_adfa9dfa0f11f11b7f5a9af9dbadcd44c"><div class="ttname"><a href="class_c_s_l_a_m.html#adfa9dfa0f11f11b7f5a9af9dbadcd44c">CSLAM::m_nStore4Show</a></div><div class="ttdeci">int m_nStore4Show</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00226">SLAM.h:226</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a9f8c9217f9c4f62a903adb9f312285b2"><div class="ttname"><a href="class_c_s_l_a_m.html#a9f8c9217f9c4f62a903adb9f312285b2">CSLAM::map</a></div><div class="ttdeci">PointsMap * map</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00154">SLAM.h:154</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_afe0f12a4240bff20f1fdf67b7f0d941e"><div class="ttname"><a href="class_c_s_l_a_m.html#afe0f12a4240bff20f1fdf67b7f0d941e">CSLAM::m_sigmaMeasure</a></div><div class="ttdeci">double m_sigmaMeasure</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00240">SLAM.h:240</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a6a20501ec9668e00d5e8b691fa9553af"><div class="ttname"><a href="class_c_s_l_a_m.html#a6a20501ec9668e00d5e8b691fa9553af">CSLAM::display2DFeatureModel</a></div><div class="ttdeci">void display2DFeatureModel(void)</div><div class="ttdoc">Features&#39; 2D showing. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02994">SLAM.cpp:2994</a></div></div>
<div class="ttc" id="struct_points_map_html_a09a542b38718813db3700c718cf0e073"><div class="ttname"><a href="struct_points_map.html#a09a542b38718813db3700c718cf0e073">PointsMap::initRotation</a></div><div class="ttdeci">Mat initRotation</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00061">SLAM.h:61</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a80f6155a2e9788f0efb7f368b68df831"><div class="ttname"><a href="class_c_s_l_a_m.html#a80f6155a2e9788f0efb7f368b68df831">CSLAM::SLAM</a></div><div class="ttdeci">void SLAM(void)</div><div class="ttdoc">Processing of SLAM. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00087">SLAM.cpp:87</a></div></div>
<div class="ttc" id="struct_points_map_html_a44a2b4bef54a00188be795474934bae8"><div class="ttname"><a href="struct_points_map.html#a44a2b4bef54a00188be795474934bae8">PointsMap::axis</a></div><div class="ttdeci">Quaternion axis</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00066">SLAM.h:66</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a0344cc3ecdb1d702898ee35dd335197e"><div class="ttname"><a href="class_c_s_l_a_m.html#a0344cc3ecdb1d702898ee35dd335197e">CSLAM::wi_sr</a></div><div class="ttdeci">double wi_sr</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00257">SLAM.h:257</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a77a867e6669ffd4af12c45b66658c4fb"><div class="ttname"><a href="class_c_s_l_a_m.html#a77a867e6669ffd4af12c45b66658c4fb">CSLAM::m_path</a></div><div class="ttdeci">double m_path[2 *(CAPACITY+1)]</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00189">SLAM.h:189</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ac30cd14708eb4b2e1fb936134d1c9879"><div class="ttname"><a href="class_c_s_l_a_m.html#ac30cd14708eb4b2e1fb936134d1c9879">CSLAM::FLAG_4_DOWNDATING</a></div><div class="ttdeci">const int FLAG_4_DOWNDATING</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00139">SLAM.h:139</a></div></div>
<div class="ttc" id="struct_frame_info_html_acf3595d7a77fbbc773a64d3e8801e461"><div class="ttname"><a href="struct_frame_info.html#acf3595d7a77fbbc773a64d3e8801e461">FrameInfo::stop</a></div><div class="ttdeci">int stop</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00089">SLAM.h:89</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ab9c166c9f93a2c92af9e23a3e4f2933a"><div class="ttname"><a href="class_c_s_l_a_m.html#ab9c166c9f93a2c92af9e23a3e4f2933a">CSLAM::m_keyPoints</a></div><div class="ttdeci">vector&lt; KeyPoint &gt; m_keyPoints</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00169">SLAM.h:169</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a086a2fbe8637a0c366b02f4edeb0f4e2"><div class="ttname"><a href="class_c_s_l_a_m.html#a086a2fbe8637a0c366b02f4edeb0f4e2">CSLAM::FLAG_4_NORMAL_UPDATE</a></div><div class="ttdeci">const int FLAG_4_NORMAL_UPDATE</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00140">SLAM.h:140</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a596076d64280eaff8cc2f59d8b83980e"><div class="ttname"><a href="class_c_s_l_a_m.html#a596076d64280eaff8cc2f59d8b83980e">CSLAM::m_totalTimer</a></div><div class="ttdeci">TickMeter m_totalTimer</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00164">SLAM.h:164</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a813e1ea18c829576899fc1a0c37520ca"><div class="ttname"><a href="class_c_s_l_a_m.html#a813e1ea18c829576899fc1a0c37520ca">CSLAM::a1</a></div><div class="ttdeci">double a1</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00261">SLAM.h:261</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af6ce4d3c4af2faaed494f1fe950de490"><div class="ttname"><a href="class_c_s_l_a_m.html#af6ce4d3c4af2faaed494f1fe950de490">CSLAM::m_sigma</a></div><div class="ttdeci">Mat m_sigma</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00284">SLAM.h:284</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aa0230002110863d766bbb269b51a64c8"><div class="ttname"><a href="class_c_s_l_a_m.html#aa0230002110863d766bbb269b51a64c8">CSLAM::m_nDeletes</a></div><div class="ttdeci">int m_nDeletes</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00215">SLAM.h:215</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a86bf11bd122694e1b4950bcb8f78f87b"><div class="ttname"><a href="class_c_s_l_a_m.html#a86bf11bd122694e1b4950bcb8f78f87b">CSLAM::coordinatesImage2Camera</a></div><div class="ttdeci">void coordinatesImage2Camera(Mat &amp;Hlr, const Point2d &amp;uvu) const </div><div class="ttdoc">coordinate transformation. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03343">SLAM.cpp:3343</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aa86127f1bab10c2d4a49f20217ae861c"><div class="ttname"><a href="class_c_s_l_a_m.html#aa86127f1bab10c2d4a49f20217ae861c">CSLAM::a2</a></div><div class="ttdeci">double a2</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00261">SLAM.h:261</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a6e634ee1c27bba0a45e8858426a09a9b"><div class="ttname"><a href="class_c_s_l_a_m.html#a6e634ee1c27bba0a45e8858426a09a9b">CSLAM::m_nShowMatches</a></div><div class="ttdeci">int m_nShowMatches</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00225">SLAM.h:225</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a13a92a128d73eaf9781379530ce37d2c"><div class="ttname"><a href="class_c_s_l_a_m.html#a13a92a128d73eaf9781379530ce37d2c">CSLAM::print2DFeatureMean</a></div><div class="ttdeci">void print2DFeatureMean(void)</div><div class="ttdoc">Features&#39; mean printer. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03734">SLAM.cpp:3734</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a5a2f68b64bde4544e5fc683548205b3d"><div class="ttname"><a href="class_c_s_l_a_m.html#a5a2f68b64bde4544e5fc683548205b3d">CSLAM::m_nStores</a></div><div class="ttdeci">int m_nStores</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00216">SLAM.h:216</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a437a2a785882fa7e60041e4cb93b5584"><div class="ttname"><a href="class_c_s_l_a_m.html#a437a2a785882fa7e60041e4cb93b5584">CSLAM::Gaussian</a></div><div class="ttdeci">double Gaussian(const double &amp;sigma)</div><div class="ttdoc">Gaussian generator. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03685">SLAM.cpp:3685</a></div></div>
<div class="ttc" id="struct_points_map_html_ac3d0d40cd5657fc02be8893f6cb3cb79"><div class="ttname"><a href="struct_points_map.html#ac3d0d40cd5657fc02be8893f6cb3cb79">PointsMap::Si</a></div><div class="ttdeci">Mat Si</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00057">SLAM.h:57</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af64580d03f6d861b18e7b7e44cf1728a"><div class="ttname"><a href="class_c_s_l_a_m.html#af64580d03f6d861b18e7b7e44cf1728a">CSLAM::generateSigmaPoints</a></div><div class="ttdeci">void generateSigmaPoints(Mat &amp;sigma, const Mat &amp;Mu, const Mat &amp;SR)</div><div class="ttdoc">Generating sigma points. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01148">SLAM.cpp:1148</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a760f8e2f059ea84af715e7e61e59eda3"><div class="ttname"><a href="class_c_s_l_a_m.html#a760f8e2f059ea84af715e7e61e59eda3">CSLAM::calculateOneFeatureCovariance</a></div><div class="ttdeci">void calculateOneFeatureCovariance(Mat &amp;si, const int &amp;id)</div><div class="ttdoc">Calculating each feature&#39;s covariance. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01759">SLAM.cpp:1759</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a74dfecb069f3aca641035d1f0291dc9a"><div class="ttname"><a href="class_c_s_l_a_m.html#a74dfecb069f3aca641035d1f0291dc9a">CSLAM::integrateFeaturesInformation</a></div><div class="ttdeci">void integrateFeaturesInformation(void)</div><div class="ttdoc">Integrating newly features&#39; info. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00818">SLAM.cpp:818</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ac714ca823810204673baf18106fcd329"><div class="ttname"><a href="class_c_s_l_a_m.html#ac714ca823810204673baf18106fcd329">CSLAM::m_gryImage</a></div><div class="ttdeci">IplImage * m_gryImage</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00157">SLAM.h:157</a></div></div>
<div class="ttc" id="struct_feature_info_html_a99e98689f3aa603d834c21d0c60095af"><div class="ttname"><a href="struct_feature_info.html#a99e98689f3aa603d834c21d0c60095af">FeatureInfo::state</a></div><div class="ttdeci">Mat state</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00106">SLAM.h:106</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aba4fa1d56a107c695336ddcf74b993df"><div class="ttname"><a href="class_c_s_l_a_m.html#aba4fa1d56a107c695336ddcf74b993df">CSLAM::m_sigmaX</a></div><div class="ttdeci">double m_sigmaX</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00244">SLAM.h:244</a></div></div>
<div class="ttc" id="struct_feature_info_html_a961832690c6e4ce72a7b713aac02d64b"><div class="ttname"><a href="struct_feature_info.html#a961832690c6e4ce72a7b713aac02d64b">FeatureInfo::isLoop</a></div><div class="ttdeci">bool isLoop</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00096">SLAM.h:96</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a489aaffa5cbd430aa8fbe7d4b53f7ed5"><div class="ttname"><a href="class_c_s_l_a_m.html#a489aaffa5cbd430aa8fbe7d4b53f7ed5">CSLAM::print3DFeatureMean</a></div><div class="ttdeci">void print3DFeatureMean(void)</div><div class="ttdoc">Features&#39; 3D mean printer. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03770">SLAM.cpp:3770</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_add6e7be2413df6a83c450a284bb547d9"><div class="ttname"><a href="class_c_s_l_a_m.html#add6e7be2413df6a83c450a284bb547d9">CSLAM::startTimer</a></div><div class="ttdeci">void startTimer(void)</div><div class="ttdoc">Start timer. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00122">SLAM.cpp:122</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7844c896ef4784019de00f6996cac990"><div class="ttname"><a href="class_c_s_l_a_m.html#a7844c896ef4784019de00f6996cac990">CSLAM::cam_K</a></div><div class="ttdeci">Matx33d cam_K</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00302">SLAM.h:302</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a9f0adde83d660046a803c05d7f74f827"><div class="ttname"><a href="class_c_s_l_a_m.html#a9f0adde83d660046a803c05d7f74f827">CSLAM::dataTypeGSLPermutation2CVMat</a></div><div class="ttdeci">void dataTypeGSLPermutation2CVMat(Mat &amp;cv_mat, gsl_permutation *gsl_permutate)</div><div class="ttdoc">Fearures info recording. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03599">SLAM.cpp:3599</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ab2c48c4b1c3f536fb066d014ad262e27"><div class="ttname"><a href="class_c_s_l_a_m.html#ab2c48c4b1c3f536fb066d014ad262e27">CSLAM::HP_INIT_H</a></div><div class="ttdeci">int HP_INIT_H</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00230">SLAM.h:230</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_adb6b5a4598b21f511bed1afb90512a9d"><div class="ttname"><a href="class_c_s_l_a_m.html#adb6b5a4598b21f511bed1afb90512a9d">CSLAM::FLAG_4_DEBUG_MODEL</a></div><div class="ttdeci">const int FLAG_4_DEBUG_MODEL</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00145">SLAM.h:145</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_adedacd69d3ad21e5adab6af313b38c16"><div class="ttname"><a href="class_c_s_l_a_m.html#adedacd69d3ad21e5adab6af313b38c16">CSLAM::m_nPredicts</a></div><div class="ttdeci">int m_nPredicts</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00217">SLAM.h:217</a></div></div>
<div class="ttc" id="struct_points_map_html_af9e6b244eb99c3317623b14ffe8cacad"><div class="ttname"><a href="struct_points_map.html#af9e6b244eb99c3317623b14ffe8cacad">PointsMap::xyz</a></div><div class="ttdeci">Point3d xyz</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00065">SLAM.h:65</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a515d1f5fbd66d9933889c55e192f7866"><div class="ttname"><a href="class_c_s_l_a_m.html#a515d1f5fbd66d9933889c55e192f7866">CSLAM::m_nStorePredicts</a></div><div class="ttdeci">int m_nStorePredicts</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00221">SLAM.h:221</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a1910581735af07c86f936053daf0cbea"><div class="ttname"><a href="class_c_s_l_a_m.html#a1910581735af07c86f936053daf0cbea">CSLAM::expandMatrix</a></div><div class="ttdeci">void expandMatrix(Mat &amp;mu, Mat &amp;sr, const Mat &amp;mu1, const Mat &amp;sr1, const Mat &amp;mu2, const Mat &amp;sr2) const </div><div class="ttdoc">Matrix expanding. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01123">SLAM.cpp:1123</a></div></div>
<div class="ttc" id="struct_points_map_html_a238ff24945d699f40549f4725c092b91"><div class="ttname"><a href="struct_points_map.html#a238ff24945d699f40549f4725c092b91">PointsMap::ID</a></div><div class="ttdeci">int ID</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00049">SLAM.h:49</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_affcfd894a4b426b0bfb875dbf24dd133"><div class="ttname"><a href="class_c_s_l_a_m.html#affcfd894a4b426b0bfb875dbf24dd133">CSLAM::initializeParameters</a></div><div class="ttdeci">void initializeParameters(void)</div><div class="ttdoc">Initialize all parameters. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00158">SLAM.cpp:158</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7b5d9985b9dda0112cf3d274d0f1fd60"><div class="ttname"><a href="class_c_s_l_a_m.html#a7b5d9985b9dda0112cf3d274d0f1fd60">CSLAM::m_pDc</a></div><div class="ttdeci">CDC * m_pDc</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00167">SLAM.h:167</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a6795b117b83b033b0c5d8d6b766b733e"><div class="ttname"><a href="class_c_s_l_a_m.html#a6795b117b83b033b0c5d8d6b766b733e">CSLAM::m_nHighInliers</a></div><div class="ttdeci">int m_nHighInliers</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00228">SLAM.h:228</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a5acc823042d158303466b37dd6e06ca4"><div class="ttname"><a href="class_c_s_l_a_m.html#a5acc823042d158303466b37dd6e06ca4">CSLAM::m_nProcessRaws</a></div><div class="ttdeci">int m_nProcessRaws</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00212">SLAM.h:212</a></div></div>
<div class="ttc" id="struct_feature_info_html_ab6b7d2cfc33e83dfed371baedcc0f05b"><div class="ttname"><a href="struct_feature_info.html#ab6b7d2cfc33e83dfed371baedcc0f05b">FeatureInfo::initPixel</a></div><div class="ttdeci">Point2d initPixel</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00101">SLAM.h:101</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ac350bcc0dd2f25db8622ad07ff304375"><div class="ttname"><a href="class_c_s_l_a_m.html#ac350bcc0dd2f25db8622ad07ff304375">CSLAM::m_deleteID</a></div><div class="ttdeci">Mat m_deleteID</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00278">SLAM.h:278</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aaf16d659d0fc08eab4394f4c19174171"><div class="ttname"><a href="class_c_s_l_a_m.html#aaf16d659d0fc08eab4394f4c19174171">CSLAM::m_showCounter</a></div><div class="ttdeci">int m_showCounter</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00209">SLAM.h:209</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a544ced2312046eed2a631ec63e450957"><div class="ttname"><a href="class_c_s_l_a_m.html#a544ced2312046eed2a631ec63e450957">CSLAM::passSigmaThroughMesaurementFunction</a></div><div class="ttdeci">void passSigmaThroughMesaurementFunction(void)</div><div class="ttdoc">Calculating means. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01615">SLAM.cpp:1615</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a93082c69fed4be144061d488211602a6"><div class="ttname"><a href="class_c_s_l_a_m.html#a93082c69fed4be144061d488211602a6">CSLAM::m_totalTime</a></div><div class="ttdeci">double m_totalTime</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00266">SLAM.h:266</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af573cad7536ec23c885a094dc5e58e51"><div class="ttname"><a href="class_c_s_l_a_m.html#af573cad7536ec23c885a094dc5e58e51">CSLAM::isIdBelongsToSet</a></div><div class="ttdeci">bool isIdBelongsToSet(const double &amp;id, const Mat &amp;set) const </div><div class="ttdoc">Affiliation checking. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03463">SLAM.cpp:3463</a></div></div>
<div class="ttc" id="struct_points_map_html_a26f38c34229bdd548218e3860f258078"><div class="ttname"><a href="struct_points_map.html#a26f38c34229bdd548218e3860f258078">PointsMap::nMatchTimes</a></div><div class="ttdeci">int nMatchTimes</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00054">SLAM.h:54</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a54c5f3eeeeb73b407d076d839cbd25d2"><div class="ttname"><a href="class_c_s_l_a_m.html#a54c5f3eeeeb73b407d076d839cbd25d2">CSLAM::GSLCholeskyUpdate</a></div><div class="ttdeci">void GSLCholeskyUpdate(const Mat &amp;u, const int &amp;flag4UpOrDown, const int &amp;flag4Order)</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02106">SLAM.cpp:2106</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af66895775dcc65306682414ce40ab773"><div class="ttname"><a href="class_c_s_l_a_m.html#af66895775dcc65306682414ce40ab773">CSLAM::m_odoXY</a></div><div class="ttdeci">double m_odoXY[2 *(CAPACITY+1)]</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00188">SLAM.h:188</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a40996973529f1a1d785a8f3ca489dc35"><div class="ttname"><a href="class_c_s_l_a_m.html#a40996973529f1a1d785a8f3ca489dc35">CSLAM::MIN_STEP_X</a></div><div class="ttdeci">double MIN_STEP_X</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00262">SLAM.h:262</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a145f5d483f8d0cec21e0f0513ab92e15"><div class="ttname"><a href="class_c_s_l_a_m.html#a145f5d483f8d0cec21e0f0513ab92e15">CSLAM::m_rho</a></div><div class="ttdeci">double m_rho</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00242">SLAM.h:242</a></div></div>
<div class="ttc" id="class_c_cv_image_html"><div class="ttname"><a href="class_c_cv_image.html">CCvImage</a></div><div class="ttdef"><b>Definition:</b> <a href="_cv_image_8h_source.html#l00005">CvImage.h:5</a></div></div>
<div class="ttc" id="struct_feature_info_html_afe83757d66c4b0e3da84b87a41b65b0b"><div class="ttname"><a href="struct_feature_info.html#afe83757d66c4b0e3da84b87a41b65b0b">FeatureInfo::cov</a></div><div class="ttdeci">Mat cov</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00109">SLAM.h:109</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a08b3ad107020e734c37c8ee2348ae205"><div class="ttname"><a href="class_c_s_l_a_m.html#a08b3ad107020e734c37c8ee2348ae205">CSLAM::CholeskyDecompositionWithPivoting</a></div><div class="ttdeci">void CholeskyDecompositionWithPivoting(Mat &amp;sr, Mat &amp;Cov)</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02158">SLAM.cpp:2158</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a3d2b94fa175e76bf49fb5e88539a286e"><div class="ttname"><a href="class_c_s_l_a_m.html#a3d2b94fa175e76bf49fb5e88539a286e">CSLAM::m_nAddings</a></div><div class="ttdeci">int m_nAddings</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00214">SLAM.h:214</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a2b4d9cba042ab726acf1597de4496b73"><div class="ttname"><a href="class_c_s_l_a_m.html#a2b4d9cba042ab726acf1597de4496b73">CSLAM::FLAG_4_UPDATING</a></div><div class="ttdeci">const int FLAG_4_UPDATING</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00138">SLAM.h:138</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8a7662fb1cd837a51087024ca8e1b318"><div class="ttname"><a href="class_c_s_l_a_m.html#a8a7662fb1cd837a51087024ca8e1b318">CSLAM::GSLQrDecomposition</a></div><div class="ttdeci">void GSLQrDecomposition(Mat &amp;cv_s, const Mat &amp;cv_qr) const </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02315">SLAM.cpp:2315</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a00efe6cbcec61c5b00ea8a805a6fcf43"><div class="ttname"><a href="class_c_s_l_a_m.html#a00efe6cbcec61c5b00ea8a805a6fcf43">CSLAM::m_sample</a></div><div class="ttdeci">SampleParameter m_sample</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00161">SLAM.h:161</a></div></div>
<div class="ttc" id="struct_feature_info_html_a5d574a7c4b2e616ceadcf14d2bac337f"><div class="ttname"><a href="struct_feature_info.html#a5d574a7c4b2e616ceadcf14d2bac337f">FeatureInfo::position</a></div><div class="ttdeci">Point3d position</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00107">SLAM.h:107</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a5fbe026390eb088cfa688e7703d27d65"><div class="ttname"><a href="class_c_s_l_a_m.html#a5fbe026390eb088cfa688e7703d27d65">CSLAM::image_dir</a></div><div class="ttdeci">char image_dir[100]</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00183">SLAM.h:183</a></div></div>
<div class="ttc" id="struct_points_map_html_a11c75def31fe39819316f7daea81d056"><div class="ttname"><a href="struct_points_map.html#a11c75def31fe39819316f7daea81d056">PointsMap::isLoop</a></div><div class="ttdeci">bool isLoop</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00052">SLAM.h:52</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a03a8cb00240cf0cf0920b335abf58cfa"><div class="ttname"><a href="class_c_s_l_a_m.html#a03a8cb00240cf0cf0920b335abf58cfa">CSLAM::m_imageDir</a></div><div class="ttdeci">CString m_imageDir</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00177">SLAM.h:177</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a83fed5c5d7abb40ae80785a56ad99af0"><div class="ttname"><a href="class_c_s_l_a_m.html#a83fed5c5d7abb40ae80785a56ad99af0">CSLAM::m_initOdo</a></div><div class="ttdeci">Mat m_initOdo</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00268">SLAM.h:268</a></div></div>
<div class="ttc" id="struct_points_map_html_a146e870137302a11bb76a3ed729af54f"><div class="ttname"><a href="struct_points_map.html#a146e870137302a11bb76a3ed729af54f">PointsMap::matchLocation</a></div><div class="ttdeci">Point2d matchLocation</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00056">SLAM.h:56</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aea792522064dd9ddd00f01d741383e6d"><div class="ttname"><a href="class_c_s_l_a_m.html#aea792522064dd9ddd00f01d741383e6d">CSLAM::imageHeight</a></div><div class="ttdeci">int imageHeight</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00204">SLAM.h:204</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8c26ea2610fd6c50546658793c866d73"><div class="ttname"><a href="class_c_s_l_a_m.html#a8c26ea2610fd6c50546658793c866d73">CSLAM::Qt</a></div><div class="ttdeci">Mat Qt</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00288">SLAM.h:288</a></div></div>
<div class="ttc" id="struct_points_map_html_a8ffd7123565d166884f81331a0a8e0a3"><div class="ttname"><a href="struct_points_map.html#a8ffd7123565d166884f81331a0a8e0a3">PointsMap::initPatch</a></div><div class="ttdeci">Mat initPatch</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00062">SLAM.h:62</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_abab8e19199fcc56609f0e292db078d14"><div class="ttname"><a href="class_c_s_l_a_m.html#abab8e19199fcc56609f0e292db078d14">CSLAM::m_nMapFeatures</a></div><div class="ttdeci">int m_nMapFeatures</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00219">SLAM.h:219</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a4a9048f6d9b2399c774bf23018a67532"><div class="ttname"><a href="class_c_s_l_a_m.html#a4a9048f6d9b2399c774bf23018a67532">CSLAM::m_nShowPredicts</a></div><div class="ttdeci">int m_nShowPredicts</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00224">SLAM.h:224</a></div></div>
<div class="ttc" id="struct_points_map_html_a80b7f22487b8ac001df92147f6012344"><div class="ttname"><a href="struct_points_map.html#a80b7f22487b8ac001df92147f6012344">PointsMap::initTrans</a></div><div class="ttdeci">Mat initTrans</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00060">SLAM.h:60</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a3e96bf0b3f19e5434fcff36a069a427f"><div class="ttname"><a href="class_c_s_l_a_m.html#a3e96bf0b3f19e5434fcff36a069a427f">CSLAM::m_robotFile</a></div><div class="ttdeci">FILE * m_robotFile</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00174">SLAM.h:174</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ad1df413b1dae707612b6bb47b20c8f4f"><div class="ttname"><a href="class_c_s_l_a_m.html#ad1df413b1dae707612b6bb47b20c8f4f">CSLAM::coordinatesCamera2World</a></div><div class="ttdeci">void coordinatesCamera2World(Mat &amp;Hlw, const Mat &amp;Hlr, const Mat &amp;Rwc) const </div><div class="ttdoc">coordinate transformation. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03367">SLAM.cpp:3367</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a498649955c5c3038c5b134a763f58c54"><div class="ttname"><a href="class_c_s_l_a_m.html#a498649955c5c3038c5b134a763f58c54">CSLAM::gamma</a></div><div class="ttdeci">double gamma</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00251">SLAM.h:251</a></div></div>
<div class="ttc" id="struct_feature_info_html_a35b34ee971e21ea92a6a0450fab5f820"><div class="ttname"><a href="struct_feature_info.html#a35b34ee971e21ea92a6a0450fab5f820">FeatureInfo::axis</a></div><div class="ttdeci">Quaternion axis</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00110">SLAM.h:110</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a5571d5ee4c8d8d49d1cb25ac8552acfb"><div class="ttname"><a href="class_c_s_l_a_m.html#a5571d5ee4c8d8d49d1cb25ac8552acfb">CSLAM::stopTimer</a></div><div class="ttdeci">void stopTimer(void)</div><div class="ttdoc">Stop timer. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00142">SLAM.cpp:142</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7edcfd2ccf3dcee926b3c0985e174075"><div class="ttname"><a href="class_c_s_l_a_m.html#a7edcfd2ccf3dcee926b3c0985e174075">CSLAM::recordRobotInformation</a></div><div class="ttdeci">void recordRobotInformation(void)</div><div class="ttdoc">Robot info recording. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03497">SLAM.cpp:3497</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a47d15f82401fd04de6c5533606c5b6db"><div class="ttname"><a href="class_c_s_l_a_m.html#a47d15f82401fd04de6c5533606c5b6db">CSLAM::cam_f2</a></div><div class="ttdeci">double cam_f2</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00301">SLAM.h:301</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a22c2f1462fcefbd19224c60269577209"><div class="ttname"><a href="class_c_s_l_a_m.html#a22c2f1462fcefbd19224c60269577209">CSLAM::passSigmaThroughMapingFunction</a></div><div class="ttdeci">void passSigmaThroughMapingFunction(Mat &amp;sigma_out, Mat &amp;mu_Hlw, Mat &amp;mu_angle, const Mat &amp;sigma_in)</div><div class="ttdoc">Features&#39; info transformation. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01177">SLAM.cpp:1177</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_abe6cd86e4b6d95b3a69c6d7e14186884"><div class="ttname"><a href="class_c_s_l_a_m.html#abe6cd86e4b6d95b3a69c6d7e14186884">CSLAM::wc0_sr</a></div><div class="ttdeci">double wc0_sr</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00255">SLAM.h:255</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a03c4ab0b1c08db8c15fae4e6e282d22c"><div class="ttname"><a href="class_c_s_l_a_m.html#a03c4ab0b1c08db8c15fae4e6e282d22c">CSLAM::calculateMatchFeatureCovariance</a></div><div class="ttdeci">void calculateMatchFeatureCovariance(Mat &amp;SI, const int &amp;flag)</div><div class="ttdoc">Matching features&#39; covariance. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03885">SLAM.cpp:3885</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af427595554668e8e106c0d21f2a534d4"><div class="ttname"><a href="class_c_s_l_a_m.html#af427595554668e8e106c0d21f2a534d4">CSLAM::addFeatures</a></div><div class="ttdeci">void addFeatures(void)</div><div class="ttdoc">Adding features. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00552">SLAM.cpp:552</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a6f9aec101d5587b08041e0b17b379606"><div class="ttname"><a href="class_c_s_l_a_m.html#a6f9aec101d5587b08041e0b17b379606">CSLAM::printLocationMean</a></div><div class="ttdeci">void printLocationMean(void) const </div><div class="ttdoc">Robot mean printer. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03700">SLAM.cpp:3700</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a015dbfd65b5014a17be3da7594015dc8"><div class="ttname"><a href="class_c_s_l_a_m.html#a015dbfd65b5014a17be3da7594015dc8">CSLAM::QrAndCholeskyForInitilization</a></div><div class="ttdeci">void QrAndCholeskyForInitilization(const Mat &amp;sigma)</div><div class="ttdoc">QR &amp; Cholesky processing. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01260">SLAM.cpp:1260</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a20e95a943836ee3d608b7569f0419c0e"><div class="ttname"><a href="class_c_s_l_a_m.html#a20e95a943836ee3d608b7569f0419c0e">CSLAM::FLAG_4_NOISE2</a></div><div class="ttdeci">const int FLAG_4_NOISE2</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00135">SLAM.h:135</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_abfc34157a6efd2f4b4b2e6ac7b28c7af"><div class="ttname"><a href="class_c_s_l_a_m.html#abfc34157a6efd2f4b4b2e6ac7b28c7af">CSLAM::m_nShowMap</a></div><div class="ttdeci">int m_nShowMap</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00223">SLAM.h:223</a></div></div>
<div class="ttc" id="stdafx_8h_html"><div class="ttname"><a href="stdafx_8h.html">stdafx.h</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7e3d0195d15c15ffaaa82c690770638d"><div class="ttname"><a href="class_c_s_l_a_m.html#a7e3d0195d15c15ffaaa82c690770638d">CSLAM::wrapPatch</a></div><div class="ttdeci">void wrapPatch(void)</div><div class="ttdoc">Patch warp. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01804">SLAM.cpp:1804</a></div></div>
<div class="ttc" id="struct_points_map_html_a0e3b07d928db32f6a7816a88a09584e7"><div class="ttname"><a href="struct_points_map.html#a0e3b07d928db32f6a7816a88a09584e7">PointsMap::matchPatch</a></div><div class="ttdeci">Mat matchPatch</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00063">SLAM.h:63</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7765bfdbbd91e11e73c42c46e3bf88bf"><div class="ttname"><a href="class_c_s_l_a_m.html#a7765bfdbbd91e11e73c42c46e3bf88bf">CSLAM::deleteOneFeature</a></div><div class="ttdeci">PointsMap * deleteOneFeature(const int &amp;id, const int &amp;mapID, PointsMap *p_head)</div><div class="ttdoc">Updating features&#39; info. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02622">SLAM.cpp:2622</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_abf020b03c207d200ed1ce335e2bc3855"><div class="ttname"><a href="class_c_s_l_a_m.html#abf020b03c207d200ed1ce335e2bc3855">CSLAM::FLAG_4_HIGH_INLIER</a></div><div class="ttdeci">const int FLAG_4_HIGH_INLIER</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00142">SLAM.h:142</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a500d28928c87d1ca58ae9bb6ed7e4d65"><div class="ttname"><a href="class_c_s_l_a_m.html#a500d28928c87d1ca58ae9bb6ed7e4d65">CSLAM::FLAG_4_NEEDNOT_REORDER</a></div><div class="ttdeci">const int FLAG_4_NEEDNOT_REORDER</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00144">SLAM.h:144</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a843640a658f940a017c243192eba367d"><div class="ttname"><a href="class_c_s_l_a_m.html#a843640a658f940a017c243192eba367d">CSLAM::m_featuresFile</a></div><div class="ttdeci">FILE * m_featuresFile</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00175">SLAM.h:175</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ac9e33202210b195caa0aa290efc4821b"><div class="ttname"><a href="class_c_s_l_a_m.html#ac9e33202210b195caa0aa290efc4821b">CSLAM::getFeatureCartesianInformation</a></div><div class="ttdeci">void getFeatureCartesianInformation(Point3d &amp;xyz, Mat &amp;sr, Mat &amp;cov, const int &amp;id) const </div><div class="ttdoc">Get 3D info. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02706">SLAM.cpp:2706</a></div></div>
<div class="ttc" id="struct_feature_info_html_a253d7884f9e20e30782e54edad705a0d"><div class="ttname"><a href="struct_feature_info.html#a253d7884f9e20e30782e54edad705a0d">FeatureInfo::initRotation</a></div><div class="ttdeci">Mat initRotation</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00103">SLAM.h:103</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ab4a9ce54668c2bd4053dbb905a389cc7"><div class="ttname"><a href="class_c_s_l_a_m.html#ab4a9ce54668c2bd4053dbb905a389cc7">CSLAM::m_updatePredictSet</a></div><div class="ttdeci">Mat m_updatePredictSet</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00282">SLAM.h:282</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a33c72161c1e2a7b1d3229c06a4bbc5fe"><div class="ttname"><a href="class_c_s_l_a_m.html#a33c72161c1e2a7b1d3229c06a4bbc5fe">CSLAM::m_frameTimer</a></div><div class="ttdeci">TickMeter m_frameTimer</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00163">SLAM.h:163</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a1a3f3c6d1c6f8e2e07ba7f312606338c"><div class="ttname"><a href="class_c_s_l_a_m.html#a1a3f3c6d1c6f8e2e07ba7f312606338c">CSLAM::recordData</a></div><div class="ttdeci">void recordData(void)</div><div class="ttdoc">Info recording. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03484">SLAM.cpp:3484</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_acc221eda42d50a7825d685885db0cda3"><div class="ttname"><a href="class_c_s_l_a_m.html#acc221eda42d50a7825d685885db0cda3">CSLAM::GSLGetCholeskyUpperTriangularMatrix</a></div><div class="ttdeci">void GSLGetCholeskyUpperTriangularMatrix(Mat &amp;output, const Mat &amp;input)</div><div class="ttdoc">Cholesky decomposition. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03863">SLAM.cpp:3863</a></div></div>
<div class="ttc" id="struct_frame_info_html_a02e2271c7816eb5961033b5451fd6af5"><div class="ttname"><a href="struct_frame_info.html#a02e2271c7816eb5961033b5451fd6af5">FrameInfo::rate</a></div><div class="ttdeci">int rate</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00087">SLAM.h:87</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a759b2bdb9135255a749e58df3986211d"><div class="ttname"><a href="class_c_s_l_a_m.html#a759b2bdb9135255a749e58df3986211d">CSLAM::m_deep</a></div><div class="ttdeci">double m_deep</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00241">SLAM.h:241</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ab6d357ac5a0a8e35dcc897b1191265e6"><div class="ttname"><a href="class_c_s_l_a_m.html#ab6d357ac5a0a8e35dcc897b1191265e6">CSLAM::isAdding</a></div><div class="ttdeci">BOOL isAdding</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00192">SLAM.h:192</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a885daa74ce6ef815fb7422c33b4a2e5f"><div class="ttname"><a href="class_c_s_l_a_m.html#a885daa74ce6ef815fb7422c33b4a2e5f">CSLAM::m_filterID</a></div><div class="ttdeci">Mat m_filterID</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00277">SLAM.h:277</a></div></div>
<div class="ttc" id="struct_sample_parameter_html_a5cf6d2b51f3fa6718e7bdf03e2031c5c"><div class="ttname"><a href="struct_sample_parameter.html#a5cf6d2b51f3fa6718e7bdf03e2031c5c">SampleParameter::Lammda</a></div><div class="ttdeci">double Lammda</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00079">SLAM.h:79</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7bd077944865d264ac635a40cf6d2863"><div class="ttname"><a href="class_c_s_l_a_m.html#a7bd077944865d264ac635a40cf6d2863">CSLAM::wm0</a></div><div class="ttdeci">double wm0</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00252">SLAM.h:252</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ac235a1c50f9c27da7ec59231f5be97a4"><div class="ttname"><a href="class_c_s_l_a_m.html#ac235a1c50f9c27da7ec59231f5be97a4">CSLAM::imageWidth</a></div><div class="ttdeci">int imageWidth</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00203">SLAM.h:203</a></div></div>
<div class="ttc" id="_s_l_a_m_8h_html"><div class="ttname"><a href="_s_l_a_m_8h.html">SLAM.h</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a3721327d0b02a524662bc1b5fb4e564d"><div class="ttname"><a href="class_c_s_l_a_m.html#a3721327d0b02a524662bc1b5fb4e564d">CSLAM::distortOnePointRW</a></div><div class="ttdeci">void distortOnePointRW(Point2d &amp;uvd, const Point2d &amp;uvu) const </div><div class="ttdoc">Feature distortion. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03162">SLAM.cpp:3162</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a278385918f3b5a6356c9392ad81fd768"><div class="ttname"><a href="class_c_s_l_a_m.html#a278385918f3b5a6356c9392ad81fd768">CSLAM::loadOdometryData</a></div><div class="ttdeci">void loadOdometryData(void)</div><div class="ttdoc">Load overall odometry data. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00363">SLAM.cpp:363</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8fbff8e37747435d7038c7c070d6fcc8"><div class="ttname"><a href="class_c_s_l_a_m.html#a8fbff8e37747435d7038c7c070d6fcc8">CSLAM::calculateCrossCorrelation</a></div><div class="ttdeci">void calculateCrossCorrelation(double &amp;corr, const Mat &amp;src1, const Mat &amp;src2) const </div><div class="ttdoc">Matrix correlation. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03126">SLAM.cpp:3126</a></div></div>
<div class="ttc" id="struct_sample_parameter_html_ac091f56ac336b70e7b783c2eedbcf7c2"><div class="ttname"><a href="struct_sample_parameter.html#ac091f56ac336b70e7b783c2eedbcf7c2">SampleParameter::Beta</a></div><div class="ttdeci">double Beta</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00076">SLAM.h:76</a></div></div>
<div class="ttc" id="struct_frame_info_html_a40411126ccc74c881c78598a44b736ee"><div class="ttname"><a href="struct_frame_info.html#a40411126ccc74c881c78598a44b736ee">FrameInfo::start</a></div><div class="ttdeci">int start</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00088">SLAM.h:88</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a26010d877c4d12b5f74daba05e06e679"><div class="ttname"><a href="class_c_s_l_a_m.html#a26010d877c4d12b5f74daba05e06e679">CSLAM::isShowOdoCtrlList</a></div><div class="ttdeci">BOOL isShowOdoCtrlList</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00200">SLAM.h:200</a></div></div>
<div class="ttc" id="class_c_cv_image_html_a980e9e3233fc9573bcc9a51390d9a420"><div class="ttname"><a href="class_c_cv_image.html#a980e9e3233fc9573bcc9a51390d9a420">CCvImage::CopyOf</a></div><div class="ttdeci">virtual void CopyOf(CCvImage &amp;image, int desired_color=-1)</div><div class="ttdef"><b>Definition:</b> <a href="_cv_image_8cpp_source.html#l00113">CvImage.cpp:113</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a58c64c678ec1fa80e69c272ba80055a0"><div class="ttname"><a href="class_c_s_l_a_m.html#a58c64c678ec1fa80e69c272ba80055a0">CSLAM::video_dir</a></div><div class="ttdeci">char video_dir[100]</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00182">SLAM.h:182</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a34b1a07d06788e3f83f87997f7983834"><div class="ttname"><a href="class_c_s_l_a_m.html#a34b1a07d06788e3f83f87997f7983834">CSLAM::loadPictures</a></div><div class="ttdeci">void loadPictures(void)</div><div class="ttdoc">Image loading. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00529">SLAM.cpp:529</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aebdc2826380539f00aa4ffcbba9bcddf"><div class="ttname"><a href="class_c_s_l_a_m.html#aebdc2826380539f00aa4ffcbba9bcddf">CSLAM::calculateMatchFeatureCrossCovariance</a></div><div class="ttdeci">void calculateMatchFeatureCrossCovariance(Mat &amp;Pxy, const int &amp;flag)</div><div class="ttdoc">Matching features&#39; cross covariance. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03941">SLAM.cpp:3941</a></div></div>
<div class="ttc" id="struct_frame_info_html_af9e0bdf6eb906ea55a812c79fa57ef40"><div class="ttname"><a href="struct_frame_info.html#af9e0bdf6eb906ea55a812c79fa57ef40">FrameInfo::counter</a></div><div class="ttdeci">int counter</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00091">SLAM.h:91</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a6a2e5ad9c88939b5a16671594cc93e62"><div class="ttname"><a href="class_c_s_l_a_m.html#a6a2e5ad9c88939b5a16671594cc93e62">CSLAM::getTransferMatrix</a></div><div class="ttdeci">void getTransferMatrix(Mat &amp;Rwc, const double &amp;theta) const </div><div class="ttdoc">Rotation matrix computation. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01031">SLAM.cpp:1031</a></div></div>
<div class="ttc" id="struct_points_map_html_a23b78141f4a48fc238ce27c8189b34cc"><div class="ttname"><a href="struct_points_map.html#a23b78141f4a48fc238ce27c8189b34cc">PointsMap::initPixel</a></div><div class="ttdeci">Point2d initPixel</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00059">SLAM.h:59</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a474a3d5d463b92a548d8deafa0692f82"><div class="ttname"><a href="class_c_s_l_a_m.html#a474a3d5d463b92a548d8deafa0692f82">CSLAM::isRecordRobotInfo</a></div><div class="ttdeci">BOOL isRecordRobotInfo</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00195">SLAM.h:195</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a85b62e53754f84ae44e839c98d356227"><div class="ttname"><a href="class_c_s_l_a_m.html#a85b62e53754f84ae44e839c98d356227">CSLAM::FLAG_4_IMAGE</a></div><div class="ttdeci">const int FLAG_4_IMAGE</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00130">SLAM.h:130</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a14caa90d5a993ceec3e1e87ef2a28b82"><div class="ttname"><a href="class_c_s_l_a_m.html#a14caa90d5a993ceec3e1e87ef2a28b82">CSLAM::m_initPos</a></div><div class="ttdeci">Mat m_initPos</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00269">SLAM.h:269</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af263505e43b49a4874c33d8a20191b94"><div class="ttname"><a href="class_c_s_l_a_m.html#af263505e43b49a4874c33d8a20191b94">CSLAM::m_srcImage</a></div><div class="ttdeci">IplImage * m_srcImage</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00156">SLAM.h:156</a></div></div>
<div class="ttc" id="struct_points_map_html_aed9328061c2f36ff497bdcda9c102d35"><div class="ttname"><a href="struct_points_map.html#aed9328061c2f36ff497bdcda9c102d35">PointsMap::isMatching</a></div><div class="ttdeci">bool isMatching</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00051">SLAM.h:51</a></div></div>
<div class="ttc" id="struct_points_map_html"><div class="ttname"><a href="struct_points_map.html">PointsMap</a></div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00047">SLAM.h:47</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a48ac8ce495315b77b2002c29a9c7de03"><div class="ttname"><a href="class_c_s_l_a_m.html#a48ac8ce495315b77b2002c29a9c7de03">CSLAM::m_odometryDir</a></div><div class="ttdeci">CString m_odometryDir</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00178">SLAM.h:178</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_acf08b770452f38f9259bbda5cafc48c0"><div class="ttname"><a href="class_c_s_l_a_m.html#acf08b770452f38f9259bbda5cafc48c0">CSLAM::print3DFeatureCovariance</a></div><div class="ttdeci">void print3DFeatureCovariance(void)</div><div class="ttdoc">Features&#39; 3D covariance printer. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03792">SLAM.cpp:3792</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aaa9d763338c8ff69a37b6a5322b3273d"><div class="ttname"><a href="class_c_s_l_a_m.html#aaa9d763338c8ff69a37b6a5322b3273d">CSLAM::keyPointShow</a></div><div class="ttdeci">void keyPointShow(void)</div><div class="ttdoc">Showing keypoints. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03618">SLAM.cpp:3618</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af7593ffc3d04b9021220808433933e46"><div class="ttname"><a href="class_c_s_l_a_m.html#af7593ffc3d04b9021220808433933e46">CSLAM::m_nLowInliers</a></div><div class="ttdeci">int m_nLowInliers</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00227">SLAM.h:227</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a678882aa9b21e3b762861e19eace4703"><div class="ttname"><a href="class_c_s_l_a_m.html#a678882aa9b21e3b762861e19eace4703">CSLAM::m_model</a></div><div class="ttdeci">int m_model</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00235">SLAM.h:235</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a0296a3c396dfcd6a41cab3d8c4b25886"><div class="ttname"><a href="class_c_s_l_a_m.html#a0296a3c396dfcd6a41cab3d8c4b25886">CSLAM::dataTypeGSLMat2CVMat</a></div><div class="ttdeci">void dataTypeGSLMat2CVMat(Mat &amp;cv_mat, gsl_matrix *gsl_mat) const </div><div class="ttdoc">Datatype: gsl_matrix to Mat. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03439">SLAM.cpp:3439</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a5d131c5a0ebbd1efd2e489c3067f588f"><div class="ttname"><a href="class_c_s_l_a_m.html#a5d131c5a0ebbd1efd2e489c3067f588f">CSLAM::Gauss</a></div><div class="ttdeci">double Gauss(const double &amp;V)</div><div class="ttdoc">Showing keypoints. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03646">SLAM.cpp:3646</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a1c25c2a3a17c0d266ae10294ebbff455"><div class="ttname"><a href="class_c_s_l_a_m.html#a1c25c2a3a17c0d266ae10294ebbff455">CSLAM::m_loopPointID</a></div><div class="ttdeci">Mat m_loopPointID</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00290">SLAM.h:290</a></div></div>
<div class="ttc" id="struct_feature_info_html_a702d21bc7e546a8eed0165cf8f8af51a"><div class="ttname"><a href="struct_feature_info.html#a702d21bc7e546a8eed0165cf8f8af51a">FeatureInfo::sigma</a></div><div class="ttdeci">Point3d sigma</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00111">SLAM.h:111</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a469c1e2668e535b3832eac150de1de20"><div class="ttname"><a href="class_c_s_l_a_m.html#a469c1e2668e535b3832eac150de1de20">CSLAM::calculateSampleParameter</a></div><div class="ttdeci">void calculateSampleParameter(const int &amp;Na)</div><div class="ttdoc">Calculate sample parameter. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01050">SLAM.cpp:1050</a></div></div>
<div class="ttc" id="struct_quaternion_html_acfea23e3ba2b57356fe36b4d8f4c52f3"><div class="ttname"><a href="struct_quaternion.html#acfea23e3ba2b57356fe36b4d8f4c52f3">Quaternion::y</a></div><div class="ttdeci">double y</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00043">SLAM.h:43</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8185f0d150a19c5eb32f2fb31328f1da"><div class="ttname"><a href="class_c_s_l_a_m.html#a8185f0d150a19c5eb32f2fb31328f1da">CSLAM::Ut</a></div><div class="ttdeci">Mat Ut</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00289">SLAM.h:289</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a0dfc931db26c1fed0892384c086f40f8"><div class="ttname"><a href="class_c_s_l_a_m.html#a0dfc931db26c1fed0892384c086f40f8">CSLAM::undistortOnePointRW</a></div><div class="ttdeci">void undistortOnePointRW(Point2d &amp;uv, const Point2d &amp;point) const </div><div class="ttdoc">Feature undistortion. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03209">SLAM.cpp:3209</a></div></div>
<div class="ttc" id="struct_feature_info_html"><div class="ttname"><a href="struct_feature_info.html">FeatureInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00094">SLAM.h:94</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a05c2d207c54f1f9141470586cf22105f"><div class="ttname"><a href="class_c_s_l_a_m.html#a05c2d207c54f1f9141470586cf22105f">CSLAM::m_allPredictSet</a></div><div class="ttdeci">Mat m_allPredictSet</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00281">SLAM.h:281</a></div></div>
<div class="ttc" id="struct_feature_info_html_ab38be032519b9b3d7d2f06373085f1d5"><div class="ttname"><a href="struct_feature_info.html#ab38be032519b9b3d7d2f06373085f1d5">FeatureInfo::sr</a></div><div class="ttdeci">Mat sr</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00108">SLAM.h:108</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7b2a9db2eb682da022004d15044ad0b6"><div class="ttname"><a href="class_c_s_l_a_m.html#a7b2a9db2eb682da022004d15044ad0b6">CSLAM::record_robot_dir</a></div><div class="ttdeci">char record_robot_dir[100]</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00185">SLAM.h:185</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a080b1ac1897d4eeb077517a24369527a"><div class="ttname"><a href="class_c_s_l_a_m.html#a080b1ac1897d4eeb077517a24369527a">CSLAM::getPermutationMatrix</a></div><div class="ttdeci">void getPermutationMatrix(void)</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01303">SLAM.cpp:1303</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a0c00128b360f006e4afee34748ee341c"><div class="ttname"><a href="class_c_s_l_a_m.html#a0c00128b360f006e4afee34748ee341c">CSLAM::m_playType</a></div><div class="ttdeci">int m_playType</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00205">SLAM.h:205</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a9774a298be987d8f58670a3f66f3d4af"><div class="ttname"><a href="class_c_s_l_a_m.html#a9774a298be987d8f58670a3f66f3d4af">CSLAM::FLAG_4_NOISE1</a></div><div class="ttdeci">const int FLAG_4_NOISE1</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00134">SLAM.h:134</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ab4e3b89399d8be16f688460978262f55"><div class="ttname"><a href="class_c_s_l_a_m.html#ab4e3b89399d8be16f688460978262f55">CSLAM::m_covRank</a></div><div class="ttdeci">int m_covRank</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00210">SLAM.h:210</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8db26541a4c9938bd06ca111cb6b434f"><div class="ttname"><a href="class_c_s_l_a_m.html#a8db26541a4c9938bd06ca111cb6b434f">CSLAM::HP_INIT_W</a></div><div class="ttdeci">int HP_INIT_W</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00229">SLAM.h:229</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7174e985af7a5d59bf398d9d1fb5137f"><div class="ttname"><a href="class_c_s_l_a_m.html#a7174e985af7a5d59bf398d9d1fb5137f">CSLAM::cam_k2</a></div><div class="ttdeci">double cam_k2</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00298">SLAM.h:298</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a3fdb7bea1f813ef9bda6d3d243d6cfc0"><div class="ttname"><a href="class_c_s_l_a_m.html#a3fdb7bea1f813ef9bda6d3d243d6cfc0">CSLAM::dataTypeCVMat2GSLMat</a></div><div class="ttdeci">void dataTypeCVMat2GSLMat(gsl_matrix *gsl_mat, const Mat &amp;cv_mat) const </div><div class="ttdoc">Datatype: CVMAT to GSLMat. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03417">SLAM.cpp:3417</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ad15bbef68976bcc5ceb5a4582f19aa5e"><div class="ttname"><a href="class_c_s_l_a_m.html#ad15bbef68976bcc5ceb5a4582f19aa5e">CSLAM::m_S_k</a></div><div class="ttdeci">Mat m_S_k</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00272">SLAM.h:272</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a01ae894a6391c4045f1905b225120d4a"><div class="ttname"><a href="class_c_s_l_a_m.html#a01ae894a6391c4045f1905b225120d4a">CSLAM::m_matchingSet</a></div><div class="ttdeci">Mat m_matchingSet</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00283">SLAM.h:283</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ad30ba8cf413d9a57ea0ab4b8d1bb550f"><div class="ttname"><a href="class_c_s_l_a_m.html#ad30ba8cf413d9a57ea0ab4b8d1bb550f">CSLAM::FLAG_4_LOW_INLIER</a></div><div class="ttdeci">const int FLAG_4_LOW_INLIER</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00141">SLAM.h:141</a></div></div>
<div class="ttc" id="struct_points_map_html_a956223aba332ab81f728de4a724ba9e5"><div class="ttname"><a href="struct_points_map.html#a956223aba332ab81f728de4a724ba9e5">PointsMap::next</a></div><div class="ttdeci">PointsMap * next</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00069">SLAM.h:69</a></div></div>
<div class="ttc" id="struct_feature_info_html_a509765ef838afe279272eb5c309159b8"><div class="ttname"><a href="struct_feature_info.html#a509765ef838afe279272eb5c309159b8">FeatureInfo::ID</a></div><div class="ttdeci">int ID</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00097">SLAM.h:97</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a13befaca89bdd761fdbb8140cc52d026"><div class="ttname"><a href="class_c_s_l_a_m.html#a13befaca89bdd761fdbb8140cc52d026">CSLAM::KalmanUpdate</a></div><div class="ttdeci">void KalmanUpdate(void)</div><div class="ttdoc">Kalman Updating. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02048">SLAM.cpp:2048</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_abcc8f667e3c0ad60490a4b6ff10ce7ef"><div class="ttname"><a href="class_c_s_l_a_m.html#abcc8f667e3c0ad60490a4b6ff10ce7ef">CSLAM::rng</a></div><div class="ttdeci">RNG rng</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00304">SLAM.h:304</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_afd5af89231ef7c63336599eff5fca431"><div class="ttname"><a href="class_c_s_l_a_m.html#afd5af89231ef7c63336599eff5fca431">CSLAM::m_nStoreMatches</a></div><div class="ttdeci">int m_nStoreMatches</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00222">SLAM.h:222</a></div></div>
<div class="ttc" id="struct_quaternion_html"><div class="ttname"><a href="struct_quaternion.html">Quaternion</a></div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00039">SLAM.h:39</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a30e26cb144d31aa55cabd3ca83f6dbb7"><div class="ttname"><a href="class_c_s_l_a_m.html#a30e26cb144d31aa55cabd3ca83f6dbb7">CSLAM::m_minNUM</a></div><div class="ttdeci">int m_minNUM</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00233">SLAM.h:233</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_afd9a182f389ef490e570813c9fbd6a71"><div class="ttname"><a href="class_c_s_l_a_m.html#afd9a182f389ef490e570813c9fbd6a71">CSLAM::cam_f</a></div><div class="ttdeci">double cam_f</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00299">SLAM.h:299</a></div></div>
<div class="ttc" id="struct_frame_info_html_ab11a61ec5156132efd0b15fd26a80ebb"><div class="ttname"><a href="struct_frame_info.html#ab11a61ec5156132efd0b15fd26a80ebb">FrameInfo::index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00090">SLAM.h:90</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a3378ec8c558880dcb28a44a8c491d72e"><div class="ttname"><a href="class_c_s_l_a_m.html#a3378ec8c558880dcb28a44a8c491d72e">CSLAM::m_loopPointCounter</a></div><div class="ttdeci">int m_loopPointCounter</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00236">SLAM.h:236</a></div></div>
<div class="ttc" id="struct_sample_parameter_html_a412391eb8084226b2c57fa67ea1b9c24"><div class="ttname"><a href="struct_sample_parameter.html#a412391eb8084226b2c57fa67ea1b9c24">SampleParameter::wm0</a></div><div class="ttdeci">double wm0</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00080">SLAM.h:80</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aabca4a31778783a06d2299f1d6bcb933"><div class="ttname"><a href="class_c_s_l_a_m.html#aabca4a31778783a06d2299f1d6bcb933">CSLAM::FLAG_4_VIDEO</a></div><div class="ttdeci">const int FLAG_4_VIDEO</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00129">SLAM.h:129</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a93e54316c1d69437d1e955906da90064"><div class="ttname"><a href="class_c_s_l_a_m.html#a93e54316c1d69437d1e955906da90064">CSLAM::cam_f1</a></div><div class="ttdeci">double cam_f1</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00300">SLAM.h:300</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8c626c79d95044923a478f12fd86d5ff"><div class="ttname"><a href="class_c_s_l_a_m.html#a8c626c79d95044923a478f12fd86d5ff">CSLAM::resetAllParameters</a></div><div class="ttdeci">void resetAllParameters(void)</div><div class="ttdoc">Reset parameters. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03075">SLAM.cpp:3075</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a60acccdb7e1218467b1c3ced7a4b1673"><div class="ttname"><a href="class_c_s_l_a_m.html#a60acccdb7e1218467b1c3ced7a4b1673">CSLAM::ID</a></div><div class="ttdeci">int ID</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00202">SLAM.h:202</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a9eded2090a57e9dab2a4b9efae2781a8"><div class="ttname"><a href="class_c_s_l_a_m.html#a9eded2090a57e9dab2a4b9efae2781a8">CSLAM::CSLAM</a></div><div class="ttdeci">CSLAM(void)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00021">SLAM.cpp:21</a></div></div>
<div class="ttc" id="struct_points_map_html_a1c398bd4a599170e5e4b7480994de8fb"><div class="ttname"><a href="struct_points_map.html#a1c398bd4a599170e5e4b7480994de8fb">PointsMap::predictLocation</a></div><div class="ttdeci">Point2d predictLocation</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00055">SLAM.h:55</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a635bb274a586efe93488eab382f0a6ee"><div class="ttname"><a href="class_c_s_l_a_m.html#a635bb274a586efe93488eab382f0a6ee">CSLAM::a4</a></div><div class="ttdeci">double a4</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00261">SLAM.h:261</a></div></div>
<div class="ttc" id="struct_sample_parameter_html_ac95faf09d4c9599ebbffa22015665814"><div class="ttname"><a href="struct_sample_parameter.html#ac95faf09d4c9599ebbffa22015665814">SampleParameter::num</a></div><div class="ttdeci">int num</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00074">SLAM.h:74</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a42bf9fc673526dffe39bb64d6a90a761"><div class="ttname"><a href="class_c_s_l_a_m.html#a42bf9fc673526dffe39bb64d6a90a761">CSLAM::m_featuresAllInfo</a></div><div class="ttdeci">vector&lt; FeatureInfo &gt; m_featuresAllInfo</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00170">SLAM.h:170</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a98bf9ecee710df470fec74d7916f3f06"><div class="ttname"><a href="class_c_s_l_a_m.html#a98bf9ecee710df470fec74d7916f3f06">CSLAM::m_sigma_matchPixel</a></div><div class="ttdeci">Mat m_sigma_matchPixel</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00286">SLAM.h:286</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a10bfba127951793c3c71b1f15dc78ce7"><div class="ttname"><a href="class_c_s_l_a_m.html#a10bfba127951793c3c71b1f15dc78ce7">CSLAM::updateFeaturesInformation</a></div><div class="ttdeci">void updateFeaturesInformation(void)</div><div class="ttdoc">Updating features&#39; info. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02382">SLAM.cpp:2382</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a1fada7ad8f125cfef280afcafcf97ac3"><div class="ttname"><a href="class_c_s_l_a_m.html#a1fada7ad8f125cfef280afcafcf97ac3">CSLAM::m_P_k</a></div><div class="ttdeci">Mat m_P_k</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00273">SLAM.h:273</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a661d6264bcb18e90f58bf7f0d2374ffa"><div class="ttname"><a href="class_c_s_l_a_m.html#a661d6264bcb18e90f58bf7f0d2374ffa">CSLAM::m_X_k</a></div><div class="ttdeci">Mat m_X_k</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00271">SLAM.h:271</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ae4f520854f4c3b5428853987719b5345"><div class="ttname"><a href="class_c_s_l_a_m.html#ae4f520854f4c3b5428853987719b5345">CSLAM::isUseHarris</a></div><div class="ttdeci">BOOL isUseHarris</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00194">SLAM.h:194</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_abdbdc99a7b76b9b92ce1e78b2f15e79f"><div class="ttname"><a href="class_c_s_l_a_m.html#abdbdc99a7b76b9b92ce1e78b2f15e79f">CSLAM::m_nInitialRaws</a></div><div class="ttdeci">int m_nInitialRaws</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00211">SLAM.h:211</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ac789ea573cffc641b30ba830238c49a4"><div class="ttname"><a href="class_c_s_l_a_m.html#ac789ea573cffc641b30ba830238c49a4">CSLAM::m_imageSize</a></div><div class="ttdeci">Size m_imageSize</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00160">SLAM.h:160</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aa47960604a1b02265860649d240d8cbc"><div class="ttname"><a href="class_c_s_l_a_m.html#aa47960604a1b02265860649d240d8cbc">CSLAM::cam_dx</a></div><div class="ttdeci">double cam_dx</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00293">SLAM.h:293</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ae92b3d02b465fe36923da0f55e2b4e57"><div class="ttname"><a href="class_c_s_l_a_m.html#ae92b3d02b465fe36923da0f55e2b4e57">CSLAM::m_frameTime</a></div><div class="ttdeci">double m_frameTime</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00265">SLAM.h:265</a></div></div>
<div class="ttc" id="struct_points_map_html_a78671723ce6091850c99def8eb748096"><div class="ttname"><a href="struct_points_map.html#a78671723ce6091850c99def8eb748096">PointsMap::isVisible</a></div><div class="ttdeci">bool isVisible</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00050">SLAM.h:50</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a3c6287e8c05a2ce85b2100a70da2a316"><div class="ttname"><a href="class_c_s_l_a_m.html#a3c6287e8c05a2ce85b2100a70da2a316">CSLAM::QrAndCholeskyForMeasurement</a></div><div class="ttdeci">void QrAndCholeskyForMeasurement(void)</div><div class="ttdoc">Calculating all features&#39; covariance. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01700">SLAM.cpp:1700</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af97ddaae9d75b625d2c9b051232eb57b"><div class="ttname"><a href="class_c_s_l_a_m.html#af97ddaae9d75b625d2c9b051232eb57b">CSLAM::coordinatesInverseDepth2Cartesian</a></div><div class="ttdeci">void coordinatesInverseDepth2Cartesian(Point3d &amp;xyz, const Mat &amp;position, const Mat &amp;state) const </div><div class="ttdoc">Inverse depth to Cartesian. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02750">SLAM.cpp:2750</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aeca66ae1995f8cf09c57c44b7e9386ad"><div class="ttname"><a href="class_c_s_l_a_m.html#aeca66ae1995f8cf09c57c44b7e9386ad">CSLAM::dataAssociation</a></div><div class="ttdeci">void dataAssociation(void)</div><div class="ttdoc">Data association. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01915">SLAM.cpp:1915</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a57a3349c501d2169d2525ae62e109182"><div class="ttname"><a href="class_c_s_l_a_m.html#a57a3349c501d2169d2525ae62e109182">CSLAM::GSLCholeskyDecomposition</a></div><div class="ttdeci">void GSLCholeskyDecomposition(Mat &amp;chol, const Mat &amp;input)</div><div class="ttdoc">Cholesky decomposition. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03831">SLAM.cpp:3831</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a69844c2d815fca5ecfe2e41ee77f0f13"><div class="ttname"><a href="class_c_s_l_a_m.html#a69844c2d815fca5ecfe2e41ee77f0f13">CSLAM::m_rect</a></div><div class="ttdeci">CRect m_rect</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00168">SLAM.h:168</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a62c42ac100361d94d003ea8c4f9b1781"><div class="ttname"><a href="class_c_s_l_a_m.html#a62c42ac100361d94d003ea8c4f9b1781">CSLAM::m_showFeatureInfo</a></div><div class="ttdeci">CEdit m_showFeatureInfo</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00165">SLAM.h:165</a></div></div>
<div class="ttc" id="struct_quaternion_html_a65c93d8db6c57203447bd0594b608512"><div class="ttname"><a href="struct_quaternion.html#a65c93d8db6c57203447bd0594b608512">Quaternion::x</a></div><div class="ttdeci">double x</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00042">SLAM.h:42</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a1320f334365b4195cf17dc6648dafc61"><div class="ttname"><a href="class_c_s_l_a_m.html#a1320f334365b4195cf17dc6648dafc61">CSLAM::m_sigmaTheta</a></div><div class="ttdeci">double m_sigmaTheta</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00247">SLAM.h:247</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a834da4dd7bd7641a26bcfa75e425d117"><div class="ttname"><a href="class_c_s_l_a_m.html#a834da4dd7bd7641a26bcfa75e425d117">CSLAM::FLAG_4_NEED_REORDER</a></div><div class="ttdeci">const int FLAG_4_NEED_REORDER</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00143">SLAM.h:143</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7b892f4223a321329a022e2d0fb9421b"><div class="ttname"><a href="class_c_s_l_a_m.html#a7b892f4223a321329a022e2d0fb9421b">CSLAM::m_nStoreMap</a></div><div class="ttdeci">int m_nStoreMap</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00220">SLAM.h:220</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a17440c5331a3f5b5c9fc16be08b8e060"><div class="ttname"><a href="class_c_s_l_a_m.html#a17440c5331a3f5b5c9fc16be08b8e060">CSLAM::calculateOneFeatureCrossCovariance</a></div><div class="ttdeci">void calculateOneFeatureCrossCovariance(Mat &amp;Pxy, const int &amp;id, const Mat &amp;hi) const </div><div class="ttdoc">Calculating means &amp; covariance. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02020">SLAM.cpp:2020</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aa4dec06804947efe52110a24ffc9a429"><div class="ttname"><a href="class_c_s_l_a_m.html#aa4dec06804947efe52110a24ffc9a429">CSLAM::m_capture</a></div><div class="ttdeci">CvCapture * m_capture</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00159">SLAM.h:159</a></div></div>
<div class="ttc" id="struct_feature_info_html_a66ce45d13e9e9f2c7ba4f876bad43abd"><div class="ttname"><a href="struct_feature_info.html#a66ce45d13e9e9f2c7ba4f876bad43abd">FeatureInfo::initTrans</a></div><div class="ttdeci">Mat initTrans</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00102">SLAM.h:102</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a2ca25e096261f87d375607a7b4ff2e00"><div class="ttname"><a href="class_c_s_l_a_m.html#a2ca25e096261f87d375607a7b4ff2e00">CSLAM::m_videoDir</a></div><div class="ttdeci">CString m_videoDir</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00176">SLAM.h:176</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a2645484f02632745bc6375b46d05ebb6"><div class="ttname"><a href="class_c_s_l_a_m.html#a2645484f02632745bc6375b46d05ebb6">CSLAM::m_odoTheta</a></div><div class="ttdeci">Mat m_odoTheta</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00270">SLAM.h:270</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a28e30bbd4f4c912f3ea6508494a70f78"><div class="ttname"><a href="class_c_s_l_a_m.html#a28e30bbd4f4c912f3ea6508494a70f78">CSLAM::wm0_sr</a></div><div class="ttdeci">double wm0_sr</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00253">SLAM.h:253</a></div></div>
<div class="ttc" id="struct_feature_info_html_ae951d77383d7f4e677f3d2a015033ea1"><div class="ttname"><a href="struct_feature_info.html#ae951d77383d7f4e677f3d2a015033ea1">FeatureInfo::nMatchTimes</a></div><div class="ttdeci">int nMatchTimes</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00099">SLAM.h:99</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a2835432153601737fc85a2c7b04e466e"><div class="ttname"><a href="class_c_s_l_a_m.html#a2835432153601737fc85a2c7b04e466e">CSLAM::odometry_dir</a></div><div class="ttdeci">char odometry_dir[100]</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00184">SLAM.h:184</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aee36f14f2b4c91eab000bc88ff16d875"><div class="ttname"><a href="class_c_s_l_a_m.html#aee36f14f2b4c91eab000bc88ff16d875">CSLAM::m_frame</a></div><div class="ttdeci">FrameInfo m_frame</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00162">SLAM.h:162</a></div></div>
<div class="ttc" id="struct_sample_parameter_html_a58923d88cfd810ef420737f7106f52c2"><div class="ttname"><a href="struct_sample_parameter.html#a58923d88cfd810ef420737f7106f52c2">SampleParameter::Alpha</a></div><div class="ttdeci">double Alpha</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00075">SLAM.h:75</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8eea906e350c8babe0cc551baaae6d5a"><div class="ttname"><a href="class_c_s_l_a_m.html#a8eea906e350c8babe0cc551baaae6d5a">CSLAM::matrix2Quaternion</a></div><div class="ttdeci">void matrix2Quaternion(Quaternion &amp;quaternion, const Mat &amp;matrix) const </div><div class="ttdoc">Matrix to quaternion. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02888">SLAM.cpp:2888</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aab935085bc5d29e9412a0253fc404197"><div class="ttname"><a href="class_c_s_l_a_m.html#aab935085bc5d29e9412a0253fc404197">CSLAM::m_odoCounter</a></div><div class="ttdeci">int m_odoCounter</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00208">SLAM.h:208</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ac0c80869716e916b2cc1e68d19a41094"><div class="ttname"><a href="class_c_s_l_a_m.html#ac0c80869716e916b2cc1e68d19a41094">CSLAM::m_recordRobotDir</a></div><div class="ttdeci">CString m_recordRobotDir</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00179">SLAM.h:179</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a9df2936951f63c5cb86449bd378e13fc"><div class="ttname"><a href="class_c_s_l_a_m.html#a9df2936951f63c5cb86449bd378e13fc">CSLAM::wrapAngle</a></div><div class="ttdeci">double wrapAngle(double angle) const </div><div class="ttdoc">Angle wrap. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00507">SLAM.cpp:507</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a8a94c52f05d73f0dadcb9535d8dab8e8"><div class="ttname"><a href="class_c_s_l_a_m.html#a8a94c52f05d73f0dadcb9535d8dab8e8">CSLAM::cam_cx</a></div><div class="ttdeci">double cam_cx</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00295">SLAM.h:295</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ad3b702b958ce4e2bfd6a1b834e553b9b"><div class="ttname"><a href="class_c_s_l_a_m.html#ad3b702b958ce4e2bfd6a1b834e553b9b">CSLAM::HP_MATCH_H</a></div><div class="ttdeci">int HP_MATCH_H</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00232">SLAM.h:232</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a1da3ef03133006f33d757f3963439279"><div class="ttname"><a href="class_c_s_l_a_m.html#a1da3ef03133006f33d757f3963439279">CSLAM::m_weightType</a></div><div class="ttdeci">int m_weightType</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00206">SLAM.h:206</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_adf143164b103c821c69e6ecbdf196cf4"><div class="ttname"><a href="class_c_s_l_a_m.html#adf143164b103c821c69e6ecbdf196cf4">CSLAM::~CSLAM</a></div><div class="ttdeci">~CSLAM(void)</div><div class="ttdoc">Deconstructor. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l00064">SLAM.cpp:64</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_afba572d4a049c382580f2e8f1bcee90d"><div class="ttname"><a href="class_c_s_l_a_m.html#afba572d4a049c382580f2e8f1bcee90d">CSLAM::predictMeasurement</a></div><div class="ttdeci">void predictMeasurement(void)</div><div class="ttdoc">Measurement prediction. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01604">SLAM.cpp:1604</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a611321fbdc3c7da07acc33887d8957d8"><div class="ttname"><a href="class_c_s_l_a_m.html#a611321fbdc3c7da07acc33887d8957d8">CSLAM::isShowOdoInfo</a></div><div class="ttdeci">BOOL isShowOdoInfo</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00198">SLAM.h:198</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a9ffe3e696284b97ea73ac27e23db3956"><div class="ttname"><a href="class_c_s_l_a_m.html#a9ffe3e696284b97ea73ac27e23db3956">CSLAM::m_nFilters</a></div><div class="ttdeci">int m_nFilters</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00213">SLAM.h:213</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a6f4aa8e49668185ea1669a443ea49fc9"><div class="ttname"><a href="class_c_s_l_a_m.html#a6f4aa8e49668185ea1669a443ea49fc9">CSLAM::THRESHOLD_MATCH_PATCH</a></div><div class="ttdeci">double THRESHOLD_MATCH_PATCH</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00248">SLAM.h:248</a></div></div>
<div class="ttc" id="struct_points_map_html_a86f50e61c0c3b676cc2acfce61872b74"><div class="ttname"><a href="struct_points_map.html#a86f50e61c0c3b676cc2acfce61872b74">PointsMap::nPredictTimes</a></div><div class="ttdeci">int nPredictTimes</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00053">SLAM.h:53</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a433d23784c33370acb9937fe2c2e85a4"><div class="ttname"><a href="class_c_s_l_a_m.html#a433d23784c33370acb9937fe2c2e85a4">CSLAM::HP_MATCH_W</a></div><div class="ttdeci">int HP_MATCH_W</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00231">SLAM.h:231</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_aba782c591b58352bd24cec8ea470c20a"><div class="ttname"><a href="class_c_s_l_a_m.html#aba782c591b58352bd24cec8ea470c20a">CSLAM::calculateEigenvaluesAndEigenvectors</a></div><div class="ttdeci">bool calculateEigenvaluesAndEigenvectors(Mat src, Mat &amp;eigenvalues, Mat &amp;eigenvectors) const </div><div class="ttdoc">Eigen value calculating. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02800">SLAM.cpp:2800</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a4221baffff6789741c634b62da1344e1"><div class="ttname"><a href="class_c_s_l_a_m.html#a4221baffff6789741c634b62da1344e1">CSLAM::modifiedCholeskyDecomposition</a></div><div class="ttdeci">void modifiedCholeskyDecomposition(Mat &amp;S, const Mat &amp;input)</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02182">SLAM.cpp:2182</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ae797f7fd1216905fa1c17ef7c9d41813"><div class="ttname"><a href="class_c_s_l_a_m.html#ae797f7fd1216905fa1c17ef7c9d41813">CSLAM::FLAG_4_WEIGHT1</a></div><div class="ttdeci">const int FLAG_4_WEIGHT1</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00131">SLAM.h:131</a></div></div>
<div class="ttc" id="struct_quaternion_html_a90bbdb05526bddfbc3247dcc9a5cace4"><div class="ttname"><a href="struct_quaternion.html#a90bbdb05526bddfbc3247dcc9a5cace4">Quaternion::z</a></div><div class="ttdeci">double z</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00044">SLAM.h:44</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a3e577b86fc8fffc99c1c2d6a0ec3580e"><div class="ttname"><a href="class_c_s_l_a_m.html#a3e577b86fc8fffc99c1c2d6a0ec3580e">CSLAM::m_qualityLevel</a></div><div class="ttdeci">double m_qualityLevel</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00260">SLAM.h:260</a></div></div>
<div class="ttc" id="struct_sample_parameter_html_ab6ee72fdd7511006a2408e5363b85003"><div class="ttname"><a href="struct_sample_parameter.html#ab6ee72fdd7511006a2408e5363b85003">SampleParameter::Gamma</a></div><div class="ttdeci">double Gamma</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00077">SLAM.h:77</a></div></div>
<div class="ttc" id="struct_quaternion_html_a3038e7e4cec6f26920d52daf0ea2c777"><div class="ttname"><a href="struct_quaternion.html#a3038e7e4cec6f26920d52daf0ea2c777">Quaternion::r</a></div><div class="ttdeci">double r</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00041">SLAM.h:41</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a438b28c0143312606e935be8bd30c9b4"><div class="ttname"><a href="class_c_s_l_a_m.html#a438b28c0143312606e935be8bd30c9b4">CSLAM::MIN_STEP_Y</a></div><div class="ttdeci">double MIN_STEP_Y</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00263">SLAM.h:263</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a24751bbd1328ceedc0d2d0c4008fb9f7"><div class="ttname"><a href="class_c_s_l_a_m.html#a24751bbd1328ceedc0d2d0c4008fb9f7">CSLAM::EPSILON</a></div><div class="ttdeci">const double EPSILON</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00148">SLAM.h:148</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a35a297ef2642aa92fe4ae5510deccbe5"><div class="ttname"><a href="class_c_s_l_a_m.html#a35a297ef2642aa92fe4ae5510deccbe5">CSLAM::m_minDist2</a></div><div class="ttdeci">double m_minDist2</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00239">SLAM.h:239</a></div></div>
<div class="ttc" id="struct_feature_info_html_aff5e4c938733c62b57087d04e696a1c3"><div class="ttname"><a href="struct_feature_info.html#aff5e4c938733c62b57087d04e696a1c3">FeatureInfo::initXYZ</a></div><div class="ttdeci">Point3d initXYZ</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00100">SLAM.h:100</a></div></div>
<div class="ttc" id="struct_feature_info_html_ad208f9f4a66295dde14512e18c06edd1"><div class="ttname"><a href="struct_feature_info.html#ad208f9f4a66295dde14512e18c06edd1">FeatureInfo::nPredictTimes</a></div><div class="ttdeci">int nPredictTimes</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00098">SLAM.h:98</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_ab5b37bf7b14dd233ac4171797a035eda"><div class="ttname"><a href="class_c_s_l_a_m.html#ab5b37bf7b14dd233ac4171797a035eda">CSLAM::coordinatesState2World</a></div><div class="ttdeci">void coordinatesState2World(Mat &amp;Hlw, const Mat &amp;state, const Mat &amp;cam_position) const </div><div class="ttdoc">coordinate transformation. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03235">SLAM.cpp:3235</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a7fe436c059d203549dbe5beb2ff8821a"><div class="ttname"><a href="class_c_s_l_a_m.html#a7fe436c059d203549dbe5beb2ff8821a">CSLAM::Mt</a></div><div class="ttdeci">Mat Mt</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00287">SLAM.h:287</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a42b7d3d199787009a5825ad9ed61076d"><div class="ttname"><a href="class_c_s_l_a_m.html#a42b7d3d199787009a5825ad9ed61076d">CSLAM::m_sigmaZ</a></div><div class="ttdeci">double m_sigmaZ</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00246">SLAM.h:246</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a145b349fba62a11042ddba7e093eb666"><div class="ttname"><a href="class_c_s_l_a_m.html#a145b349fba62a11042ddba7e093eb666">CSLAM::printLocationCovariance</a></div><div class="ttdeci">void printLocationCovariance(void) const </div><div class="ttdoc">Robot covariance printer. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03720">SLAM.cpp:3720</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af811ca011fcf404a1ceb74fcb7d76e50"><div class="ttname"><a href="class_c_s_l_a_m.html#af811ca011fcf404a1ceb74fcb7d76e50">CSLAM::cam_cy</a></div><div class="ttdeci">double cam_cy</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00296">SLAM.h:296</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_abcb644a1c146d7ef63911e6166f3a082"><div class="ttname"><a href="class_c_s_l_a_m.html#abcb644a1c146d7ef63911e6166f3a082">CSLAM::isCompensate</a></div><div class="ttdeci">BOOL isCompensate</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00199">SLAM.h:199</a></div></div>
<div class="ttc" id="struct_feature_info_html_a561b52cdb649d471fc98288b445af6b7"><div class="ttname"><a href="struct_feature_info.html#a561b52cdb649d471fc98288b445af6b7">FeatureInfo::initPatch</a></div><div class="ttdeci">Mat initPatch</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00104">SLAM.h:104</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a29508ebc6507aab0b651c6b0f4264c40"><div class="ttname"><a href="class_c_s_l_a_m.html#a29508ebc6507aab0b651c6b0f4264c40">CSLAM::coordinatesCamera2Image</a></div><div class="ttdeci">void coordinatesCamera2Image(Point2d &amp;uvu, const Mat &amp;Hlr, const Mat &amp;error) const </div><div class="ttdoc">coordinate transformation. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l03309">SLAM.cpp:3309</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a70d20db5b72be123260f60d3c7fa87ee"><div class="ttname"><a href="class_c_s_l_a_m.html#a70d20db5b72be123260f60d3c7fa87ee">CSLAM::m_sigma_allPixel</a></div><div class="ttdeci">Mat m_sigma_allPixel</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00285">SLAM.h:285</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a9be9d3353e795d702436c03d09cfc831"><div class="ttname"><a href="class_c_s_l_a_m.html#a9be9d3353e795d702436c03d09cfc831">CSLAM::m_odometryFile</a></div><div class="ttdeci">FILE * m_odometryFile</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00173">SLAM.h:173</a></div></div>
<div class="ttc" id="struct_sample_parameter_html_a1840fed96070a8f30481cc5e50c8c8f3"><div class="ttname"><a href="struct_sample_parameter.html#a1840fed96070a8f30481cc5e50c8c8f3">SampleParameter::Kappa</a></div><div class="ttdeci">double Kappa</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00078">SLAM.h:78</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a5ee80e07f7e5495a4c417aa29ca82b09"><div class="ttname"><a href="class_c_s_l_a_m.html#a5ee80e07f7e5495a4c417aa29ca82b09">CSLAM::m_sigmaY</a></div><div class="ttdeci">double m_sigmaY</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00245">SLAM.h:245</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a2ffb021f1b1b4b171df2af17f3e44c7b"><div class="ttname"><a href="class_c_s_l_a_m.html#a2ffb021f1b1b4b171df2af17f3e44c7b">CSLAM::predictMotion</a></div><div class="ttdeci">void predictMotion(void)</div><div class="ttdoc">Motion prediction. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l01343">SLAM.cpp:1343</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a6a1a915046eb327cb33a4424eda2bdcc"><div class="ttname"><a href="class_c_s_l_a_m.html#a6a1a915046eb327cb33a4424eda2bdcc">CSLAM::get3DdisplayInformation</a></div><div class="ttdeci">void get3DdisplayInformation(Quaternion &amp;axis, Point3d &amp;sigma, const Mat &amp;matrix) const </div><div class="ttdoc">Getting 3D info. </div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8cpp_source.html#l02776">SLAM.cpp:2776</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_a88d74ecfef345368df31b591c8c258f3"><div class="ttname"><a href="class_c_s_l_a_m.html#a88d74ecfef345368df31b591c8c258f3">CSLAM::cam_k1</a></div><div class="ttdeci">double cam_k1</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00297">SLAM.h:297</a></div></div>
<div class="ttc" id="class_c_s_l_a_m_html_af4c7303a8d6e8d709f01e351495b6680"><div class="ttname"><a href="class_c_s_l_a_m.html#af4c7303a8d6e8d709f01e351495b6680">CSLAM::a3</a></div><div class="ttdeci">double a3</div><div class="ttdef"><b>Definition:</b> <a href="_s_l_a_m_8h_source.html#l00261">SLAM.h:261</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 2 2014 16:22:59 for MonoSLAM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
